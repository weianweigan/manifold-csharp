class gs{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(r);i!==-1&&s.splice(i,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class or extends gs{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class pu extends gs{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new or(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Cr(){return Cr=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Cr.apply(this,arguments)}function Zn(t){return t instanceof or}function Rr(t){return Array.isArray(t)&&t[0]instanceof or}function _r(t){return!!(gu(t)&&du(t)instanceof or)}function du(t){for(const e in t)return t[e]}function gu(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const he=Symbol("attributes"),nr=Symbol("immutableKeys");class ms extends gs{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[he]=void 0,this[nr]=void 0,this.graph=e,this[nr]=new Set,this[he]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof ms){const i=this.graph.createEdge(n,this,s);i.addEventListener("dispose",()=>s.dispose()),this[nr].add(n),r[n]=i}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[he]){const s=this[he][n];if(Zn(s)){const i=s;i.getChild()===e&&this.setRef(n,r,i.getAttributes())}else if(Rr(s)){const a=s.find(o=>o.getChild()===e);if(a){const o=a.getAttributes();this.removeRef(n,e).addRef(n,r,o)}}else if(_r(s)){const i=s;for(const a in i){const o=i[a];o.getChild()===e&&this.setRefMap(n,a,r,o.getAttributes())}}}return this}get(e){return this[he][e]}set(e,r){return this[he][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[he][e];return r?r.getChild():null}setRef(e,r,n){if(this[nr].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[he][e];if(s&&s.dispose(),!r)return this;const i=this.graph.createEdge(e,this,r,n);return i.addEventListener("dispose",()=>{delete this[he][e],this.dispatchEvent({type:"change",attribute:e})}),this[he][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[he][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),i=this[he][e];return i.push(s),s.addEventListener("dispose",()=>{let a;for(;(a=i.indexOf(s))!==-1;)i.splice(a,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[he][e].filter(i=>i.getChild()===r).forEach(i=>i.dispose()),this}listRefMapKeys(e){return Object.keys(this[he][e])}listRefMapValues(e){return Object.values(this[he][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[he][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const i=this[he][e],a=i[r];if(a&&a.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const o=this.graph.createEdge(e,this,n,Cr({},s,{key:r}));return o.addEventListener("dispose",()=>{delete i[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),i[r]=o,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(Cr({},e,{target:this})),this.graph.dispatchEvent(Cr({},e,{target:this,type:`node:${e.type}`})),this}}const sa="v3.8.0",cr="@glb.bin";var q,fn,Je,it,zt;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(q||(q={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(fn||(fn={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(Je||(Je={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(it||(it={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(zt||(zt={}));const un={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var Zr,Qn=typeof Float32Array<"u"?Float32Array:Array;function Gn(t){return Math.hypot(t[0],t[1],t[2])}function mu(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/(a=a||1),t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function vu(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===q.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const i=s.getMesh();if(!i)return;const a=yu(i,s.getWorldMatrix());es(a.min,e),es(a.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),Zr=new Qn(3),Qn!=Float32Array&&(Zr[0]=0,Zr[1]=0,Zr[2]=0);function yu(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let i=[0,0,0],a=[0,0,0];for(let o=0;o<s.getCount();o++)i=s.getElement(o,i),a=mu(a,i,e),es(a,r)}return r}function es(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class Q{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const i of e)r+=i.byteLength;const n=new Uint8Array(r);let s=0;for(const i of e)n.set(i,s),s+=i.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let i=e.byteLength;i<n;i++)s[i]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let He=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,i]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*i<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let i=0;i<3;i++)s[i]=n[i]<.04045?.0773993808*n[i]:Math.pow(.9478672986*n[i]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let i=0;i<3;i++)s[i]=n[i]<.0031308?12.92*n[i]:1.055*Math.pow(n[i],.41666)-.055;return r}},ia=class aa{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return Q.decodeText(e.slice(12,16))===aa.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};ia.PNG_FRIED_CHUNK_NAME="CgBI";let ht=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function xu(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}ht.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),xu(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new ia};let lr=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return ht.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function bi(t){return Object.prototype.toString.call(t)==="[object Object]"}function jt(t){if(bi(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return bi(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var qn,ts;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(ts||(ts={}));let Gt=class Ir{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Ir.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Ir.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Ir.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Ir.Verbosity.ERROR&&console.error(e)}};function Tu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=e[8],y=e[9],x=e[10],E=e[11],_=e[12],p=e[13],R=e[14],g=e[15],T=r[0],M=r[1],I=r[2],S=r[3];return t[0]=T*n+M*o+I*m+S*_,t[1]=T*s+M*c+I*y+S*p,t[2]=T*i+M*u+I*x+S*R,t[3]=T*a+M*h+I*E+S*g,t[4]=(T=r[4])*n+(M=r[5])*o+(I=r[6])*m+(S=r[7])*_,t[5]=T*s+M*c+I*y+S*p,t[6]=T*i+M*u+I*x+S*R,t[7]=T*a+M*h+I*E+S*g,t[8]=(T=r[8])*n+(M=r[9])*o+(I=r[10])*m+(S=r[11])*_,t[9]=T*s+M*c+I*y+S*p,t[10]=T*i+M*u+I*x+S*R,t[11]=T*a+M*h+I*E+S*g,t[12]=(T=r[12])*n+(M=r[13])*o+(I=r[14])*m+(S=r[15])*_,t[13]=T*s+M*c+I*y+S*p,t[14]=T*i+M*u+I*x+S*R,t[15]=T*a+M*h+I*E+S*g,t}qn=Gt,Gt.Verbosity=ts,Gt.DEFAULT_INSTANCE=new qn(qn.Verbosity.INFO);let we=class rs{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return rs.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return rs.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let i=Gn([e[0],e[1],e[2]]);const a=Gn([e[4],e[5],e[6]]),o=Gn([e[8],e[9],e[10]]);var c,u,h,m,y,x,E,_,p,R,g,T,M,I,S,L,F;((u=(c=e)[0])*(E=c[5])-(h=c[1])*(x=c[4]))*((T=c[10])*(F=c[15])-(M=c[11])*(L=c[14]))-(u*(_=c[6])-(m=c[2])*x)*((g=c[9])*F-M*(S=c[13]))+(u*(p=c[7])-(y=c[3])*x)*(g*L-T*S)+(h*_-m*E)*((R=c[8])*F-M*(I=c[12]))-(h*p-y*E)*(R*L-T*I)+(m*p-y*_)*(R*S-g*I)<0&&(i=-i),r[0]=e[12],r[1]=e[13],r[2]=e[14];const $=e.slice(),z=1/i,j=1/a,H=1/o;$[0]*=z,$[1]*=z,$[2]*=z,$[4]*=j,$[5]*=j,$[6]*=j,$[8]*=H,$[9]*=H,$[10]*=H,function(V,U){var X=new Qn(3);(function(We,qe){var Mt=qe[4],at=qe[5],Et=qe[6],Yt=qe[8],jr=qe[9],In=qe[10];We[0]=Math.hypot(qe[0],qe[1],qe[2]),We[1]=Math.hypot(Mt,at,Et),We[2]=Math.hypot(Yt,jr,In)})(X,U);var se=1/X[0],Z=1/X[1],le=1/X[2],oe=U[0]*se,fe=U[1]*Z,ue=U[2]*le,de=U[4]*se,Ce=U[5]*Z,me=U[6]*le,Me=U[8]*se,Ne=U[9]*Z,Ve=U[10]*le,xt=oe+Ce+Ve,ve=0;xt>0?(ve=2*Math.sqrt(xt+1),V[3]=.25*ve,V[0]=(me-Ne)/ve,V[1]=(Me-ue)/ve,V[2]=(fe-de)/ve):oe>Ce&&oe>Ve?(ve=2*Math.sqrt(1+oe-Ce-Ve),V[3]=(me-Ne)/ve,V[0]=.25*ve,V[1]=(fe+de)/ve,V[2]=(Me+ue)/ve):Ce>Ve?(ve=2*Math.sqrt(1+Ce-oe-Ve),V[3]=(Me-ue)/ve,V[0]=(fe+de)/ve,V[1]=.25*ve,V[2]=(me+Ne)/ve):(ve=2*Math.sqrt(1+Ve-oe-Ce),V[3]=(fe-de)/ve,V[0]=(Me+ue)/ve,V[1]=(me+Ne)/ve,V[2]=.25*ve)}(n,$),s[0]=i,s[1]=a,s[2]=o}static compose(e,r,n,s){const i=s,a=r[0],o=r[1],c=r[2],u=r[3],h=a+a,m=o+o,y=c+c,x=a*h,E=a*m,_=a*y,p=o*m,R=o*y,g=c*y,T=u*h,M=u*m,I=u*y,S=n[0],L=n[1],F=n[2];return i[0]=(1-(p+g))*S,i[1]=(E+I)*S,i[2]=(_-M)*S,i[3]=0,i[4]=(E-I)*L,i[5]=(1-(x+g))*L,i[6]=(R+T)*L,i[7]=0,i[8]=(_+M)*F,i[9]=(R-T)*F,i[10]=(1-(x+p))*F,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}};function Mu(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function Eu(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function wu(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const i=t[s],a=e[s];if(!!i!=!!a)return!1;const o=i.getChild(),c=a.getChild();if(o!==c&&!o.equals(c))return!1}return!0}function oa(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ca(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!jt(t)||!jt(e))return t===e;const r=t,n=e;let s,i=0,a=0;for(s in r)i++;for(s in n)a++;if(i!==a)return!1;for(s in r){const o=r[s],c=n[s];if(hn(o)&&hn(c)){if(!oa(o,c))return!1}else if(jt(o)&&jt(c)){if(!ca(o,c))return!1}else if(o!==c)return!1}return!0}function hn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Si=new Set,Ru=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},_u=function(){for(let t=0;t<999;t++){const e=Ru();if(!Si.has(e))return Si.add(e),e}return""},Ci="https://null.example";let Nr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return lr.basename(new URL(e,Ci).pathname)}static extension(e){return lr.extension(new URL(e,Ci).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let i=0;i<s.length;i++)s[i]!=="."&&(s[i]===".."?n.pop():n.push(s[i]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};Nr.DEFAULT_INIT={},Nr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const yt=t=>t,Iu=new Set;let vs=class extends ms{constructor(e,r=""){super(e),this[he].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,yt)}copy(e,r=yt){for(const n in this[he]){const s=this[he][n];if(s instanceof or)this[nr].has(n)||s.dispose();else if(Rr(s))for(const i of s)i.dispose();else if(_r(s))for(const i in s)s[i].dispose()}for(const n in e[he]){const s=this[he][n],i=e[he][n];if(i instanceof or)this[nr].has(n)?s.getChild().copy(r(i.getChild()),r):this.setRef(n,r(i.getChild()),i.getAttributes());else if(Rr(i))for(const a of i)this.addRef(n,r(a.getChild()),a.getAttributes());else if(_r(i))for(const a in i){const o=i[a];this.setRefMap(n,a,r(o.getChild()),o.getAttributes())}else this[he][n]=jt(i)?JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.slice():i}return this}equals(e,r=Iu){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[he]){if(r.has(n))continue;const s=this[he][n],i=e[he][n];if(Zn(s)||Zn(i)){if(!Mu(s,i))return!1}else if(Rr(s)||Rr(i)){if(!Eu(s,i))return!1}else if(_r(s)||_r(i)){if(!wu(s,i))return!1}else if(jt(s)||jt(i)){if(!ca(s,i))return!1}else if(hn(s)||hn(i)){if(!oa(s,i))return!1}else if(s!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Ge=class extends vs{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},Y=class xe extends Ge{constructor(...e){super(...e),this.i=we.identity,this.o=we.identity}init(){this.propertyType=q.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:xe.Type.SCALAR,componentType:xe.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=yt){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case xe.Type.SCALAR:return 1;case xe.Type.VEC2:return 2;case xe.Type.VEC3:return 3;case xe.Type.VEC4:case xe.Type.MAT2:return 4;case xe.Type.MAT3:return 9;case xe.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case xe.ComponentType.BYTE:case xe.ComponentType.UNSIGNED_BYTE:return 1;case xe.ComponentType.SHORT:case xe.ComponentType.UNSIGNED_SHORT:return 2;case xe.ComponentType.UNSIGNED_INT:case xe.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=-1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return xe.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>we.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>we.encodeNormalizedInt(r,this.get("componentType"))):(this.o=we.identity,this.i=we.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let i=0;i<n;i++)r[i]=this.o(s[e*n+i]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let i=0;i<n;i++)s[e*n+i]=this.i(r[i]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return xe.ComponentType.FLOAT;case Uint32Array:return xe.ComponentType.UNSIGNED_INT;case Uint16Array:return xe.ComponentType.UNSIGNED_SHORT;case Uint8Array:return xe.ComponentType.UNSIGNED_BYTE;case Int16Array:return xe.ComponentType.SHORT;case Int8Array:return xe.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):xe.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};Y.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Y.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let la=class extends Ge{init(){this.propertyType=q.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},ys=class extends Ge{init(){this.propertyType=q.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};ys.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let En=class fa extends Ge{init(){this.propertyType=q.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:fa.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Je.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Je.OTHER})}};En.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let ua=class extends Ge{init(){this.propertyType=q.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},Vr=class ha extends Ge{init(){this.propertyType=q.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:ha.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Vr.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let Se=class extends vs{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};Se.EXTENSION_NAME=void 0;let Re=class ns extends Ge{init(){this.propertyType=q.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:ns.WrapMode.REPEAT,wrapT:ns.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};Re.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Re.MagFilter={NEAREST:9728,LINEAR:9729},Re.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Qr,G:en,B:tn,A:Au}=it;let fr=class pa extends Ge{init(){this.propertyType=q.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:pa.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Re(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Re(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Re(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Re(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Re(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return He.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",He.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Qr|en|tn|Au,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return He.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",He.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Qr|en|tn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Qr|en|tn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Qr})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:en|tn})}};fr.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let da=class extends Ge{init(){this.propertyType=q.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},ga=class extends Ge{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=q.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=yt){if(r===yt)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return we.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return we.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return we.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return we.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return we.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)Tu(n,n,r.getMatrix());return n}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const n of e.h)n.removeChild(e);this.addRef("children",e),e.u=this;const r=this[he].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===q.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},Pr=class ma extends Ge{init(){this.propertyType=q.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:ma.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Je.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Je.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};Pr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let bu=class extends vs{init(){this.propertyType=q.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Je.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function ze(){return ze=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ze.apply(this,arguments)}let va=class extends Ge{init(){this.propertyType=q.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=yt){if(r===yt)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const r=this[he].children;return r[r.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},ya=class extends Ge{init(){this.propertyType=q.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Je.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},xa=class extends Ge{init(){this.propertyType=q.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ht.extensionToMimeType(lr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=ht.extensionToMimeType(lr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Q.assertView(e))}getSize(){const e=this.get("image");return e?ht.getSize(e,this.getMimeType()):null}},Ta=class extends Ge{init(){this.propertyType=q.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${sa}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",r=>{this.g(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=yt){if(r===yt)throw new Error("Root cannot be copied.");this.set("asset",ze({},e.get("asset"))),this.setName(e.getName()),this.setExtras(ze({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}g(e){return e instanceof va?this.addRef("scenes",e):e instanceof ga?this.addRef("nodes",e):e instanceof Vr?this.addRef("cameras",e):e instanceof ya?this.addRef("skins",e):e instanceof da?this.addRef("meshes",e):e instanceof fr?this.addRef("materials",e):e instanceof xa?this.addRef("textures",e):e instanceof la?this.addRef("animations",e):e instanceof Y?this.addRef("accessors",e):e instanceof ua&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},xs=class sn{static fromGraph(e){return sn.v.get(e)||null}constructor(){this.T=new pu,this.S=new Ta(this.T),this.M=Gt.DEFAULT_INSTANCE,sn.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new sn().setLogger(this.M).merge(this)}merge(e){for(const i of e.getRoot().listExtensionsUsed()){const a=this.createExtension(i.constructor);i.isRequired()&&a.setRequired(!0)}const r=new Set,n=new Map;r.add(e.S),n.set(e.S,this.S);for(const i of e.T.listEdges())for(const a of[i.getParent(),i.getChild()]){if(r.has(a))continue;let o;o=a.propertyType===q.TEXTURE_INFO?a:new a.constructor(this.T),n.set(a,o),r.add(a)}const s=i=>{const a=n.get(i);if(!a)throw new Error("Could resolve property.");return a};for(const i of r){const a=n.get(i);if(!a)throw new Error("Could resolve property.");a.propertyType!==q.TEXTURE_INFO&&a.copy(i,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new va(this.T,e)}createNode(e=""){return new ga(this.T,e)}createCamera(e=""){return new Vr(this.T,e)}createSkin(e=""){return new ya(this.T,e)}createMesh(e=""){return new da(this.T,e)}createPrimitive(){return new Pr(this.T)}createPrimitiveTarget(e=""){return new bu(this.T,e)}createMaterial(e=""){return new fr(this.T,e)}createTexture(e=""){return new xa(this.T,e)}createAnimation(e=""){return new la(this.T,e)}createAnimationChannel(e=""){return new ys(this.T,e)}createAnimationSampler(e=""){return new En(this.T,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new Y(this.T,e).setBuffer(r)}createBuffer(e=""){return new ua(this.T,e)}};xs.v=new WeakMap;let Te=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=e,e.getRoot().p(this),this.I=n=>{const s=n,i=s.target;i instanceof Se&&i.extensionName===this.extensionName&&(s.type==="node:create"&&this.N(i),s.type==="node:dispose"&&this.O(i))};const r=e.getGraph();r.addEventListener("node:create",this.I),r.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.I),e.removeEventListener("node:dispose",this.I);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}N(e){return this.properties.add(e),this}O(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};Te.EXTENSION_NAME=void 0;let Su=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const Ni={logger:Gt.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let Cu=class{static read(e,r=Ni){const n=ze({},Ni,r),{json:s}=e,i=new xs().setLogger(n.logger);this.validate(e,n);const a=new Su(e),o=s.asset,c=i.getRoot().getAsset();o.copyright&&(c.copyright=o.copyright),o.extras&&(c.extras=o.extras),s.extras!==void 0&&i.getRoot().setExtras(ze({},s.extras));const u=s.extensionsUsed||[],h=s.extensionsRequired||[];for(const g of n.extensions)if(u.includes(g.EXTENSION_NAME)){const T=i.createExtension(g).setRequired(h.includes(g.EXTENSION_NAME));for(const M of T.readDependencies)T.install(M,n.dependencies[M])}const m=s.buffers||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.BUFFER)).forEach(g=>g.preread(a,q.BUFFER)),a.buffers=m.map(g=>{const T=i.createBuffer(g.name);return g.extras&&T.setExtras(g.extras),g.uri&&g.uri.indexOf("__")!==0&&T.setURI(g.uri),T}),a.bufferViewBuffers=(s.bufferViews||[]).map((g,T)=>{if(!a.bufferViews[T]){const M=e.json.buffers[g.buffer];a.bufferViews[T]=Q.toView(M.uri?e.resources[M.uri]:e.resources[cr],g.byteOffset||0,g.byteLength)}return a.buffers[g.buffer]});const y=s.accessors||[];a.accessors=y.map(g=>{const T=i.createAccessor(g.name,a.bufferViewBuffers[g.bufferView]).setType(g.type);return g.extras&&T.setExtras(g.extras),g.normalized!==void 0&&T.setNormalized(g.normalized),g.bufferView===void 0||T.setArray(rn(g,a)),T});const x=s.images||[],E=s.textures||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.TEXTURE)).forEach(g=>g.preread(a,q.TEXTURE)),a.textures=x.map(g=>{const T=i.createTexture(g.name);if(g.extras&&T.setExtras(g.extras),g.bufferView!==void 0){const M=s.bufferViews[g.bufferView],I=e.json.buffers[M.buffer],S=M.byteOffset||0,L=(I.uri?e.resources[I.uri]:e.resources[cr]).slice(S,S+M.byteLength);T.setImage(L)}else g.uri!==void 0&&(T.setImage(e.resources[g.uri]),g.uri.indexOf("__")!==0&&T.setURI(g.uri));if(g.mimeType!==void 0)T.setMimeType(g.mimeType);else if(g.uri){const M=lr.extension(g.uri);T.setMimeType(ht.extensionToMimeType(M))}return T}),a.materials=(s.materials||[]).map(g=>{const T=i.createMaterial(g.name);g.extras&&T.setExtras(g.extras),g.alphaMode!==void 0&&T.setAlphaMode(g.alphaMode),g.alphaCutoff!==void 0&&T.setAlphaCutoff(g.alphaCutoff),g.doubleSided!==void 0&&T.setDoubleSided(g.doubleSided);const M=g.pbrMetallicRoughness||{};if(M.baseColorFactor!==void 0&&T.setBaseColorFactor(M.baseColorFactor),g.emissiveFactor!==void 0&&T.setEmissiveFactor(g.emissiveFactor),M.metallicFactor!==void 0&&T.setMetallicFactor(M.metallicFactor),M.roughnessFactor!==void 0&&T.setRoughnessFactor(M.roughnessFactor),M.baseColorTexture!==void 0){const I=M.baseColorTexture;T.setBaseColorTexture(a.textures[E[I.index].source]),a.setTextureInfo(T.getBaseColorTextureInfo(),I)}if(g.emissiveTexture!==void 0){const I=g.emissiveTexture;T.setEmissiveTexture(a.textures[E[I.index].source]),a.setTextureInfo(T.getEmissiveTextureInfo(),I)}if(g.normalTexture!==void 0){const I=g.normalTexture;T.setNormalTexture(a.textures[E[I.index].source]),a.setTextureInfo(T.getNormalTextureInfo(),I),g.normalTexture.scale!==void 0&&T.setNormalScale(g.normalTexture.scale)}if(g.occlusionTexture!==void 0){const I=g.occlusionTexture;T.setOcclusionTexture(a.textures[E[I.index].source]),a.setTextureInfo(T.getOcclusionTextureInfo(),I),g.occlusionTexture.strength!==void 0&&T.setOcclusionStrength(g.occlusionTexture.strength)}if(M.metallicRoughnessTexture!==void 0){const I=M.metallicRoughnessTexture;T.setMetallicRoughnessTexture(a.textures[E[I.index].source]),a.setTextureInfo(T.getMetallicRoughnessTextureInfo(),I)}return T});const _=s.meshes||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.PRIMITIVE)).forEach(g=>g.preread(a,q.PRIMITIVE)),a.meshes=_.map(g=>{const T=i.createMesh(g.name);return g.extras&&T.setExtras(g.extras),g.weights!==void 0&&T.setWeights(g.weights),(g.primitives||[]).forEach(M=>{const I=i.createPrimitive();M.extras&&I.setExtras(M.extras),M.material!==void 0&&I.setMaterial(a.materials[M.material]),M.mode!==void 0&&I.setMode(M.mode);for(const[L,F]of Object.entries(M.attributes||{}))I.setAttribute(L,a.accessors[F]);M.indices!==void 0&&I.setIndices(a.accessors[M.indices]);const S=g.extras&&g.extras.targetNames||[];(M.targets||[]).forEach((L,F)=>{const $=S[F]||F.toString(),z=i.createPrimitiveTarget($);for(const[j,H]of Object.entries(L))z.setAttribute(j,a.accessors[H]);I.addTarget(z)}),T.addPrimitive(I)}),T}),a.cameras=(s.cameras||[]).map(g=>{const T=i.createCamera(g.name).setType(g.type);if(g.extras&&T.setExtras(g.extras),g.type===Vr.Type.PERSPECTIVE){const M=g.perspective;T.setYFov(M.yfov),T.setZNear(M.znear),M.zfar!==void 0&&T.setZFar(M.zfar),M.aspectRatio!==void 0&&T.setAspectRatio(M.aspectRatio)}else{const M=g.orthographic;T.setZNear(M.znear).setZFar(M.zfar).setXMag(M.xmag).setYMag(M.ymag)}return T});const p=s.nodes||[];i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.NODE)).forEach(g=>g.preread(a,q.NODE)),a.nodes=p.map(g=>{const T=i.createNode(g.name);if(g.extras&&T.setExtras(g.extras),g.translation!==void 0&&T.setTranslation(g.translation),g.rotation!==void 0&&T.setRotation(g.rotation),g.scale!==void 0&&T.setScale(g.scale),g.matrix!==void 0){const M=[0,0,0],I=[0,0,0,1],S=[1,1,1];we.decompose(g.matrix,M,I,S),T.setTranslation(M),T.setRotation(I),T.setScale(S)}return g.weights!==void 0&&T.setWeights(g.weights),T}),a.skins=(s.skins||[]).map(g=>{const T=i.createSkin(g.name);g.extras&&T.setExtras(g.extras),g.inverseBindMatrices!==void 0&&T.setInverseBindMatrices(a.accessors[g.inverseBindMatrices]),g.skeleton!==void 0&&T.setSkeleton(a.nodes[g.skeleton]);for(const M of g.joints)T.addJoint(a.nodes[M]);return T}),p.map((g,T)=>{const M=a.nodes[T];(g.children||[]).forEach(I=>M.addChild(a.nodes[I])),g.mesh!==void 0&&M.setMesh(a.meshes[g.mesh]),g.camera!==void 0&&M.setCamera(a.cameras[g.camera]),g.skin!==void 0&&M.setSkin(a.skins[g.skin])}),a.animations=(s.animations||[]).map(g=>{const T=i.createAnimation(g.name);g.extras&&T.setExtras(g.extras);const M=(g.samplers||[]).map(I=>{const S=i.createAnimationSampler().setInput(a.accessors[I.input]).setOutput(a.accessors[I.output]).setInterpolation(I.interpolation||En.Interpolation.LINEAR);return I.extras&&S.setExtras(I.extras),T.addSampler(S),S});return(g.channels||[]).forEach(I=>{const S=i.createAnimationChannel().setSampler(M[I.sampler]).setTargetPath(I.target.path);I.target.node!==void 0&&S.setTargetNode(a.nodes[I.target.node]),I.extras&&S.setExtras(I.extras),T.addChannel(S)}),T});const R=s.scenes||[];return i.getRoot().listExtensionsUsed().filter(g=>g.prereadTypes.includes(q.SCENE)).forEach(g=>g.preread(a,q.SCENE)),a.scenes=R.map(g=>{const T=i.createScene(g.name);return g.extras&&T.setExtras(g.extras),(g.nodes||[]).map(M=>a.nodes[M]).forEach(M=>T.addChild(M)),T}),s.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[s.scene]),i.getRoot().listExtensionsUsed().forEach(g=>g.read(a)),y.forEach((g,T)=>{const M=a.accessors[T],I=!!g.sparse,S=!g.bufferView&&!M.getArray();(I||S)&&M.setSparse(!0).setArray(function(L,F){const $=un[L.componentType],z=Y.getElementSize(L.type);let j;j=L.bufferView!==void 0?rn(L,F):new $(L.count*z);const H=L.sparse;if(!H)return j;const V=H.count,U=ze({},L,H.indices,{count:V,type:"SCALAR"}),X=ze({},L,H.values,{count:V}),se=rn(U,F),Z=rn(X,F);for(let le=0;le<U.count;le++)for(let oe=0;oe<z;oe++)j[se[le]*z+oe]=Z[le*z+oe];return j}(g,a))}),i}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(i=>i.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(i=>i.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function rn(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=un[t.componentType],i=Y.getElementSize(t.type),a=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==i*a)return function(c,u){const h=u.bufferViews[c.bufferView],m=u.jsonDoc.json.bufferViews[c.bufferView],y=un[c.componentType],x=Y.getElementSize(c.type),E=y.BYTES_PER_ELEMENT,_=c.byteOffset||0,p=new y(c.count*x),R=new DataView(h.buffer,h.byteOffset,h.byteLength),g=m.byteStride;for(let T=0;T<c.count;T++)for(let M=0;M<x;M++){const I=_+T*g+M*E;let S;switch(c.componentType){case Y.ComponentType.FLOAT:S=R.getFloat32(I,!0);break;case Y.ComponentType.UNSIGNED_INT:S=R.getUint32(I,!0);break;case Y.ComponentType.UNSIGNED_SHORT:S=R.getUint16(I,!0);break;case Y.ComponentType.UNSIGNED_BYTE:S=R.getUint8(I);break;case Y.ComponentType.SHORT:S=R.getInt16(I,!0);break;case Y.ComponentType.BYTE:S=R.getInt8(I);break;default:throw new Error(`Unexpected componentType "${c.componentType}".`)}p[T*x+M]=S}return p}(t,e);const o=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(o,o+t.count*i*a))}var Or;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Or||(Or={}));let st=class{constructor(e,r,n){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),i=s.listBuffers().length,a=s.listTextures().length;this.bufferURIGenerator=new Oi(i>1,()=>n.basename||"buffer"),this.imageURIGenerator=new Oi(a>1,o=>function(c,u){const h=c.getGraph().listParentEdges(u).find(m=>m.getParent()!==c.getRoot());return h?h.getName().replace(/texture$/i,""):""}(e,o)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return r.getTexCoord()!==0&&(o.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(o.extras=r.getExtras()),this.textureInfoDefMap.set(r,o),o}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===zt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=ht.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.F.get(e);if(r)return r;if(e.getSparse())return Je.SPARSE;for(const n of this.C.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==q.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Je.OTHER}addAccessorToUsageGroup(e,r){const n=this.F.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.F.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.F.entries()))e[n]=e[n]||[],e[n].push(r);return e}};st.BufferViewTarget=Or,st.BufferViewUsage=Je,st.USAGE_TO_TARGET={[Je.ARRAY_BUFFER]:Or.ARRAY_BUFFER,[Je.ELEMENT_ARRAY_BUFFER]:Or.ELEMENT_ARRAY_BUFFER};let Oi=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:nn}=st,{UNSIGNED_INT:Nu,UNSIGNED_SHORT:Ou,UNSIGNED_BYTE:$u}=Y.ComponentType;let Fu=class{static write(e,r){const n=e.getRoot(),s={asset:ze({generator:`glTF-Transform ${sa}`},n.getAsset()),extras:ze({},n.getExtras())},i={json:s,resources:{}},a=new st(e,i,r),o=r.logger||Gt.DEFAULT_INSTANCE,c=new Set(r.extensions.map(p=>p.EXTENSION_NAME)),u=e.getRoot().listExtensionsUsed().filter(p=>c.has(p.extensionName)),h=e.getRoot().listExtensionsRequired().filter(p=>c.has(p.extensionName));u.length<e.getRoot().listExtensionsUsed().length&&o.warn("Some extensions were not registered for I/O, and will not be written.");for(const p of u)for(const R of p.writeDependencies)p.install(R,r.dependencies[R]);function m(p,R,g,T){const M=[];let I=0;for(const L of p){const F=a.createAccessorDef(L);F.bufferView=s.bufferViews.length;const $=L.getArray(),z=Q.pad(Q.toView($));F.byteOffset=I,I+=z.byteLength,M.push(z),a.accessorIndexMap.set(L,s.accessors.length),s.accessors.push(F)}const S={buffer:R,byteOffset:g,byteLength:Q.concat(M).byteLength};return T&&(S.target=T),s.bufferViews.push(S),{buffers:M,byteLength:I}}function y(p,R,g){const T=p[0].getCount();let M=0;for(const F of p){const $=a.createAccessorDef(F);$.bufferView=s.bufferViews.length,$.byteOffset=M;const z=F.getElementSize(),j=F.getComponentSize();M+=Q.padNumber(z*j),a.accessorIndexMap.set(F,s.accessors.length),s.accessors.push($)}const I=T*M,S=new ArrayBuffer(I),L=new DataView(S);for(let F=0;F<T;F++){let $=0;for(const z of p){const j=z.getElementSize(),H=z.getComponentSize(),V=z.getComponentType(),U=z.getArray();for(let X=0;X<j;X++){const se=F*M+$+X*H,Z=U[F*j+X];switch(V){case Y.ComponentType.FLOAT:L.setFloat32(se,Z,!0);break;case Y.ComponentType.BYTE:L.setInt8(se,Z);break;case Y.ComponentType.SHORT:L.setInt16(se,Z,!0);break;case Y.ComponentType.UNSIGNED_BYTE:L.setUint8(se,Z);break;case Y.ComponentType.UNSIGNED_SHORT:L.setUint16(se,Z,!0);break;case Y.ComponentType.UNSIGNED_INT:L.setUint32(se,Z,!0);break;default:throw new Error("Unexpected component type: "+V)}}$+=Q.padNumber(j*H)}}return s.bufferViews.push({buffer:R,byteOffset:g,byteLength:I,byteStride:M,target:st.BufferViewTarget.ARRAY_BUFFER}),{byteLength:I,buffers:[new Uint8Array(S)]}}function x(p,R,g){const T=[];let M=0;const I=new Map;let S=-1/0;for(const V of p){const U=a.createAccessorDef(V);s.accessors.push(U),a.accessorIndexMap.set(V,s.accessors.length-1);const X=[],se=[],Z=[],le=new Array(V.getElementSize()).fill(0);for(let de=0,Ce=V.getCount();de<Ce;de++)if(V.getElement(de,Z),!we.eq(Z,le,0)){S=Math.max(de,S),X.push(de);for(let me=0;me<Z.length;me++)se.push(Z[me])}const oe=X.length,fe={accessorDef:U,count:oe};if(I.set(V,fe),oe===0)continue;if(oe>V.getCount()/3){const de=(100*X.length/V.getCount()).toFixed(1);o.warn(`Sparse accessor with many non-zero elements (${de}%) may increase file size.`)}const ue=un[V.getComponentType()];fe.indices=X,fe.values=new ue(se)}if(!Number.isFinite(S))return{buffers:T,byteLength:M};const L=S<255?Uint8Array:S<65535?Uint16Array:Uint32Array,F=S<255?$u:S<65535?Ou:Nu,$={buffer:R,byteOffset:g+M,byteLength:0};for(const V of p){const U=I.get(V);if(U.count===0)continue;U.indicesByteOffset=$.byteLength;const X=Q.pad(Q.toView(new L(U.indices)));T.push(X),M+=X.byteLength,$.byteLength+=X.byteLength}s.bufferViews.push($);const z=s.bufferViews.length-1,j={buffer:R,byteOffset:g+M,byteLength:0};for(const V of p){const U=I.get(V);if(U.count===0)continue;U.valuesByteOffset=j.byteLength;const X=Q.pad(Q.toView(U.values));T.push(X),M+=X.byteLength,j.byteLength+=X.byteLength}s.bufferViews.push(j);const H=s.bufferViews.length-1;for(const V of p){const U=I.get(V);U.count!==0&&(U.accessorDef.sparse={count:U.count,indices:{bufferView:z,byteOffset:U.indicesByteOffset,componentType:F},values:{bufferView:H,byteOffset:U.valuesByteOffset}})}return{buffers:T,byteLength:M}}const E=new Map;for(const p of e.getGraph().listEdges()){if(p.getParent()===n)continue;const R=p.getChild();if(R instanceof Y){const g=E.get(R)||[];g.push(p),E.set(R,g)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((p,R)=>{const g=a.createPropertyDef(p);p.getMimeType()&&(g.mimeType=p.getMimeType());const T=p.getImage();return T&&a.createImageData(g,T,p),a.imageIndexMap.set(p,R),g}),u.filter(p=>p.prewriteTypes.includes(q.ACCESSOR)).forEach(p=>p.prewrite(a,q.ACCESSOR)),n.listAccessors().forEach(p=>{const R=a.accessorUsageGroupedByParent,g=a.accessorParents;if(a.accessorIndexMap.has(p))return;const T=E.get(p)||[],M=a.getAccessorUsage(p);if(a.addAccessorToUsageGroup(p,M),R.has(M)){const I=T[0].getParent(),S=g.get(I)||new Set;S.add(p),g.set(I,S)}}),u.filter(p=>p.prewriteTypes.includes(q.BUFFER)).forEach(p=>p.prewrite(a,q.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||a.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((p,R)=>{const g=a.createPropertyDef(p),T=a.accessorUsageGroupedByParent,M=a.accessorParents,I=p.listParents().filter(j=>j instanceof Y),S=new Set(I),L=[],F=s.buffers.length;let $=0;const z=a.listAccessorUsageGroups();for(const j in z)if(T.has(j))for(const H of Array.from(M.values())){const V=Array.from(H).filter(U=>S.has(U)).filter(U=>a.getAccessorUsage(U)===j);if(V.length)if(j!==nn.ARRAY_BUFFER||r.vertexLayout===fn.INTERLEAVED){const U=j===nn.ARRAY_BUFFER?y(V,F,$):m(V,F,$);$+=U.byteLength,L.push(...U.buffers)}else for(const U of V){const X=y([U],F,$);$+=X.byteLength,L.push(...X.buffers)}}else{const H=z[j].filter(X=>S.has(X));if(!H.length)continue;const V=j===nn.ELEMENT_ARRAY_BUFFER?st.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,U=j===nn.SPARSE?x(H,F,$):m(H,F,$,V);$+=U.byteLength,L.push(...U.buffers)}if(a.imageBufferViews.length&&R===0){for(let j=0;j<a.imageBufferViews.length;j++)if(s.bufferViews[s.images[j].bufferView].byteOffset=$,$+=a.imageBufferViews[j].byteLength,L.push(a.imageBufferViews[j]),$%8){const H=8-$%8;$+=H,L.push(new Uint8Array(H))}}if(a.otherBufferViews.has(p))for(const j of a.otherBufferViews.get(p))s.bufferViews.push({buffer:F,byteOffset:$,byteLength:j.byteLength}),a.otherBufferViewsIndexMap.set(j,s.bufferViews.length-1),$+=j.byteLength,L.push(j);if($){let j;r.format===zt.GLB?j=cr:(j=a.bufferURIGenerator.createURI(p,"bin"),g.uri=j),g.byteLength=$,i.resources[j]=Q.concat(L)}s.buffers.push(g),a.bufferIndexMap.set(p,R)}),n.listAccessors().find(p=>!p.getBuffer())&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((p,R)=>{const g=a.createPropertyDef(p);if(p.getAlphaMode()!==fr.AlphaMode.OPAQUE&&(g.alphaMode=p.getAlphaMode()),p.getAlphaMode()===fr.AlphaMode.MASK&&(g.alphaCutoff=p.getAlphaCutoff()),p.getDoubleSided()&&(g.doubleSided=!0),g.pbrMetallicRoughness={},we.eq(p.getBaseColorFactor(),[1,1,1,1])||(g.pbrMetallicRoughness.baseColorFactor=p.getBaseColorFactor()),we.eq(p.getEmissiveFactor(),[0,0,0])||(g.emissiveFactor=p.getEmissiveFactor()),p.getRoughnessFactor()!==1&&(g.pbrMetallicRoughness.roughnessFactor=p.getRoughnessFactor()),p.getMetallicFactor()!==1&&(g.pbrMetallicRoughness.metallicFactor=p.getMetallicFactor()),p.getBaseColorTexture()){const T=p.getBaseColorTexture(),M=p.getBaseColorTextureInfo();g.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(T,M)}if(p.getEmissiveTexture()){const T=p.getEmissiveTexture(),M=p.getEmissiveTextureInfo();g.emissiveTexture=a.createTextureInfoDef(T,M)}if(p.getNormalTexture()){const T=p.getNormalTexture(),M=p.getNormalTextureInfo(),I=a.createTextureInfoDef(T,M);p.getNormalScale()!==1&&(I.scale=p.getNormalScale()),g.normalTexture=I}if(p.getOcclusionTexture()){const T=p.getOcclusionTexture(),M=p.getOcclusionTextureInfo(),I=a.createTextureInfoDef(T,M);p.getOcclusionStrength()!==1&&(I.strength=p.getOcclusionStrength()),g.occlusionTexture=I}if(p.getMetallicRoughnessTexture()){const T=p.getMetallicRoughnessTexture(),M=p.getMetallicRoughnessTextureInfo();g.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(T,M)}return a.materialIndexMap.set(p,R),g}),s.meshes=n.listMeshes().map((p,R)=>{const g=a.createPropertyDef(p);let T=null;return g.primitives=p.listPrimitives().map(M=>{const I={attributes:{}};I.mode=M.getMode();const S=M.getMaterial();S&&(I.material=a.materialIndexMap.get(S)),Object.keys(M.getExtras()).length&&(I.extras=M.getExtras());const L=M.getIndices();L&&(I.indices=a.accessorIndexMap.get(L));for(const F of M.listSemantics())I.attributes[F]=a.accessorIndexMap.get(M.getAttribute(F));for(const F of M.listTargets()){const $={};for(const z of F.listSemantics())$[z]=a.accessorIndexMap.get(F.getAttribute(z));I.targets=I.targets||[],I.targets.push($)}return M.listTargets().length&&!T&&(T=M.listTargets().map(F=>F.getName())),I}),p.getWeights().length&&(g.weights=p.getWeights()),T&&(g.extras=g.extras||{},g.extras.targetNames=T),a.meshIndexMap.set(p,R),g}),s.cameras=n.listCameras().map((p,R)=>{const g=a.createPropertyDef(p);if(g.type=p.getType(),g.type===Vr.Type.PERSPECTIVE){g.perspective={znear:p.getZNear(),zfar:p.getZFar(),yfov:p.getYFov()};const T=p.getAspectRatio();T!==null&&(g.perspective.aspectRatio=T)}else g.orthographic={znear:p.getZNear(),zfar:p.getZFar(),xmag:p.getXMag(),ymag:p.getYMag()};return a.cameraIndexMap.set(p,R),g}),s.nodes=n.listNodes().map((p,R)=>{const g=a.createPropertyDef(p);return we.eq(p.getTranslation(),[0,0,0])||(g.translation=p.getTranslation()),we.eq(p.getRotation(),[0,0,0,1])||(g.rotation=p.getRotation()),we.eq(p.getScale(),[1,1,1])||(g.scale=p.getScale()),p.getWeights().length&&(g.weights=p.getWeights()),a.nodeIndexMap.set(p,R),g}),s.skins=n.listSkins().map((p,R)=>{const g=a.createPropertyDef(p),T=p.getInverseBindMatrices();T&&(g.inverseBindMatrices=a.accessorIndexMap.get(T));const M=p.getSkeleton();return M&&(g.skeleton=a.nodeIndexMap.get(M)),g.joints=p.listJoints().map(I=>a.nodeIndexMap.get(I)),a.skinIndexMap.set(p,R),g}),n.listNodes().forEach((p,R)=>{const g=s.nodes[R],T=p.getMesh();T&&(g.mesh=a.meshIndexMap.get(T));const M=p.getCamera();M&&(g.camera=a.cameraIndexMap.get(M));const I=p.getSkin();I&&(g.skin=a.skinIndexMap.get(I)),p.listChildren().length>0&&(g.children=p.listChildren().map(S=>a.nodeIndexMap.get(S)))}),s.animations=n.listAnimations().map((p,R)=>{const g=a.createPropertyDef(p),T=new Map;return g.samplers=p.listSamplers().map((M,I)=>{const S=a.createPropertyDef(M);return S.input=a.accessorIndexMap.get(M.getInput()),S.output=a.accessorIndexMap.get(M.getOutput()),S.interpolation=M.getInterpolation(),T.set(M,I),S}),g.channels=p.listChannels().map(M=>{const I=a.createPropertyDef(M);return I.sampler=T.get(M.getSampler()),I.target={node:a.nodeIndexMap.get(M.getTargetNode()),path:M.getTargetPath()},I}),a.animationIndexMap.set(p,R),g}),s.scenes=n.listScenes().map((p,R)=>{const g=a.createPropertyDef(p);return g.nodes=p.listChildren().map(T=>a.nodeIndexMap.get(T)),a.sceneIndexMap.set(p,R),g});const _=n.getDefaultScene();return _&&(s.scene=n.listScenes().indexOf(_)),s.extensionsUsed=u.map(p=>p.extensionName),s.extensionsRequired=h.map(p=>p.extensionName),u.forEach(p=>p.write(a)),function(p){const R=[];for(const g in p){const T=p[g];(Array.isArray(T)&&T.length===0||T===null||T===""||T&&typeof T=="object"&&Object.keys(T).length===0)&&R.push(g)}for(const g of R)delete p[g]}(s),i}};var pn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(pn||(pn={}));let Du=class{constructor(){this.M=Gt.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=fn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.l.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=$i(r)?this.L(r):{json:JSON.parse(Q.decodeText(r)),resources:{}};return await this.j(n,this.dirname(e)),this.D(n),n}async readJSON(e){return e=this._(e),this.D(e),Cu.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const r=this.L(Q.assertView(e));this.D(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(i,a){return a.uri!==void 0&&!(a.uri in i.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(i,a){return a.uri!==void 0&&!(a.uri in i.resources)&&a.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(Q.assertView(e)))}async writeJSON(e,r={}){if(r.format===zt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Fu.write(e,{format:r.format||zt.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.P,dependencies:ze({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:zt.GLB}),s=new Uint32Array([1179937895,2,12]),i=JSON.stringify(r),a=Q.pad(Q.encodeText(i),32),o=Q.toView(new Uint32Array([a.byteLength,1313821514])),c=Q.concat([o,a]);s[s.length-1]+=c.byteLength;const u=Object.values(n)[0];if(!u||!u.byteLength)return Q.concat([Q.toView(s),c]);const h=Q.pad(u,0),m=Q.toView(new Uint32Array([h.byteLength,5130562])),y=Q.concat([m,h]);return s[s.length-1]+=y.byteLength,Q.concat([Q.toView(s),c,y])}async j(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(i){const a=i.uri;if(!a||a.match(/data:/))return Promise.resolve();e.resources[a]=await n.readURI(n.resolve(r,a),"view"),n.lastReadBytes+=e.resources[a].byteLength});await Promise.all(s)}D(e){function r(n){if(n.uri){if(n.uri in e.resources)Q.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${_u()}.${lr.extension(n.uri)}`;e.resources[s]=Q.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}_(e){const{images:r,buffers:n}=e.json;return e={json:ze({},e.json),resources:ze({},e.resources)},r&&(e.json.images=r.map(s=>ze({},s))),n&&(e.json.buffers=n.map(s=>ze({},s))),e}L(e){if(!$i(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==pn.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=Q.decodeText(Q.toView(e,20,n)),i=JSON.parse(s),a=20+n;if(e.byteLength<=a)return{json:i,resources:{}};const o=new Uint32Array(e.buffer,e.byteOffset+a,2);if(o[1]!==pn.BIN)throw new Error("Expected GLB BIN in second chunk.");const c=Q.toView(e,a+8,o[0]);return{json:i,resources:{[cr]:c}}}};function $i(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let Pu=class extends Du{constructor(e=Nr.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,r){const n=await fetch(e,this.J);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return Nr.resolve(e,r)}dirname(e){return Nr.dirname(e)}};const Uu=0,Lu=0,Bu=0,Vu=2,ju=0,ku=163,zu=166,Gu=0,qu=2,Hu=1,Wu=64,Xu=0;class Yu{constructor(){this.vkFormat=Xu,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Uu,this.levels=[],this.dataFormatDescriptor=[{vendorId:Bu,descriptorType:Lu,descriptorBlockSize:0,versionNumber:Vu,colorModel:ju,colorPrimaries:Hu,transferFunction:qu,flags:Gu,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Tr{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const je=[171,75,84,88,32,50,48,187,13,10,26,10];function Fi(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function Hn(t){const e=new Uint8Array(t.buffer,t.byteOffset,je.length);if(e[0]!==je[0]||e[1]!==je[1]||e[2]!==je[2]||e[3]!==je[3]||e[4]!==je[4]||e[5]!==je[5]||e[6]!==je[6]||e[7]!==je[7]||e[8]!==je[8]||e[9]!==je[9]||e[10]!==je[10]||e[11]!==je[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Yu,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Tr(t,je.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const i=s._nextUint32();r.supercompressionScheme=s._nextUint32();const a=s._nextUint32(),o=s._nextUint32(),c=s._nextUint32(),u=s._nextUint32(),h=s._nextUint64(),m=s._nextUint64(),y=i*3*8,x=new Tr(t,je.length+n,y,!0);for(let fe=0;fe<i;fe++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+x._nextUint64(),x._nextUint64()),uncompressedByteLength:x._nextUint64()});const E=new Tr(t,a,o,!0),_={vendorId:E._skip(4)._nextUint16(),descriptorType:E._nextUint16(),versionNumber:E._nextUint16(),descriptorBlockSize:E._nextUint16(),colorModel:E._nextUint8(),colorPrimaries:E._nextUint8(),transferFunction:E._nextUint8(),flags:E._nextUint8(),texelBlockDimension:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],bytesPlane:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],samples:[]},p=6,R=4,g=(_.descriptorBlockSize/4-p)/R;for(let fe=0;fe<g;fe++){const ue={bitOffset:E._nextUint16(),bitLength:E._nextUint8(),channelType:E._nextUint8(),samplePosition:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};ue.channelType&Wu?(ue.sampleLower=E._nextInt32(),ue.sampleUpper=E._nextInt32()):(ue.sampleLower=E._nextUint32(),ue.sampleUpper=E._nextUint32()),_.samples[fe]=ue}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(_);const T=new Tr(t,c,u,!0);for(;T._offset<u;){const fe=T._nextUint32(),ue=T._scan(fe),de=Fi(ue);if(r.keyValue[de]=T._nextUint8Array(fe-ue.byteLength-1),de.match(/^ktx/i)){const me=Fi(r.keyValue[de]);r.keyValue[de]=me.substring(0,me.lastIndexOf("\0"))}const Ce=fe%4?4-fe%4:0;T._skip(Ce)}if(m<=0)return r;const M=new Tr(t,h,m,!0),I=M._nextUint16(),S=M._nextUint16(),L=M._nextUint32(),F=M._nextUint32(),$=M._nextUint32(),z=M._nextUint32(),j=[];for(let fe=0;fe<i;fe++)j.push({imageFlags:M._nextUint32(),rgbSliceByteOffset:M._nextUint32(),rgbSliceByteLength:M._nextUint32(),alphaSliceByteOffset:M._nextUint32(),alphaSliceByteLength:M._nextUint32()});const H=h+M._offset,V=H+L,U=V+F,X=U+$,se=new Uint8Array(t.buffer,t.byteOffset+H,L),Z=new Uint8Array(t.buffer,t.byteOffset+V,F),le=new Uint8Array(t.buffer,t.byteOffset+U,$),oe=new Uint8Array(t.buffer,t.byteOffset+X,z);return r.globalData={endpointCount:I,selectorCount:S,imageDescs:j,endpointsData:se,selectorsData:Z,tablesData:le,extendedData:oe},r}const Ts="EXT_mesh_gpu_instancing",ss="EXT_meshopt_compression",Ma="KHR_draco_mesh_compression",Ms="KHR_lights_punctual",Es="KHR_materials_anisotropy",ws="KHR_materials_clearcoat",Rs="KHR_materials_emissive_strength",_s="KHR_materials_ior",Is="KHR_materials_iridescence",As="KHR_materials_pbrSpecularGlossiness",bs="KHR_materials_sheen",Ss="KHR_materials_specular",Cs="KHR_materials_transmission",Ns="KHR_materials_unlit",Os="KHR_materials_volume",Xt="KHR_materials_variants",$s="KHR_texture_transform",dn="KHR_xmp_json_ld",is="INSTANCE_ATTRIBUTE";class Ea extends Se{init(){this.extensionName=Ts,this.propertyType="InstancedMesh",this.parentTypes=[q.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:is})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Ea.EXTENSION_NAME=Ts;const bt=Ts;class wa extends Te{constructor(...e){super(...e),this.extensionName=bt,this.provideTypes=[q.NODE],this.prewriteTypes=[q.ACCESSOR]}createInstancedMesh(){return new Ea(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[bt])return;const s=r.extensions[bt],i=this.createInstancedMesh();for(const a in s.attributes)i.setAttribute(a,e.accessors[s.attributes[a]]);e.nodes[n].setExtension(bt,i)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(is);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,is);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(bt);if(s){const i=e.nodeIndexMap.get(n),a=r.json.nodes[i],o={attributes:{}};s.listSemantics().forEach(c=>{const u=s.getAttribute(c);o.attributes[c]=e.accessorIndexMap.get(u)}),a.extensions=a.extensions||{},a.extensions[bt]=o}}),this}}function vt(){return vt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},vt.apply(this,arguments)}var Ur,ir,be;wa.EXTENSION_NAME=bt,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(Ur||(Ur={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(ir||(ir={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(be||(be={}));const{BYTE:Ku,SHORT:Di,FLOAT:Ju}=Y.ComponentType,{encodeNormalizedInt:Pi,decodeNormalizedInt:Wn}=we;function Zu(t,e,r,n){const{filter:s,bits:i}=n,a={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==ir.ATTRIBUTES)return a;if(s!==be.NONE){let o=t.getNormalized()?function(c){const u=c.getComponentType(),h=c.getArray(),m=new Float32Array(h.length);for(let y=0;y<h.length;y++)m[y]=Wn(h[y],u);return m}(t):new Float32Array(a.array);switch(s){case be.EXPONENTIAL:a.byteStride=4*t.getElementSize(),a.componentType=Ju,a.normalized=!1,a.array=e.encodeFilterExp(o,t.getCount(),a.byteStride,i);break;case be.OCTAHEDRAL:a.byteStride=i>8?8:4,a.componentType=i>8?Di:Ku,a.normalized=!0,o=t.getElementSize()===3?function(c){const u=new Float32Array(4*c.length/3);for(let h=0,m=c.length/3;h<m;h++)u[4*h]=c[3*h],u[4*h+1]=c[3*h+1],u[4*h+2]=c[3*h+2];return u}(o):o,a.array=e.encodeFilterOct(o,t.getCount(),a.byteStride,i);break;case be.QUATERNION:a.byteStride=8,a.componentType=Di,a.normalized=!0,a.array=e.encodeFilterQuat(o,t.getCount(),a.byteStride,i);break;default:throw new Error("Invalid filter.")}a.min=t.getMin([]),a.max=t.getMax([]),t.getNormalized()&&(a.min=a.min.map(c=>Wn(c,t.getComponentType())),a.max=a.max.map(c=>Wn(c,t.getComponentType()))),a.normalized&&(a.min=a.min.map(c=>Pi(c,a.componentType)),a.max=a.max.map(c=>Pi(c,a.componentType)))}else a.byteStride%4&&(a.array=function(o,c){const u=Q.padNumber(o.BYTES_PER_ELEMENT*c)/o.BYTES_PER_ELEMENT,h=new o.constructor(o.length/c*u);for(let m=0;m*c<o.length;m++)for(let y=0;y<c;y++)h[m*u+y]=o[m*c+y];return h}(a.array,t.getElementSize()),a.byteStride=a.array.byteLength/t.getCount());return a}function Qu(t,e){return e===st.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof Pr&&r.getMode()===Pr.Mode.TRIANGLES)?ir.TRIANGLES:ir.INDICES:ir.ATTRIBUTES}function eh(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Ta));for(const n of r){const s=n.getName(),i=n.getAttributes().key||"",a=n.getParent().propertyType===q.PRIMITIVE_TARGET;if(s==="indices")return{filter:be.NONE};if(s==="attributes"){if(i==="POSITION")return{filter:be.NONE};if(i==="TEXCOORD_0")return{filter:be.NONE};if(i.startsWith("JOINTS_"))return{filter:be.NONE};if(i.startsWith("WEIGHTS_"))return{filter:be.NONE};if(i==="NORMAL"||i==="TANGENT")return a?{filter:be.NONE}:{filter:be.OCTAHEDRAL,bits:8}}if(s==="output"){const o=Ra(t);return o==="rotation"?{filter:be.QUATERNION,bits:16}:o==="translation"||o==="scale"?{filter:be.EXPONENTIAL,bits:12}:{filter:be.NONE}}if(s==="input")return{filter:be.NONE};if(s==="inverseBindMatrices")return{filter:be.NONE}}return{filter:be.NONE}}function Ra(t){for(const e of t.listParents())if(e instanceof En){for(const r of e.listParents())if(r instanceof ys)return r.getTargetPath()}return null}const ke=ss,Ui={method:Ur.QUANTIZE};class as extends Te{constructor(...e){super(...e),this.extensionName=ke,this.prereadTypes=[q.BUFFER,q.PRIMITIVE],this.prewriteTypes=[q.BUFFER,q.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=Ui,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=vt({},Ui,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${ke}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${ke}]: Missing WASM support.`)}return r===q.BUFFER?this._prereadBuffers(e):r===q.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[ke])return;const i=n.extensions[ke],a=i.byteOffset||0,o=i.byteLength||0,c=i.count,u=i.byteStride,h=new Uint8Array(c*u),m=r.json.buffers[i.buffer],y=Q.toView(m.uri?r.resources[m.uri]:r.resources[cr],a,o);this._decoder.decodeGltfBuffer(h,c,u,y,i.mode,i.filter),e.bufferViews[s]=h})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[ke]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[ss]&&s.extensions[ss].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[ke].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof Y&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===q.ACCESSOR?this._prewriteAccessors(e):r===q.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,i=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(i);this._encoderFallbackBuffer=i,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if(Ra(o)==="weights"||o.getSparse())continue;const c=e.getAccessorUsage(o),u=Qu(o,c),h=s.method===Ur.FILTER?eh(o,this.document):{filter:be.NONE},m=Zu(o,n,u,h),{array:y,byteStride:x}=m,E=o.getBuffer();if(!E)throw new Error(`${ke}: Missing buffer for accessor.`);const _=this.document.getRoot().listBuffers().indexOf(E),p=[c,u,h.filter,x,_].join(":");let R=this._encoderBufferViews[p],g=this._encoderBufferViewData[p],T=this._encoderBufferViewAccessors[p];R&&g||(T=this._encoderBufferViewAccessors[p]=[],g=this._encoderBufferViewData[p]=[],R=this._encoderBufferViews[p]={buffer:a,target:st.USAGE_TO_TARGET[c],byteOffset:0,byteLength:0,byteStride:c===st.BufferViewUsage.ARRAY_BUFFER?x:void 0,extensions:{[ke]:{buffer:_,byteOffset:0,byteLength:0,mode:u,filter:h.filter!==be.NONE?h.filter:void 0,byteStride:x,count:0}}});const M=e.createAccessorDef(o);M.componentType=m.componentType,M.normalized=m.normalized,M.byteOffset=R.byteLength,M.min&&m.min&&(M.min=m.min),M.max&&m.max&&(M.max=m.max),e.accessorIndexMap.set(o,r.accessors.length),r.accessors.push(M),T.push(M),g.push(new Uint8Array(y.buffer,y.byteOffset,y.byteLength)),R.byteLength+=y.byteLength,R.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[s.extensions[ke].buffer],o=e.otherBufferViews.get(a)||[],{count:c,byteStride:u,mode:h}=s.extensions[ke],m=Q.concat(i),y=r.encodeGltfBuffer(m,c,u,h),x=Q.pad(y);s.extensions[ke].byteLength=y.byteLength,i.length=0,i.push(x),o.push(x),e.otherBufferViews.set(a,o)}}write(e){let r=0;for(const a in this._encoderBufferViews){const o=this._encoderBufferViews[a],c=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[a][0]),u=this._encoderBufferViewAccessors[a];for(const y of u)y.bufferView=c;const h=e.jsonDoc.json.bufferViews[c],m=h.byteOffset||0;Object.assign(h,o),h.byteOffset=r,h.extensions[ke].byteOffset=m,r+=Q.padNumber(o.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[s];return i.byteLength=r,i.extensions={[ke]:{fallback:!0}},n.dispose(),this}}as.EXTENSION_NAME=ke,as.EncoderMethod=Ur;const Ar="EXT_texture_avif";class th{match(e){return e.length>=12&&Q.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=Li(r,0);if(!n)return null;let s=n.end;for(;n=Li(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class _a extends Te{constructor(...e){super(...e),this.extensionName=Ar,this.prereadTypes=[q.TEXTURE]}static register(){ht.registerFormat("image/avif",new th)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Ar]&&(r.source=r.extensions[Ar].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Ar]={source:i.source},delete i.source)})}}),this}}function Li(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:Q.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}_a.EXTENSION_NAME=Ar;const br="EXT_texture_webp";class rh{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=Q.decodeText(e.slice(0,4)),n=Q.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<s.byteLength;){const a=Q.decodeText(new Uint8Array([s.getUint8(i),s.getUint8(i+1),s.getUint8(i+2),s.getUint8(i+3)])),o=s.getUint32(i+4,!0);if(a==="VP8 ")return[16383&s.getInt16(i+14,!0),16383&s.getInt16(i+16,!0)];if(a==="VP8L"){const c=s.getUint8(i+9),u=s.getUint8(i+10),h=s.getUint8(i+11);return[1+((63&u)<<8|c),1+((15&s.getUint8(i+12))<<10|h<<2|(192&u)>>6)]}i+=8+o+o%2}return null}getChannels(e){return 4}}class Ia extends Te{constructor(...e){super(...e),this.extensionName=br,this.prereadTypes=[q.TEXTURE]}static register(){ht.registerFormat("image/webp",new rh)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[br]&&(r.source=r.extensions[br].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[br]={source:i.source},delete i.source)})}}),this}}Ia.EXTENSION_NAME=br;const Bi=Ma;let Oe,Aa,ba,Ze;function nh(t,e){const r=new Oe.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==Oe.TRIANGULAR_MESH)throw new Error(`[${Bi}] Unknown geometry type.`);const n=new Oe.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${Bi}] Decoding failure.`);return n}finally{Oe.destroy(r)}}function sh(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const i=r*Uint16Array.BYTES_PER_ELEMENT;n=Oe._malloc(i),t.GetTrianglesUInt16Array(e,i,n),s=new Uint16Array(Oe.HEAPU16.buffer,n,r).slice()}else{const i=r*Uint32Array.BYTES_PER_ELEMENT;n=Oe._malloc(i),t.GetTrianglesUInt32Array(e,i,n),s=new Uint32Array(Oe.HEAPU32.buffer,n,r).slice()}return Oe._free(n),s}function ih(t,e,r,n){const s=ba[n.componentType],i=Aa[n.componentType],a=r.num_components(),o=e.num_points()*a,c=o*i.BYTES_PER_ELEMENT,u=Oe._malloc(c);t.GetAttributeDataArrayForAllPoints(e,r,s,c,u);const h=new i(Oe.HEAPF32.buffer,u,o).slice();return Oe._free(u),h}var Lr,Qe;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(Lr||(Lr={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(Qe||(Qe={}));const Sa={[Qe.POSITION]:14,[Qe.NORMAL]:10,[Qe.COLOR]:8,[Qe.TEX_COORD]:12,[Qe.GENERIC]:12},Vi={decodeSpeed:5,encodeSpeed:5,method:Lr.EDGEBREAKER,quantizationBits:Sa,quantizationVolume:"mesh"};function ah(t,e=Vi){const r=vt({},Vi,e);r.quantizationBits=vt({},Sa,e.quantizationBits);const n=new Ze.MeshBuilder,s=new Ze.Mesh,i=new Ze.ExpertEncoder(s),a={},o=new Ze.DracoInt8Array,c=t.listTargets().length>0;let u=!1;for(const _ of t.listSemantics()){const p=t.getAttribute(_);if(p.getSparse()){u=!0;continue}const R=oh(_),g=ch(n,p.getComponentType(),s,Ze[R],p.getCount(),p.getElementSize(),p.getArray());if(g===-1)throw new Error(`Error compressing "${_}" attribute.`);if(a[_]=g,r.quantizationVolume==="mesh"||_!=="POSITION")i.SetAttributeQuantization(g,r.quantizationBits[R]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:T}=r,M=Math.max(T.max[0]-T.min[0],T.max[1]-T.min[1],T.max[2]-T.min[2]);i.SetAttributeExplicitQuantization(g,r.quantizationBits[R],p.getElementSize(),T.min,M)}}}const h=t.getIndices();if(!h)throw new os("Primitive must have indices.");n.AddFacesToMesh(s,h.getCount()/3,h.getArray()),i.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),i.SetTrackEncodedProperties(!0),i.SetEncodingMethod(r.method===Lr.SEQUENTIAL||c||u?Ze.MESH_SEQUENTIAL_ENCODING:Ze.MESH_EDGEBREAKER_ENCODING);const m=i.EncodeToDracoBuffer(!(c||u),o);if(m<=0)throw new os("Error applying Draco compression.");const y=new Uint8Array(m);for(let _=0;_<m;++_)y[_]=o.GetValue(_);const x=i.GetNumberOfEncodedPoints(),E=3*i.GetNumberOfEncodedFaces();return Ze.destroy(o),Ze.destroy(s),Ze.destroy(n),Ze.destroy(i),{numVertices:x,numIndices:E,data:y,attributeIDs:a}}function oh(t){return t==="POSITION"?Qe.POSITION:t==="NORMAL"?Qe.NORMAL:t.startsWith("COLOR_")?Qe.COLOR:t.startsWith("TEXCOORD_")?Qe.TEX_COORD:Qe.GENERIC}function ch(t,e,r,n,s,i,a){switch(e){case Y.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,i,a);case Y.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,i,a);case Y.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,i,a);case Y.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,i,a);case Y.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,i,a);case Y.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,i,a);default:throw new Error(`Unexpected component type, "${e}".`)}}class os extends Error{}const Ae=Ma;class cs extends Te{constructor(...e){super(...e),this.extensionName=Ae,this.prereadTypes=[q.PRIMITIVE],this.prewriteTypes=[q.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,Oe=this._decoderModule,Aa={[Y.ComponentType.FLOAT]:Float32Array,[Y.ComponentType.UNSIGNED_INT]:Uint32Array,[Y.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Y.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Y.ComponentType.SHORT]:Int16Array,[Y.ComponentType.BYTE]:Int8Array},ba={[Y.ComponentType.FLOAT]:Oe.DT_FLOAT32,[Y.ComponentType.UNSIGNED_INT]:Oe.DT_UINT32,[Y.ComponentType.UNSIGNED_SHORT]:Oe.DT_UINT16,[Y.ComponentType.UNSIGNED_BYTE]:Oe.DT_UINT8,[Y.ComponentType.SHORT]:Oe.DT_INT16,[Y.ComponentType.BYTE]:Oe.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,Ze=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Ae}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const i=n.json.meshes||[];for(const a of i)for(const o of a.primitives){if(!o.extensions||!o.extensions[Ae])continue;const c=o.extensions[Ae];let[u,h]=s.get(c.bufferView)||[];if(!h||!u){const m=n.json.bufferViews[c.bufferView],y=n.json.buffers[m.buffer],x=Q.toView(y.uri?n.resources[y.uri]:n.resources[cr],m.byteOffset||0,m.byteLength);u=new this._decoderModule.Decoder,h=nh(u,x),s.set(c.bufferView,[u,h]),r.debug(`[${Ae}] Decompressed ${x.byteLength} bytes.`)}for(const m in o.attributes){const y=e.jsonDoc.json.accessors[o.attributes[m]],x=u.GetAttributeByUniqueId(h,c.attributes[m]),E=ih(u,h,x,y);e.accessors[o.attributes[m]].setArray(E)}o.indices!==void 0&&e.accessors[o.indices].setArray(sh(u,h))}}finally{for(const[i,a]of Array.from(s.values()))this._decoderModule.destroy(i),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${Ae}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Ae}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(o){const c=o.getLogger(),u=new Set,h=new Set;for(const p of o.getRoot().listMeshes())for(const R of p.listPrimitives())R.getIndices()?R.getMode()!==Pr.Mode.TRIANGLES?(h.add(R),c.warn(`[${Ae}] Skipping Draco compression on non-TRIANGLES primitive.`)):u.add(R):(h.add(R),c.warn(`[${Ae}] Skipping Draco compression on non-indexed primitive.`));const m=o.getRoot().listAccessors(),y=new Map;for(let p=0;p<m.length;p++)y.set(m[p],p);const x=new Map,E=new Set,_=new Map;for(const p of Array.from(u)){let R=ji(p,y);if(E.has(R))_.set(p,R);else{if(x.has(p.getIndices())){const g=p.getIndices(),T=g.clone();y.set(T,o.getRoot().listAccessors().length-1),p.swap(g,T)}for(const g of p.listAttributes())if(x.has(g)){const T=g.clone();y.set(T,o.getRoot().listAccessors().length-1),p.swap(g,T)}R=ji(p,y),E.add(R),_.set(p,R),x.set(p.getIndices(),R);for(const g of p.listAttributes())x.set(g,R)}}for(const p of Array.from(x.keys())){const R=new Set(p.listParents().map(g=>g.propertyType));if(R.size!==2||!R.has(q.PRIMITIVE)||!R.has(q.ROOT))throw new Error(`[${Ae}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const p of Array.from(u)){const R=_.get(p),g=p.getIndices();if(x.get(g)!==R||p.listAttributes().some(T=>x.get(T)!==R))throw new Error(`[${Ae}] Draco primitives must share all, or no, accessors.`)}for(const p of Array.from(h)){const R=p.getIndices();if(x.has(R)||p.listAttributes().some(g=>x.has(g)))throw new Error(`[${Ae}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return _}(this.document),i=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Ae}]: quantizationVolume=scene requires exactly 1 scene.`):a=vu(this.document.getRoot().listScenes().pop()));for(const o of Array.from(s.keys())){const c=s.get(o);if(!c)throw new Error("Unexpected primitive.");if(i.has(c)){i.set(c,i.get(c));continue}const u=o.getIndices(),h=e.jsonDoc.json.accessors;let m;try{m=ah(o,vt({},this._encoderOptions,{quantizationVolume:a}))}catch(E){if(E instanceof os){n.warn(`[${Ae}]: ${E.message} Skipping primitive compression.`);continue}throw E}i.set(c,m);const y=e.createAccessorDef(u);y.count=m.numIndices,e.accessorIndexMap.set(u,h.length),h.push(y);for(const E of o.listSemantics()){const _=o.getAttribute(E);if(m.attributeIDs[E]===void 0)continue;const p=e.createAccessorDef(_);p.count=m.numVertices,e.accessorIndexMap.set(_,h.length),h.push(p)}const x=o.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(x)||e.otherBufferViews.set(x,[]),e.otherBufferViews.get(x).push(m.data)}return n.debug(`[${Ae}] Compressed ${s.size} primitives.`),e.extensionData[Ae]={primitiveHashMap:s,primitiveEncodingMap:i},this}write(e){const r=e.extensionData[Ae];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const a=n.listPrimitives()[i],o=s.primitives[i],c=r.primitiveHashMap.get(a);if(!c)continue;const u=r.primitiveEncodingMap.get(c);u&&(o.extensions=o.extensions||{},o.extensions[Ae]={bufferView:e.otherBufferViewsIndexMap.get(u.data),attributes:u.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Ae),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Ae)}return this}}function ji(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}cs.EXTENSION_NAME=Ae,cs.EncoderMethod=Lr;class ur extends Se{init(){this.extensionName=Ms,this.propertyType="Light",this.parentTypes=[q.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ur.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return He.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return He.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ur.EXTENSION_NAME=Ms,ur.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const lt=Ms;class Ca extends Te{constructor(...e){super(...e),this.extensionName=lt}createLight(e=""){return new ur(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[lt])return this;const n=(r.json.extensions[lt].lights||[]).map(s=>{var i,a;const o=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&o.setColor(s.color),s.intensity!==void 0&&o.setIntensity(s.intensity),s.range!==void 0&&o.setRange(s.range),((i=s.spot)==null?void 0:i.innerConeAngle)!==void 0&&o.setInnerConeAngle(s.spot.innerConeAngle),((a=s.spot)==null?void 0:a.outerConeAngle)!==void 0&&o.setOuterConeAngle(s.spot.outerConeAngle),o});return r.json.nodes.forEach((s,i)=>{s.extensions&&s.extensions[lt]&&e.nodes[i].setExtension(lt,n[s.extensions[lt].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const i of this.properties){const a=i,o={type:a.getType()};we.eq(a.getColor(),[1,1,1])||(o.color=a.getColor()),a.getIntensity()!==1&&(o.intensity=a.getIntensity()),a.getRange()!=null&&(o.range=a.getRange()),a.getName()&&(o.name=a.getName()),a.getType()===ur.Type.SPOT&&(o.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(o),s.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(i=>{const a=i.getExtension(lt);if(a){const o=e.nodeIndexMap.get(i),c=r.json.nodes[o];c.extensions=c.extensions||{},c.extensions[lt]={light:s.get(a)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[lt]={lights:n},this}}Ca.EXTENSION_NAME=lt;const{R:lh,G:fh,B:uh}=it;class Na extends Se{init(){this.extensionName=Es,this.propertyType="Anisotropy",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Re(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:lh|fh|uh})}}Na.EXTENSION_NAME=Es;const St=Es;class Oa extends Te{constructor(...e){super(...e),this.extensionName=St}createAnisotropy(){return new Na(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[St]){const a=this.createAnisotropy();e.materials[i].setExtension(St,a);const o=s.extensions[St];if(o.anisotropyStrength!==void 0&&a.setAnisotropyStrength(o.anisotropyStrength),o.anisotropyRotation!==void 0&&a.setAnisotropyRotation(o.anisotropyRotation),o.anisotropyTexture!==void 0){const c=o.anisotropyTexture;a.setAnisotropyTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getAnisotropyTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(St);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[St]={};if(s.getAnisotropyStrength()>0&&(o.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(o.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const c=s.getAnisotropyTexture(),u=s.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(c,u)}}}),this}}Oa.EXTENSION_NAME=St;const{R:ki,G:zi,B:hh}=it;class $a extends Se{init(){this.extensionName=ws,this.propertyType="Clearcoat",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Re(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Re(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Re(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:ki})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:zi})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:ki|zi|hh})}}$a.EXTENSION_NAME=ws;const Ct=ws;class Fa extends Te{constructor(...e){super(...e),this.extensionName=Ct}createClearcoat(){return new $a(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Ct]){const a=this.createClearcoat();e.materials[i].setExtension(Ct,a);const o=s.extensions[Ct];if(o.clearcoatFactor!==void 0&&a.setClearcoatFactor(o.clearcoatFactor),o.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),o.clearcoatTexture!==void 0){const c=o.clearcoatTexture;a.setClearcoatTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatTextureInfo(),c)}if(o.clearcoatRoughnessTexture!==void 0){const c=o.clearcoatRoughnessTexture;a.setClearcoatRoughnessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),c)}if(o.clearcoatNormalTexture!==void 0){const c=o.clearcoatNormalTexture;a.setClearcoatNormalTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),c),c.scale!==void 0&&a.setClearcoatNormalScale(c.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ct);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Ct]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const c=s.getClearcoatTexture(),u=s.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(c,u)}if(s.getClearcoatRoughnessTexture()){const c=s.getClearcoatRoughnessTexture(),u=s.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(c,u)}if(s.getClearcoatNormalTexture()){const c=s.getClearcoatNormalTexture(),u=s.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(c,u),s.getClearcoatNormalScale()!==1&&(o.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}Fa.EXTENSION_NAME=Ct;class Da extends Se{init(){this.extensionName=Rs,this.propertyType="EmissiveStrength",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}Da.EXTENSION_NAME=Rs;const Nt=Rs;class Pa extends Te{constructor(...e){super(...e),this.extensionName=Nt}createEmissiveStrength(){return new Da(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Nt]){const s=this.createEmissiveStrength();e.materials[n].setExtension(Nt,s);const i=r.extensions[Nt];i.emissiveStrength!==void 0&&s.setEmissiveStrength(i.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Nt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[Nt]={emissiveStrength:s.getEmissiveStrength()}}}),this}}Pa.EXTENSION_NAME=Nt;class Ua extends Se{init(){this.extensionName=_s,this.propertyType="IOR",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Ua.EXTENSION_NAME=_s;const Ot=_s;class La extends Te{constructor(...e){super(...e),this.extensionName=Ot}createIOR(){return new Ua(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Ot]){const s=this.createIOR();e.materials[n].setExtension(Ot,s);const i=r.extensions[Ot];i.ior!==void 0&&s.setIOR(i.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ot);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[Ot]={ior:s.getIOR()}}}),this}}La.EXTENSION_NAME=Ot;const{R:ph,G:dh}=it;class Ba extends Se{init(){this.extensionName=Is,this.propertyType="Iridescence",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Re(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Re(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:ph})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:dh})}}Ba.EXTENSION_NAME=Is;const $t=Is;class Va extends Te{constructor(...e){super(...e),this.extensionName=$t}createIridescence(){return new Ba(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[$t]){const a=this.createIridescence();e.materials[i].setExtension($t,a);const o=s.extensions[$t];if(o.iridescenceFactor!==void 0&&a.setIridescenceFactor(o.iridescenceFactor),o.iridescenceIor!==void 0&&a.setIridescenceIOR(o.iridescenceIor),o.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(o.iridescenceThicknessMaximum),o.iridescenceTexture!==void 0){const c=o.iridescenceTexture;a.setIridescenceTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getIridescenceTextureInfo(),c)}if(o.iridescenceThicknessTexture!==void 0){const c=o.iridescenceThicknessTexture;a.setIridescenceThicknessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension($t);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[$t]={};if(s.getIridescenceFactor()>0&&(o.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(o.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(o.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(o.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const c=s.getIridescenceTexture(),u=s.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(c,u)}if(s.getIridescenceThicknessTexture()){const c=s.getIridescenceThicknessTexture(),u=s.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(c,u)}}}),this}}Va.EXTENSION_NAME=$t;const{R:Gi,G:qi,B:Hi,A:Wi}=it;class ja extends Se{init(){this.extensionName=As,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Re(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Re(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return He.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(He.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Gi|qi|Hi|Wi,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Gi|qi|Hi|Wi})}}ja.EXTENSION_NAME=As;const Ft=As;class ka extends Te{constructor(...e){super(...e),this.extensionName=Ft}createPBRSpecularGlossiness(){return new ja(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Ft]){const a=this.createPBRSpecularGlossiness();e.materials[i].setExtension(Ft,a);const o=s.extensions[Ft];if(o.diffuseFactor!==void 0&&a.setDiffuseFactor(o.diffuseFactor),o.specularFactor!==void 0&&a.setSpecularFactor(o.specularFactor),o.glossinessFactor!==void 0&&a.setGlossinessFactor(o.glossinessFactor),o.diffuseTexture!==void 0){const c=o.diffuseTexture;a.setDiffuseTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getDiffuseTextureInfo(),c)}if(o.specularGlossinessTexture!==void 0){const c=o.specularGlossinessTexture;a.setSpecularGlossinessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ft);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Ft]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const c=s.getDiffuseTexture(),u=s.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(c,u)}if(s.getSpecularGlossinessTexture()){const c=s.getSpecularGlossinessTexture(),u=s.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(c,u)}}}),this}}ka.EXTENSION_NAME=Ft;const{R:gh,G:mh,B:vh,A:yh}=it;class za extends Se{init(){this.extensionName=bs,this.propertyType="Sheen",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Re(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Re(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return He.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",He.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:gh|mh|vh,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:yh})}}za.EXTENSION_NAME=bs;const Dt=bs;class Ga extends Te{constructor(...e){super(...e),this.extensionName=Dt}createSheen(){return new za(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Dt]){const a=this.createSheen();e.materials[i].setExtension(Dt,a);const o=s.extensions[Dt];if(o.sheenColorFactor!==void 0&&a.setSheenColorFactor(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(o.sheenRoughnessFactor),o.sheenColorTexture!==void 0){const c=o.sheenColorTexture;a.setSheenColorTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSheenColorTextureInfo(),c)}if(o.sheenRoughnessTexture!==void 0){const c=o.sheenRoughnessTexture;a.setSheenRoughnessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Dt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Dt]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const c=s.getSheenColorTexture(),u=s.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(c,u)}if(s.getSheenRoughnessTexture()){const c=s.getSheenRoughnessTexture(),u=s.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(c,u)}}}),this}}Ga.EXTENSION_NAME=Dt;const{R:xh,G:Th,B:Mh,A:Eh}=it;class qa extends Se{init(){this.extensionName=Ss,this.propertyType="Specular",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Re(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Re(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return He.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",He.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Eh})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:xh|Th|Mh,isColor:!0})}}qa.EXTENSION_NAME=Ss;const Pt=Ss;class Ha extends Te{constructor(...e){super(...e),this.extensionName=Pt}createSpecular(){return new qa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Pt]){const a=this.createSpecular();e.materials[i].setExtension(Pt,a);const o=s.extensions[Pt];if(o.specularFactor!==void 0&&a.setSpecularFactor(o.specularFactor),o.specularColorFactor!==void 0&&a.setSpecularColorFactor(o.specularColorFactor),o.specularTexture!==void 0){const c=o.specularTexture;a.setSpecularTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularTextureInfo(),c)}if(o.specularColorTexture!==void 0){const c=o.specularColorTexture;a.setSpecularColorTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getSpecularColorTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Pt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Pt]={};if(s.getSpecularFactor()!==1&&(o.specularFactor=s.getSpecularFactor()),we.eq(s.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const c=s.getSpecularTexture(),u=s.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(c,u)}if(s.getSpecularColorTexture()){const c=s.getSpecularColorTexture(),u=s.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(c,u)}}}),this}}Ha.EXTENSION_NAME=Pt;const{R:wh}=it;class Wa extends Se{init(){this.extensionName=Cs,this.propertyType="Transmission",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Re(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:wh})}}Wa.EXTENSION_NAME=Cs;const Ut=Cs;class Xa extends Te{constructor(...e){super(...e),this.extensionName=Ut}createTransmission(){return new Wa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Ut]){const a=this.createTransmission();e.materials[i].setExtension(Ut,a);const o=s.extensions[Ut];if(o.transmissionFactor!==void 0&&a.setTransmissionFactor(o.transmissionFactor),o.transmissionTexture!==void 0){const c=o.transmissionTexture;a.setTransmissionTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getTransmissionTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ut);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Ut]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const c=s.getTransmissionTexture(),u=s.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(c,u)}}}),this}}Xa.EXTENSION_NAME=Ut;class Ya extends Se{init(){this.extensionName=Ns,this.propertyType="Unlit",this.parentTypes=[q.MATERIAL]}}Ya.EXTENSION_NAME=Ns;const rr=Ns;class Fs extends Te{constructor(...e){super(...e),this.extensionName=rr}createUnlit(){return new Ya(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[rr]&&e.materials[n].setExtension(rr,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(rr)){const s=e.materialIndexMap.get(n),i=r.json.materials[s];i.extensions=i.extensions||{},i.extensions[rr]={}}}),this}}Fs.EXTENSION_NAME=rr;class Ka extends Se{init(){this.extensionName=Xt,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Ka.EXTENSION_NAME=Xt;class Ja extends Se{init(){this.extensionName=Xt,this.propertyType="MappingList",this.parentTypes=[q.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Ja.EXTENSION_NAME=Xt;class ls extends Se{init(){this.extensionName=Xt,this.propertyType="Variant",this.parentTypes=["MappingList"]}}ls.EXTENSION_NAME=Xt;const ft=Xt;class Za extends Te{constructor(...e){super(...e),this.extensionName=ft}createMappingList(){return new Ja(this.document.getGraph())}createVariant(e=""){return new ls(this.document.getGraph(),e)}createMapping(){return new Ka(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof ls)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[ft])return this;const n=(r.json.extensions[ft].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,i)=>{const a=e.meshes[i];(s.primitives||[]).forEach((o,c)=>{if(!o.extensions||!o.extensions[ft])return;const u=this.createMappingList(),h=o.extensions[ft];for(const m of h.mappings){const y=this.createMapping();m.material!==void 0&&y.setMaterial(e.materials[m.material]);for(const x of m.variants||[])y.addVariant(n[x]);u.addMapping(y)}a.listPrimitives()[c].setExtension(ft,u)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],i=new Map;for(const a of n)i.set(a,s.length),s.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const o=e.meshIndexMap.get(a);a.listPrimitives().forEach((c,u)=>{const h=c.getExtension(ft);if(!h)return;const m=e.jsonDoc.json.meshes[o].primitives[u],y=h.listMappings().map(x=>{const E=e.createPropertyDef(x),_=x.getMaterial();return _&&(E.material=e.materialIndexMap.get(_)),E.variants=x.listVariants().map(p=>i.get(p)),E});m.extensions=m.extensions||{},m.extensions[ft]={mappings:y}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[ft]={variants:s},this}}Za.EXTENSION_NAME=ft;const{G:Rh}=it;class Qa extends Se{init(){this.extensionName=Os,this.propertyType="Volume",this.parentTypes=[q.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Re(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Rh})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return He.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",He.hexToFactor(e,r))}}Qa.EXTENSION_NAME=Os;const Lt=Os;class eo extends Te{constructor(...e){super(...e),this.extensionName=Lt}createVolume(){return new Qa(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Lt]){const a=this.createVolume();e.materials[i].setExtension(Lt,a);const o=s.extensions[Lt];if(o.thicknessFactor!==void 0&&a.setThicknessFactor(o.thicknessFactor),o.attenuationDistance!==void 0&&a.setAttenuationDistance(o.attenuationDistance),o.attenuationColor!==void 0&&a.setAttenuationColor(o.attenuationColor),o.thicknessTexture!==void 0){const c=o.thicknessTexture;a.setThicknessTexture(e.textures[n[c.index].source]),e.setTextureInfo(a.getThicknessTextureInfo(),c)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Lt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Lt]={};if(s.getThicknessFactor()>0&&(o.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(o.attenuationDistance=s.getAttenuationDistance()),we.eq(s.getAttenuationColor(),[1,1,1])||(o.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const c=s.getThicknessTexture(),u=s.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(c,u)}}}),this}}eo.EXTENSION_NAME=Lt;const to="KHR_mesh_quantization";class ro extends Te{constructor(...e){super(...e),this.extensionName=to}read(e){return this}write(e){return this}}ro.EXTENSION_NAME=to;const Sr="KHR_texture_basisu";class _h{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=Hn(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=Hn(e).dataFormatDescriptor[0];if(r.colorModel===ku)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===zu)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=Hn(e),n=this.getChannels(e)>3;let s=0;for(let i=0;i<r.levels.length;i++){const a=r.levels[i];s+=a.uncompressedByteLength?a.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,i)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,i)))/4)*(n?16:8)}return s}}class no extends Te{constructor(...e){super(...e),this.extensionName=Sr,this.prereadTypes=[q.TEXTURE]}static register(){ht.registerFormat("image/ktx2",new _h)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[Sr]&&(r.source=r.extensions[Sr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Sr]={source:i.source},delete i.source)})}}),this}}no.EXTENSION_NAME=Sr;class so extends Se{init(){this.extensionName=$s,this.propertyType="Transform",this.parentTypes=[q.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}so.EXTENSION_NAME=$s;const Bt=$s;class io extends Te{constructor(...e){super(...e),this.extensionName=Bt}createTransform(){return new so(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Bt])continue;const s=this.createTransform(),i=n.extensions[Bt];i.offset!==void 0&&s.setOffset(i.offset),i.rotation!==void 0&&s.setRotation(i.rotation),i.scale!==void 0&&s.setScale(i.scale),i.texCoord!==void 0&&s.setTexCoord(i.texCoord),r.setExtension(Bt,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const i=n.getExtension(Bt);if(!i)continue;s.extensions=s.extensions||{};const a={},o=we.eq;o(i.getOffset(),[0,0])||(a.offset=i.getOffset()),i.getRotation()!==0&&(a.rotation=i.getRotation()),o(i.getScale(),[1,1])||(a.scale=i.getScale()),i.getTexCoord()!=null&&(a.texCoord=i.getTexCoord()),s.extensions[Bt]=a}return this}}io.EXTENSION_NAME=Bt;const Ih=[q.ROOT,q.SCENE,q.NODE,q.MESH,q.MATERIAL,q.TEXTURE,q.ANIMATION];class ao extends Se{init(){this.extensionName=dn,this.propertyType="Packet",this.parentTypes=Ih}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",vt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=vt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return vt({"@context":Xn(this.get("context"))},Xn(this.get("properties")))}fromJSONLD(e){const r=(e=Xn(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${dn}: Missing context for term, "${e}".`)}}function Xn(t){return JSON.parse(JSON.stringify(t))}ao.EXTENSION_NAME=dn;const mt=dn;class oo extends Te{constructor(...e){super(...e),this.extensionName=mt}createPacket(){return new ao(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[mt];if(!n||!n.packets)return this;const s=e.jsonDoc.json,i=this.document.getRoot(),a=n.packets.map(u=>this.createPacket().fromJSONLD(u)),o=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],c=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let u=0;u<o.length;u++){const h=o[u]||[];for(let m=0;m<h.length;m++){const y=h[m];y.extensions&&y.extensions[mt]&&c[u][m].setExtension(mt,a[y.extensions[mt].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const i of s.listParents()){let a;switch(i.propertyType){case q.ROOT:a=r.asset;break;case q.SCENE:a=r.scenes[e.sceneIndexMap.get(i)];break;case q.NODE:a=r.nodes[e.nodeIndexMap.get(i)];break;case q.MESH:a=r.meshes[e.meshIndexMap.get(i)];break;case q.MATERIAL:a=r.materials[e.materialIndexMap.get(i)];break;case q.TEXTURE:a=r.images[e.imageIndexMap.get(i)];break;case q.ANIMATION:a=r.animations[e.animationIndexMap.get(i)];break;default:a=null,this.document.getLogger().warn(`[${mt}]: Unsupported parent property, "${i.propertyType}"`)}a&&(a.extensions=a.extensions||{},a.extensions[mt]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[mt]={packets:n}),this}}oo.EXTENSION_NAME=mt;const co=[cs,Ca,Oa,Fa,Pa,La,Va,ka,Ha,Ga,Xa,Fs,Za,eo,ro,no,io,oo];[...co];const lo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fo=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},Ah=(t=1,e=lo)=>`    <item objectid="${t}" transform="${fo(e)}" />
`,Xi=t=>t?t.toISOString().substring(0,10):"";function bh(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:i="jscad",creationDate:a=new Date,license:o="",modificationDate:c}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${o}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${Xi(a)}</metadata>
  <metadata name="ModificationDate">${Xi(c||a)}</metadata>
  <metadata name="Application">${i}</metadata>
   `)}function Sh(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:i})=>{Ch(t,s,i)}),t.push(` </components>
`),t.push(`</object>
`)}const Ch=(t,e=1,r=lo)=>{t.push(`    <component objectid="${e}" transform="${fo(r)}" />
`)};function Nh(t,e,r,n,s,i){t.push(`  <object id="${e}" type="model"${i?' name="'+i+'"':""}>
   <mesh>
    <vertices>
`);for(let a=0;a<r.length;a+=3)t.push(`     <vertex x="${r[a].toPrecision(s)}" y="${r[a+1].toPrecision(s)}" z="${r[a+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let a=0;a<n.length;a+=3)t.push(`     <triangle v1="${n[a]}" v2="${n[a+1]}" v3="${n[a+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const Yi={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function Oh({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const i=[];return bh(i,s),i.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:a,vertices:o,indices:c,name:u})=>Nh(i,a,o,c,n,u)),e.forEach(({id:a,children:o,name:c})=>{Sh(i,a,o,c)}),i.push(`  </resources>
`),i.push(`<build>
`),r.forEach(({objectID:a,transform:o})=>{i.push(Ah(a,o))}),i.push(`</build>
`),i.push(`</model>
`),i.join("")}class $h{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var Be=Uint8Array,Ke=Uint16Array,Ds=Int32Array,Ps=new Be([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Us=new Be([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ki=new Be([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),uo=function(t,e){for(var r=new Ke(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new Ds(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)s[i]=i-r[n]<<5|n;return{b:r,r:s}},ho=uo(Ps,2),Fh=ho.b,fs=ho.r;Fh[28]=258,fs[258]=28;var Dh=uo(Us,0),Ji=Dh.r,us=new Ke(32768);for(var ge=0;ge<32768;++ge){var Tt=(ge&43690)>>1|(ge&21845)<<1;Tt=(Tt&52428)>>2|(Tt&13107)<<2,Tt=(Tt&61680)>>4|(Tt&3855)<<4,us[ge]=((Tt&65280)>>8|(Tt&255)<<8)>>1}var $r=function(t,e,r){for(var n=t.length,s=0,i=new Ke(e);s<n;++s)t[s]&&++i[t[s]-1];var a=new Ke(e);for(s=1;s<e;++s)a[s]=a[s-1]+i[s-1]<<1;var o;if(r){o=new Ke(1<<e);var c=15-e;for(s=0;s<n;++s)if(t[s])for(var u=s<<4|t[s],h=e-t[s],m=a[t[s]-1]++<<h,y=m|(1<<h)-1;m<=y;++m)o[us[m]>>c]=u}else for(o=new Ke(n),s=0;s<n;++s)t[s]&&(o[s]=us[a[t[s]-1]++]>>15-t[s]);return o},Ht=new Be(288);for(var ge=0;ge<144;++ge)Ht[ge]=8;for(var ge=144;ge<256;++ge)Ht[ge]=9;for(var ge=256;ge<280;++ge)Ht[ge]=7;for(var ge=280;ge<288;++ge)Ht[ge]=8;var gn=new Be(32);for(var ge=0;ge<32;++ge)gn[ge]=5;var Ph=$r(Ht,9,0),Uh=$r(gn,5,0),po=function(t){return(t+7)/8|0},go=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new Be(t.subarray(e,r))},Lh=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],wn=function(t,e,r){var n=new Error(e||Lh[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,wn),!r)throw n;return n},gt=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},Mr=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},Yn=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,i=r.slice();if(!s)return{t:vo,l:0};if(s==1){var a=new Be(r[0].s+1);return a[r[0].s]=1,{t:a,l:1}}r.sort(function(I,S){return I.f-S.f}),r.push({s:-1,f:25001});var o=r[0],c=r[1],u=0,h=1,m=2;for(r[0]={s:-1,f:o.f+c.f,l:o,r:c};h!=s-1;)o=r[r[u].f<r[m].f?u++:m++],c=r[u!=h&&r[u].f<r[m].f?u++:m++],r[h++]={s:-1,f:o.f+c.f,l:o,r:c};for(var y=i[0].s,n=1;n<s;++n)i[n].s>y&&(y=i[n].s);var x=new Ke(y+1),E=hs(r[h-1],x,0);if(E>e){var n=0,_=0,p=E-e,R=1<<p;for(i.sort(function(S,L){return x[L.s]-x[S.s]||S.f-L.f});n<s;++n){var g=i[n].s;if(x[g]>e)_+=R-(1<<E-x[g]),x[g]=e;else break}for(_>>=p;_>0;){var T=i[n].s;x[T]<e?_-=1<<e-x[T]++-1:++n}for(;n>=0&&_;--n){var M=i[n].s;x[M]==e&&(--x[M],++_)}E=e}return{t:new Be(x),l:E}},hs=function(t,e,r){return t.s==-1?Math.max(hs(t.l,e,r+1),hs(t.r,e,r+1)):e[t.s]=r},Zi=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new Ke(++e),n=0,s=t[0],i=1,a=function(c){r[n++]=c},o=1;o<=e;++o)if(t[o]==s&&o!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(s),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(s);i=1,s=t[o]}return{c:r.subarray(0,n),n:e}},Er=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},mo=function(t,e,r){var n=r.length,s=po(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var i=0;i<n;++i)t[s+i+4]=r[i];return(s+4+n)*8},Qi=function(t,e,r,n,s,i,a,o,c,u,h){gt(e,h++,r),++s[256];for(var m=Yn(s,15),y=m.t,x=m.l,E=Yn(i,15),_=E.t,p=E.l,R=Zi(y),g=R.c,T=R.n,M=Zi(_),I=M.c,S=M.n,L=new Ke(19),F=0;F<g.length;++F)++L[g[F]&31];for(var F=0;F<I.length;++F)++L[I[F]&31];for(var $=Yn(L,7),z=$.t,j=$.l,H=19;H>4&&!z[Ki[H-1]];--H);var V=u+5<<3,U=Er(s,Ht)+Er(i,gn)+a,X=Er(s,y)+Er(i,_)+a+14+3*H+Er(L,z)+2*L[16]+3*L[17]+7*L[18];if(c>=0&&V<=U&&V<=X)return mo(e,h,t.subarray(c,c+u));var se,Z,le,oe;if(gt(e,h,1+(X<U)),h+=2,X<U){se=$r(y,x,0),Z=y,le=$r(_,p,0),oe=_;var fe=$r(z,j,0);gt(e,h,T-257),gt(e,h+5,S-1),gt(e,h+10,H-4),h+=14;for(var F=0;F<H;++F)gt(e,h+3*F,z[Ki[F]]);h+=3*H;for(var ue=[g,I],de=0;de<2;++de)for(var Ce=ue[de],F=0;F<Ce.length;++F){var me=Ce[F]&31;gt(e,h,fe[me]),h+=z[me],me>15&&(gt(e,h,Ce[F]>>5&127),h+=Ce[F]>>12)}}else se=Ph,Z=Ht,le=Uh,oe=gn;for(var F=0;F<o;++F){var Me=n[F];if(Me>255){var me=Me>>18&31;Mr(e,h,se[me+257]),h+=Z[me+257],me>7&&(gt(e,h,Me>>23&31),h+=Ps[me]);var Ne=Me&31;Mr(e,h,le[Ne]),h+=oe[Ne],Ne>3&&(Mr(e,h,Me>>5&8191),h+=Us[Ne])}else Mr(e,h,se[Me]),h+=Z[Me]}return Mr(e,h,se[256]),h+Z[256]},Bh=new Ds([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),vo=new Be(0),Vh=function(t,e,r,n,s,i){var a=i.z||t.length,o=new Be(n+a+5*(1+Math.ceil(a/7e3))+s),c=o.subarray(n,o.length-s),u=i.l,h=(i.r||0)&7;if(e){h&&(c[0]=i.r>>3);for(var m=Bh[e-1],y=m>>13,x=m&8191,E=(1<<r)-1,_=i.p||new Ke(32768),p=i.h||new Ke(E+1),R=Math.ceil(r/3),g=2*R,T=function(Et){return(t[Et]^t[Et+1]<<R^t[Et+2]<<g)&E},M=new Ds(25e3),I=new Ke(288),S=new Ke(32),L=0,F=0,$=i.i||0,z=0,j=i.w||0,H=0;$+2<a;++$){var V=T($),U=$&32767,X=p[V];if(_[U]=X,p[V]=U,j<=$){var se=a-$;if((L>7e3||z>24576)&&(se>423||!u)){h=Qi(t,c,0,M,I,S,F,z,H,$-H,h),z=L=F=0,H=$;for(var Z=0;Z<286;++Z)I[Z]=0;for(var Z=0;Z<30;++Z)S[Z]=0}var le=2,oe=0,fe=x,ue=U-X&32767;if(se>2&&V==T($-ue))for(var de=Math.min(y,se)-1,Ce=Math.min(32767,$),me=Math.min(258,se);ue<=Ce&&--fe&&U!=X;){if(t[$+le]==t[$+le-ue]){for(var Me=0;Me<me&&t[$+Me]==t[$+Me-ue];++Me);if(Me>le){if(le=Me,oe=ue,Me>de)break;for(var Ne=Math.min(ue,Me-2),Ve=0,Z=0;Z<Ne;++Z){var xt=$-ue+Z&32767,ve=_[xt],We=xt-ve&32767;We>Ve&&(Ve=We,X=xt)}}}U=X,X=_[U],ue+=U-X&32767}if(oe){M[z++]=268435456|fs[le]<<18|Ji[oe];var qe=fs[le]&31,Mt=Ji[oe]&31;F+=Ps[qe]+Us[Mt],++I[257+qe],++S[Mt],j=$+le,++L}else M[z++]=t[$],++I[t[$]]}}for($=Math.max($,j);$<a;++$)M[z++]=t[$],++I[t[$]];h=Qi(t,c,u,M,I,S,F,z,H,$-H,h),u||(i.r=h&7|c[h/8|0]<<3,h-=7,i.h=p,i.p=_,i.i=$,i.w=j)}else{for(var $=i.w||0;$<a+u;$+=65535){var at=$+65535;at>=a&&(c[h/8|0]=u,at=a),h=mo(c,h+1,t.subarray($,at))}i.i=a}return go(o,0,n+po(h)+s)},jh=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),kh=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=jh[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},zh=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),a=new Be(i.length+t.length);a.set(i),a.set(t,i.length),t=a,s.w=i.length}return Vh(t,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,r,n,s)},yo=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Le=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function Gh(t,e){return zh(t,e||{},0,0)}var xo=function(t,e,r,n){for(var s in t){var i=t[s],a=e+s,o=n;Array.isArray(i)&&(o=yo(n,i[1]),i=i[0]),i instanceof Be?r[a]=[i,o]:(r[a+="/"]=[new Be(0),o],xo(i,a,r,n))}},ea=typeof TextEncoder<"u"&&new TextEncoder,qh=typeof TextDecoder<"u"&&new TextDecoder,Hh=0;try{qh.decode(vo,{stream:!0}),Hh=1}catch{}function Fr(t,e){if(e){for(var r=new Be(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(ea)return ea.encode(t);for(var s=t.length,i=new Be(t.length+(t.length>>1)),a=0,o=function(h){i[a++]=h},n=0;n<s;++n){if(a+5>i.length){var c=new Be(a+8+(s-n<<1));c.set(i),i=c}var u=t.charCodeAt(n);u<128||e?o(u):u<2048?(o(192|u>>6),o(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|t.charCodeAt(++n)&1023,o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63)):(o(224|u>>12),o(128|u>>6&63),o(128|u&63))}return go(i,0,a)}var ps=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&wn(9),e+=n+4}return e},ta=function(t,e,r,n,s,i,a,o){var c=n.length,u=r.extra,h=o&&o.length,m=ps(u);Le(t,e,a!=null?33639248:67324752),e+=4,a!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(i<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var y=new Date(r.mtime==null?Date.now():r.mtime),x=y.getFullYear()-1980;if((x<0||x>119)&&wn(10),Le(t,e,x<<25|y.getMonth()+1<<21|y.getDate()<<16|y.getHours()<<11|y.getMinutes()<<5|y.getSeconds()>>1),e+=4,i!=-1&&(Le(t,e,r.crc),Le(t,e+4,i<0?-i-2:i),Le(t,e+8,r.size)),Le(t,e+12,c),Le(t,e+14,m),e+=16,a!=null&&(Le(t,e,h),Le(t,e+6,r.attrs),Le(t,e+10,a),e+=14),t.set(n,e),e+=c,m)for(var E in u){var _=u[E],p=_.length;Le(t,e,+E),Le(t,e+2,p),t.set(_,e+4),e+=4+p}return h&&(t.set(o,e),e+=h),e},Wh=function(t,e,r,n,s){Le(t,e,101010256),Le(t,e+8,r),Le(t,e+10,r),Le(t,e+12,n),Le(t,e+16,s)};function Xh(t,e){e||(e={});var r={},n=[];xo(t,"",r,e);var s=0,i=0;for(var a in r){var o=r[a],c=o[0],u=o[1],h=u.level==0?0:8,m=Fr(a),y=m.length,x=u.comment,E=x&&Fr(x),_=E&&E.length,p=ps(u.extra);y>65535&&wn(11);var R=h?Gh(c,u):c,g=R.length,T=kh();T.p(c),n.push(yo(u,{size:c.length,crc:T.d(),c:R,f:m,m:E,u:y!=a.length||E&&x.length!=_,o:s,compression:h})),s+=30+y+p+g,i+=76+2*(y+p)+(_||0)+g}for(var M=new Be(i+22),I=s,S=i-s,L=0;L<n.length;++L){var m=n[L];ta(M,m.o,m,m.f,m.u,m.c.length);var F=30+m.f.length+ps(m.extra);M.set(m.c,m.o+F),ta(M,s,m,m.f,m.u,m.c.length,m.o,m.m),s+=16+F+(m.m?m.m.length:0)}return Wh(M,s,n.length,S,I),M}var W=1e-6,ee=typeof Float32Array<"u"?Float32Array:Array,nt=Math.random;function To(t){ee=t}var Yh=Math.PI/180;function Kh(t){return t*Yh}function Jh(t,e){return Math.abs(t-e)<=W*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Zh=Object.freeze({__proto__:null,get ARRAY_TYPE(){return ee},EPSILON:W,RANDOM:nt,equals:Jh,setMatrixArrayType:To,toRadian:Kh});function Qh(){var t=new ee(4);return ee!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function ep(t){var e=new ee(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function tp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function rp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function np(t,e,r,n){var s=new ee(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function sp(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function ip(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function ap(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*i-s*n;return a?(a=1/a,t[0]=i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t):null}function op(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function cp(t){return t[0]*t[3]-t[2]*t[1]}function Mo(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],u=r[2],h=r[3];return t[0]=n*o+i*c,t[1]=s*o+a*c,t[2]=n*u+i*h,t[3]=s*u+a*h,t}function lp(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+i*o,t[1]=s*c+a*o,t[2]=n*-o+i*c,t[3]=s*-o+a*c,t}function fp(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1];return t[0]=n*o,t[1]=s*o,t[2]=i*c,t[3]=a*c,t}function up(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function hp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function pp(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function dp(t){return Math.hypot(t[0],t[1],t[2],t[3])}function gp(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function mp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Eo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function vp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function yp(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],u=e[3];return Math.abs(r-a)<=W*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=W*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=W*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=W*Math.max(1,Math.abs(i),Math.abs(u))}function xp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Tp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var Mp=Mo,Ep=Eo,wp=Object.freeze({__proto__:null,LDU:gp,add:mp,adjoint:op,clone:ep,copy:tp,create:Qh,determinant:cp,equals:yp,exactEquals:vp,frob:dp,fromRotation:up,fromScaling:hp,fromValues:np,identity:rp,invert:ap,mul:Mp,multiply:Mo,multiplyScalar:xp,multiplyScalarAndAdd:Tp,rotate:lp,scale:fp,set:sp,str:pp,sub:Ep,subtract:Eo,transpose:ip});function Rp(){var t=new ee(6);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function _p(t){var e=new ee(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Ip(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ap(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function bp(t,e,r,n,s,i){var a=new ee(6);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a[4]=s,a[5]=i,a}function Sp(t,e,r,n,s,i,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t}function Cp(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=r*i-n*s;return c?(c=1/c,t[0]=i*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t[4]=(s*o-i*a)*c,t[5]=(n*a-r*o)*c,t):null}function Np(t){return t[0]*t[3]-t[1]*t[2]}function wo(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=r[0],h=r[1],m=r[2],y=r[3],x=r[4],E=r[5];return t[0]=n*u+i*h,t[1]=s*u+a*h,t[2]=n*m+i*y,t[3]=s*m+a*y,t[4]=n*x+i*E+o,t[5]=s*x+a*E+c,t}function Op(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*u,t[1]=s*h+a*u,t[2]=n*-u+i*h,t[3]=s*-u+a*h,t[4]=o,t[5]=c,t}function $p(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=r[0],h=r[1];return t[0]=n*u,t[1]=s*u,t[2]=i*h,t[3]=a*h,t[4]=o,t[5]=c,t}function Fp(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=r[0],h=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=n*u+i*h+o,t[5]=s*u+a*h+c,t}function Dp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function Pp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Up(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Lp(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Bp(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function Vp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Ro(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function jp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function kp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function zp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Gp(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=e[0],u=e[1],h=e[2],m=e[3],y=e[4],x=e[5];return Math.abs(r-c)<=W*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=W*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=W*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(i-m)<=W*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-y)<=W*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(o-x)<=W*Math.max(1,Math.abs(o),Math.abs(x))}var qp=wo,Hp=Ro,Wp=Object.freeze({__proto__:null,add:Vp,clone:_p,copy:Ip,create:Rp,determinant:Np,equals:Gp,exactEquals:zp,frob:Bp,fromRotation:Dp,fromScaling:Pp,fromTranslation:Up,fromValues:bp,identity:Ap,invert:Cp,mul:qp,multiply:wo,multiplyScalar:jp,multiplyScalarAndAdd:kp,rotate:Op,scale:$p,set:Sp,str:Lp,sub:Hp,subtract:Ro,translate:Fp});function _o(){var t=new ee(9);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Xp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Yp(t){var e=new ee(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Kp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Jp(t,e,r,n,s,i,a,o,c){var u=new ee(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=s,u[5]=i,u[6]=a,u[7]=o,u[8]=c,u}function Zp(t,e,r,n,s,i,a,o,c,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t}function Qp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function e1(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function t1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],m=h*a-o*u,y=-h*i+o*c,x=u*i-a*c,E=r*m+n*y+s*x;return E?(E=1/E,t[0]=m*E,t[1]=(-h*n+s*u)*E,t[2]=(o*n-s*a)*E,t[3]=y*E,t[4]=(h*r-s*c)*E,t[5]=(-o*r+s*i)*E,t[6]=x*E,t[7]=(-u*r+n*c)*E,t[8]=(a*r-n*i)*E,t):null}function r1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8];return t[0]=a*h-o*u,t[1]=s*u-n*h,t[2]=n*o-s*a,t[3]=o*c-i*h,t[4]=r*h-s*c,t[5]=s*i-r*o,t[6]=i*u-a*c,t[7]=n*c-r*u,t[8]=r*a-n*i,t}function n1(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],u=t[8];return e*(u*i-a*c)+r*(-u*s+a*o)+n*(c*s-i*o)}function Io(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=e[8],y=r[0],x=r[1],E=r[2],_=r[3],p=r[4],R=r[5],g=r[6],T=r[7],M=r[8];return t[0]=y*n+x*a+E*u,t[1]=y*s+x*o+E*h,t[2]=y*i+x*c+E*m,t[3]=_*n+p*a+R*u,t[4]=_*s+p*o+R*h,t[5]=_*i+p*c+R*m,t[6]=g*n+T*a+M*u,t[7]=g*s+T*o+M*h,t[8]=g*i+T*c+M*m,t}function s1(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=e[8],y=r[0],x=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=o,t[5]=c,t[6]=y*n+x*a+u,t[7]=y*s+x*o+h,t[8]=y*i+x*c+m,t}function i1(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=e[8],y=Math.sin(r),x=Math.cos(r);return t[0]=x*n+y*a,t[1]=x*s+y*o,t[2]=x*i+y*c,t[3]=x*a-y*n,t[4]=x*o-y*s,t[5]=x*c-y*i,t[6]=u,t[7]=h,t[8]=m,t}function a1(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function o1(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function c1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function l1(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function f1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function u1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,u=r*a,h=n*a,m=n*o,y=s*a,x=s*o,E=s*c,_=i*a,p=i*o,R=i*c;return t[0]=1-m-E,t[3]=h-R,t[6]=y+p,t[1]=h+R,t[4]=1-u-E,t[7]=x-_,t[2]=y-p,t[5]=x+_,t[8]=1-u-m,t}function h1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],m=e[9],y=e[10],x=e[11],E=e[12],_=e[13],p=e[14],R=e[15],g=r*o-n*a,T=r*c-s*a,M=r*u-i*a,I=n*c-s*o,S=n*u-i*o,L=s*u-i*c,F=h*_-m*E,$=h*p-y*E,z=h*R-x*E,j=m*p-y*_,H=m*R-x*_,V=y*R-x*p,U=g*V-T*H+M*j+I*z-S*$+L*F;return U?(U=1/U,t[0]=(o*V-c*H+u*j)*U,t[1]=(c*z-a*V-u*$)*U,t[2]=(a*H-o*z+u*F)*U,t[3]=(s*H-n*V-i*j)*U,t[4]=(r*V-s*z+i*$)*U,t[5]=(n*z-r*H-i*F)*U,t[6]=(_*L-p*S+R*I)*U,t[7]=(p*M-E*L-R*T)*U,t[8]=(E*S-_*M+R*g)*U,t):null}function p1(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function d1(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function g1(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function m1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Ao(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function v1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function y1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function x1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function T1(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],h=t[8],m=e[0],y=e[1],x=e[2],E=e[3],_=e[4],p=e[5],R=e[6],g=e[7],T=e[8];return Math.abs(r-m)<=W*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-y)<=W*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-x)<=W*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(i-E)<=W*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-_)<=W*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-p)<=W*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-R)<=W*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(u-g)<=W*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(h-T)<=W*Math.max(1,Math.abs(h),Math.abs(T))}var M1=Io,E1=Ao,w1=Object.freeze({__proto__:null,add:m1,adjoint:r1,clone:Yp,copy:Kp,create:_o,determinant:n1,equals:T1,exactEquals:x1,frob:g1,fromMat2d:f1,fromMat4:Xp,fromQuat:u1,fromRotation:c1,fromScaling:l1,fromTranslation:o1,fromValues:Jp,identity:Qp,invert:t1,mul:M1,multiply:Io,multiplyScalar:v1,multiplyScalarAndAdd:y1,normalFromMat4:h1,projection:p1,rotate:i1,scale:a1,set:Zp,str:d1,sub:E1,subtract:Ao,translate:s1,transpose:e1});function R1(){var t=new ee(16);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _1(t){var e=new ee(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function I1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function A1(t,e,r,n,s,i,a,o,c,u,h,m,y,x,E,_){var p=new ee(16);return p[0]=t,p[1]=e,p[2]=r,p[3]=n,p[4]=s,p[5]=i,p[6]=a,p[7]=o,p[8]=c,p[9]=u,p[10]=h,p[11]=m,p[12]=y,p[13]=x,p[14]=E,p[15]=_,p}function b1(t,e,r,n,s,i,a,o,c,u,h,m,y,x,E,_,p){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t[9]=h,t[10]=m,t[11]=y,t[12]=x,t[13]=E,t[14]=_,t[15]=p,t}function bo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function S1(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],i=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function C1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],m=e[9],y=e[10],x=e[11],E=e[12],_=e[13],p=e[14],R=e[15],g=r*o-n*a,T=r*c-s*a,M=r*u-i*a,I=n*c-s*o,S=n*u-i*o,L=s*u-i*c,F=h*_-m*E,$=h*p-y*E,z=h*R-x*E,j=m*p-y*_,H=m*R-x*_,V=y*R-x*p,U=g*V-T*H+M*j+I*z-S*$+L*F;return U?(U=1/U,t[0]=(o*V-c*H+u*j)*U,t[1]=(s*H-n*V-i*j)*U,t[2]=(_*L-p*S+R*I)*U,t[3]=(y*S-m*L-x*I)*U,t[4]=(c*z-a*V-u*$)*U,t[5]=(r*V-s*z+i*$)*U,t[6]=(p*M-E*L-R*T)*U,t[7]=(h*L-y*M+x*T)*U,t[8]=(a*H-o*z+u*F)*U,t[9]=(n*z-r*H-i*F)*U,t[10]=(E*S-_*M+R*g)*U,t[11]=(m*M-h*S-x*g)*U,t[12]=(o*$-a*j-c*F)*U,t[13]=(r*j-n*$+s*F)*U,t[14]=(_*T-E*I-p*g)*U,t[15]=(h*I-m*T+y*g)*U,t):null}function N1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],m=e[9],y=e[10],x=e[11],E=e[12],_=e[13],p=e[14],R=e[15];return t[0]=o*(y*R-x*p)-m*(c*R-u*p)+_*(c*x-u*y),t[1]=-(n*(y*R-x*p)-m*(s*R-i*p)+_*(s*x-i*y)),t[2]=n*(c*R-u*p)-o*(s*R-i*p)+_*(s*u-i*c),t[3]=-(n*(c*x-u*y)-o*(s*x-i*y)+m*(s*u-i*c)),t[4]=-(a*(y*R-x*p)-h*(c*R-u*p)+E*(c*x-u*y)),t[5]=r*(y*R-x*p)-h*(s*R-i*p)+E*(s*x-i*y),t[6]=-(r*(c*R-u*p)-a*(s*R-i*p)+E*(s*u-i*c)),t[7]=r*(c*x-u*y)-a*(s*x-i*y)+h*(s*u-i*c),t[8]=a*(m*R-x*_)-h*(o*R-u*_)+E*(o*x-u*m),t[9]=-(r*(m*R-x*_)-h*(n*R-i*_)+E*(n*x-i*m)),t[10]=r*(o*R-u*_)-a*(n*R-i*_)+E*(n*u-i*o),t[11]=-(r*(o*x-u*m)-a*(n*x-i*m)+h*(n*u-i*o)),t[12]=-(a*(m*p-y*_)-h*(o*p-c*_)+E*(o*y-c*m)),t[13]=r*(m*p-y*_)-h*(n*p-s*_)+E*(n*y-s*m),t[14]=-(r*(o*p-c*_)-a*(n*p-s*_)+E*(n*c-s*o)),t[15]=r*(o*y-c*m)-a*(n*y-s*m)+h*(n*c-s*o),t}function O1(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],u=t[8],h=t[9],m=t[10],y=t[11],x=t[12],E=t[13],_=t[14],p=t[15],R=e*a-r*i,g=e*o-n*i,T=e*c-s*i,M=r*o-n*a,I=r*c-s*a,S=n*c-s*o,L=u*E-h*x,F=u*_-m*x,$=u*p-y*x,z=h*_-m*E,j=h*p-y*E,H=m*p-y*_;return R*H-g*j+T*z+M*$-I*F+S*L}function So(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=e[8],y=e[9],x=e[10],E=e[11],_=e[12],p=e[13],R=e[14],g=e[15],T=r[0],M=r[1],I=r[2],S=r[3];return t[0]=T*n+M*o+I*m+S*_,t[1]=T*s+M*c+I*y+S*p,t[2]=T*i+M*u+I*x+S*R,t[3]=T*a+M*h+I*E+S*g,T=r[4],M=r[5],I=r[6],S=r[7],t[4]=T*n+M*o+I*m+S*_,t[5]=T*s+M*c+I*y+S*p,t[6]=T*i+M*u+I*x+S*R,t[7]=T*a+M*h+I*E+S*g,T=r[8],M=r[9],I=r[10],S=r[11],t[8]=T*n+M*o+I*m+S*_,t[9]=T*s+M*c+I*y+S*p,t[10]=T*i+M*u+I*x+S*R,t[11]=T*a+M*h+I*E+S*g,T=r[12],M=r[13],I=r[14],S=r[15],t[12]=T*n+M*o+I*m+S*_,t[13]=T*s+M*c+I*y+S*p,t[14]=T*i+M*u+I*x+S*R,t[15]=T*a+M*h+I*E+S*g,t}function $1(t,e,r){var n=r[0],s=r[1],i=r[2],a,o,c,u,h,m,y,x,E,_,p,R;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*i+e[12],t[13]=e[1]*n+e[5]*s+e[9]*i+e[13],t[14]=e[2]*n+e[6]*s+e[10]*i+e[14],t[15]=e[3]*n+e[7]*s+e[11]*i+e[15]):(a=e[0],o=e[1],c=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],E=e[8],_=e[9],p=e[10],R=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=u,t[4]=h,t[5]=m,t[6]=y,t[7]=x,t[8]=E,t[9]=_,t[10]=p,t[11]=R,t[12]=a*n+h*s+E*i+e[12],t[13]=o*n+m*s+_*i+e[13],t[14]=c*n+y*s+p*i+e[14],t[15]=u*n+x*s+R*i+e[15]),t}function F1(t,e,r){var n=r[0],s=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function D1(t,e,r,n){var s=n[0],i=n[1],a=n[2],o=Math.hypot(s,i,a),c,u,h,m,y,x,E,_,p,R,g,T,M,I,S,L,F,$,z,j,H,V,U,X;return o<W?null:(o=1/o,s*=o,i*=o,a*=o,c=Math.sin(r),u=Math.cos(r),h=1-u,m=e[0],y=e[1],x=e[2],E=e[3],_=e[4],p=e[5],R=e[6],g=e[7],T=e[8],M=e[9],I=e[10],S=e[11],L=s*s*h+u,F=i*s*h+a*c,$=a*s*h-i*c,z=s*i*h-a*c,j=i*i*h+u,H=a*i*h+s*c,V=s*a*h+i*c,U=i*a*h-s*c,X=a*a*h+u,t[0]=m*L+_*F+T*$,t[1]=y*L+p*F+M*$,t[2]=x*L+R*F+I*$,t[3]=E*L+g*F+S*$,t[4]=m*z+_*j+T*H,t[5]=y*z+p*j+M*H,t[6]=x*z+R*j+I*H,t[7]=E*z+g*j+S*H,t[8]=m*V+_*U+T*X,t[9]=y*V+p*U+M*X,t[10]=x*V+R*U+I*X,t[11]=E*V+g*U+S*X,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function P1(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[4],a=e[5],o=e[6],c=e[7],u=e[8],h=e[9],m=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+u*n,t[5]=a*s+h*n,t[6]=o*s+m*n,t[7]=c*s+y*n,t[8]=u*s-i*n,t[9]=h*s-a*n,t[10]=m*s-o*n,t[11]=y*s-c*n,t}function U1(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],u=e[8],h=e[9],m=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-u*n,t[1]=a*s-h*n,t[2]=o*s-m*n,t[3]=c*s-y*n,t[8]=i*n+u*s,t[9]=a*n+h*s,t[10]=o*n+m*s,t[11]=c*n+y*s,t}function L1(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],u=e[4],h=e[5],m=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+u*n,t[1]=a*s+h*n,t[2]=o*s+m*n,t[3]=c*s+y*n,t[4]=u*s-i*n,t[5]=h*s-a*n,t[6]=m*s-o*n,t[7]=y*s-c*n,t}function B1(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function V1(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function j1(t,e,r){var n=r[0],s=r[1],i=r[2],a=Math.hypot(n,s,i),o,c,u;return a<W?null:(a=1/a,n*=a,s*=a,i*=a,o=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=n*n*u+c,t[1]=s*n*u+i*o,t[2]=i*n*u-s*o,t[3]=0,t[4]=n*s*u-i*o,t[5]=s*s*u+c,t[6]=i*s*u+n*o,t[7]=0,t[8]=n*i*u+s*o,t[9]=s*i*u-n*o,t[10]=i*i*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function k1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function z1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function G1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Co(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=n+n,c=s+s,u=i+i,h=n*o,m=n*c,y=n*u,x=s*c,E=s*u,_=i*u,p=a*o,R=a*c,g=a*u;return t[0]=1-(x+_),t[1]=m+g,t[2]=y-R,t[3]=0,t[4]=m-g,t[5]=1-(h+_),t[6]=E+p,t[7]=0,t[8]=y+R,t[9]=E-p,t[10]=1-(h+x),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function q1(t,e){var r=new ee(3),n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=n*n+s*s+i*i+a*a;return m>0?(r[0]=(o*a+h*n+c*i-u*s)*2/m,r[1]=(c*a+h*s+u*n-o*i)*2/m,r[2]=(u*a+h*i+o*s-c*n)*2/m):(r[0]=(o*a+h*n+c*i-u*s)*2,r[1]=(c*a+h*s+u*n-o*i)*2,r[2]=(u*a+h*i+o*s-c*n)*2),Co(t,e,r),t}function No(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Oo(t,e){var r=e[0],n=e[1],s=e[2],i=e[4],a=e[5],o=e[6],c=e[8],u=e[9],h=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(c,u,h),t}function $o(t,e){var r=new ee(3);Oo(r,e);var n=1/r[0],s=1/r[1],i=1/r[2],a=e[0]*n,o=e[1]*s,c=e[2]*i,u=e[4]*n,h=e[5]*s,m=e[6]*i,y=e[8]*n,x=e[9]*s,E=e[10]*i,_=a+h+E,p=0;return _>0?(p=Math.sqrt(_+1)*2,t[3]=.25*p,t[0]=(m-x)/p,t[1]=(y-c)/p,t[2]=(o-u)/p):a>h&&a>E?(p=Math.sqrt(1+a-h-E)*2,t[3]=(m-x)/p,t[0]=.25*p,t[1]=(o+u)/p,t[2]=(y+c)/p):h>E?(p=Math.sqrt(1+h-a-E)*2,t[3]=(y-c)/p,t[0]=(o+u)/p,t[1]=.25*p,t[2]=(m+x)/p):(p=Math.sqrt(1+E-a-h)*2,t[3]=(o-u)/p,t[0]=(y+c)/p,t[1]=(m+x)/p,t[2]=.25*p),t}function H1(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=s+s,u=i+i,h=a+a,m=s*c,y=s*u,x=s*h,E=i*u,_=i*h,p=a*h,R=o*c,g=o*u,T=o*h,M=n[0],I=n[1],S=n[2];return t[0]=(1-(E+p))*M,t[1]=(y+T)*M,t[2]=(x-g)*M,t[3]=0,t[4]=(y-T)*I,t[5]=(1-(m+p))*I,t[6]=(_+R)*I,t[7]=0,t[8]=(x+g)*S,t[9]=(_-R)*S,t[10]=(1-(m+E))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function W1(t,e,r,n,s){var i=e[0],a=e[1],o=e[2],c=e[3],u=i+i,h=a+a,m=o+o,y=i*u,x=i*h,E=i*m,_=a*h,p=a*m,R=o*m,g=c*u,T=c*h,M=c*m,I=n[0],S=n[1],L=n[2],F=s[0],$=s[1],z=s[2],j=(1-(_+R))*I,H=(x+M)*I,V=(E-T)*I,U=(x-M)*S,X=(1-(y+R))*S,se=(p+g)*S,Z=(E+T)*L,le=(p-g)*L,oe=(1-(y+_))*L;return t[0]=j,t[1]=H,t[2]=V,t[3]=0,t[4]=U,t[5]=X,t[6]=se,t[7]=0,t[8]=Z,t[9]=le,t[10]=oe,t[11]=0,t[12]=r[0]+F-(j*F+U*$+Z*z),t[13]=r[1]+$-(H*F+X*$+le*z),t[14]=r[2]+z-(V*F+se*$+oe*z),t[15]=1,t}function X1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,u=r*a,h=n*a,m=n*o,y=s*a,x=s*o,E=s*c,_=i*a,p=i*o,R=i*c;return t[0]=1-m-E,t[1]=h+R,t[2]=y-p,t[3]=0,t[4]=h-R,t[5]=1-u-E,t[6]=x+_,t[7]=0,t[8]=y+p,t[9]=x-_,t[10]=1-u-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y1(t,e,r,n,s,i,a){var o=1/(r-e),c=1/(s-n),u=1/(i-a);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(s+n)*c,t[10]=(a+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*u,t[15]=0,t}function Fo(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=(s+n)*a,t[14]=2*s*n*a):(t[10]=-1,t[14]=-2*n),t}var K1=Fo;function J1(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=s*a,t[14]=s*n*a):(t[10]=-1,t[14]=-n),t}function Z1(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),u=2/(s+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(s-i)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function Do(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),u=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=(a+i)*u,t[15]=1,t}var Q1=Do;function ed(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),u=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=i*u,t[15]=1,t}function td(t,e,r,n){var s,i,a,o,c,u,h,m,y,x,E=e[0],_=e[1],p=e[2],R=n[0],g=n[1],T=n[2],M=r[0],I=r[1],S=r[2];return Math.abs(E-M)<W&&Math.abs(_-I)<W&&Math.abs(p-S)<W?bo(t):(h=E-M,m=_-I,y=p-S,x=1/Math.hypot(h,m,y),h*=x,m*=x,y*=x,s=g*y-T*m,i=T*h-R*y,a=R*m-g*h,x=Math.hypot(s,i,a),x?(x=1/x,s*=x,i*=x,a*=x):(s=0,i=0,a=0),o=m*a-y*i,c=y*s-h*a,u=h*i-m*s,x=Math.hypot(o,c,u),x?(x=1/x,o*=x,c*=x,u*=x):(o=0,c=0,u=0),t[0]=s,t[1]=o,t[2]=h,t[3]=0,t[4]=i,t[5]=c,t[6]=m,t[7]=0,t[8]=a,t[9]=u,t[10]=y,t[11]=0,t[12]=-(s*E+i*_+a*p),t[13]=-(o*E+c*_+u*p),t[14]=-(h*E+m*_+y*p),t[15]=1,t)}function rd(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=n[0],c=n[1],u=n[2],h=s-r[0],m=i-r[1],y=a-r[2],x=h*h+m*m+y*y;x>0&&(x=1/Math.sqrt(x),h*=x,m*=x,y*=x);var E=c*y-u*m,_=u*h-o*y,p=o*m-c*h;return x=E*E+_*_+p*p,x>0&&(x=1/Math.sqrt(x),E*=x,_*=x,p*=x),t[0]=E,t[1]=_,t[2]=p,t[3]=0,t[4]=m*p-y*_,t[5]=y*E-h*p,t[6]=h*_-m*E,t[7]=0,t[8]=h,t[9]=m,t[10]=y,t[11]=0,t[12]=s,t[13]=i,t[14]=a,t[15]=1,t}function nd(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function sd(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function id(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Po(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function ad(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function od(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function cd(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function ld(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],h=t[8],m=t[9],y=t[10],x=t[11],E=t[12],_=t[13],p=t[14],R=t[15],g=e[0],T=e[1],M=e[2],I=e[3],S=e[4],L=e[5],F=e[6],$=e[7],z=e[8],j=e[9],H=e[10],V=e[11],U=e[12],X=e[13],se=e[14],Z=e[15];return Math.abs(r-g)<=W*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-T)<=W*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(s-M)<=W*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(i-I)<=W*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(a-S)<=W*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-L)<=W*Math.max(1,Math.abs(o),Math.abs(L))&&Math.abs(c-F)<=W*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(u-$)<=W*Math.max(1,Math.abs(u),Math.abs($))&&Math.abs(h-z)<=W*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(m-j)<=W*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(y-H)<=W*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(x-V)<=W*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(E-U)<=W*Math.max(1,Math.abs(E),Math.abs(U))&&Math.abs(_-X)<=W*Math.max(1,Math.abs(_),Math.abs(X))&&Math.abs(p-se)<=W*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(R-Z)<=W*Math.max(1,Math.abs(R),Math.abs(Z))}var fd=So,ud=Po,hd=Object.freeze({__proto__:null,add:id,adjoint:N1,clone:_1,copy:I1,create:R1,determinant:O1,equals:ld,exactEquals:cd,frob:sd,fromQuat:X1,fromQuat2:q1,fromRotation:j1,fromRotationTranslation:Co,fromRotationTranslationScale:H1,fromRotationTranslationScaleOrigin:W1,fromScaling:V1,fromTranslation:B1,fromValues:A1,fromXRotation:k1,fromYRotation:z1,fromZRotation:G1,frustum:Y1,getRotation:$o,getScaling:Oo,getTranslation:No,identity:bo,invert:C1,lookAt:td,mul:fd,multiply:So,multiplyScalar:ad,multiplyScalarAndAdd:od,ortho:Q1,orthoNO:Do,orthoZO:ed,perspective:K1,perspectiveFromFieldOfView:Z1,perspectiveNO:Fo,perspectiveZO:J1,rotate:D1,rotateX:P1,rotateY:U1,rotateZ:L1,scale:F1,set:b1,str:nd,sub:ud,subtract:Po,targetTo:rd,translate:$1,transpose:S1});function Ls(){var t=new ee(3);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pd(t){var e=new ee(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Uo(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function ds(t,e,r){var n=new ee(3);return n[0]=t,n[1]=e,n[2]=r,n}function dd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function gd(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function md(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Lo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Bo(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Vo(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function vd(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function yd(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function xd(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Td(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Md(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Ed(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function wd(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function jo(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function ko(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function zo(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function Rd(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function _d(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Go(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Bs(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function an(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2];return t[0]=s*c-i*o,t[1]=i*a-n*c,t[2]=n*o-s*a,t}function Id(t,e,r,n){var s=e[0],i=e[1],a=e[2];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t}function Ad(t,e,r,n,s,i){var a=i*i,o=a*(2*i-3)+1,c=a*(i-2)+i,u=a*(i-1),h=a*(3-2*i);return t[0]=e[0]*o+r[0]*c+n[0]*u+s[0]*h,t[1]=e[1]*o+r[1]*c+n[1]*u+s[1]*h,t[2]=e[2]*o+r[2]*c+n[2]*u+s[2]*h,t}function bd(t,e,r,n,s,i){var a=1-i,o=a*a,c=i*i,u=o*a,h=3*i*o,m=3*c*a,y=c*i;return t[0]=e[0]*u+r[0]*h+n[0]*m+s[0]*y,t[1]=e[1]*u+r[1]*h+n[1]*m+s[1]*y,t[2]=e[2]*u+r[2]*h+n[2]*m+s[2]*y,t}function Sd(t,e){e=e||1;var r=nt()*2*Math.PI,n=nt()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function Cd(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function Nd(t,e,r){var n=e[0],s=e[1],i=e[2];return t[0]=n*r[0]+s*r[3]+i*r[6],t[1]=n*r[1]+s*r[4]+i*r[7],t[2]=n*r[2]+s*r[5]+i*r[8],t}function Od(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],u=e[2],h=s*u-i*c,m=i*o-n*u,y=n*c-s*o,x=s*y-i*m,E=i*h-n*y,_=n*m-s*h,p=a*2;return h*=p,m*=p,y*=p,x*=2,E*=2,_*=2,t[0]=o+h+x,t[1]=c+m+E,t[2]=u+y+_,t}function $d(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Fd(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Dd(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Pd(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2],c=Math.sqrt(r*r+n*n+s*s),u=Math.sqrt(i*i+a*a+o*o),h=c*u,m=h&&Bs(t,e)/h;return Math.acos(Math.min(Math.max(m,-1),1))}function Ud(t){return t[0]=0,t[1]=0,t[2]=0,t}function Ld(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Bd(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Vd(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2];return Math.abs(r-i)<=W*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=W*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-o)<=W*Math.max(1,Math.abs(s),Math.abs(o))}var jd=Lo,kd=Bo,zd=Vo,Gd=jo,qd=ko,qo=Uo,Hd=zo,Wd=function(){var t=Ls();return function(e,r,n,s,i,a){var o,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),Xd=Object.freeze({__proto__:null,add:md,angle:Pd,bezier:bd,ceil:vd,clone:pd,copy:dd,create:Ls,cross:an,dist:Gd,distance:jo,div:zd,divide:Vo,dot:Bs,equals:Vd,exactEquals:Bd,floor:yd,forEach:Wd,fromValues:ds,hermite:Ad,inverse:_d,len:qo,length:Uo,lerp:Id,max:Td,min:xd,mul:kd,multiply:Bo,negate:Rd,normalize:Go,random:Sd,rotateX:$d,rotateY:Fd,rotateZ:Dd,round:Md,scale:Ed,scaleAndAdd:wd,set:gd,sqrDist:qd,sqrLen:Hd,squaredDistance:ko,squaredLength:zo,str:Ld,sub:jd,subtract:Lo,transformMat3:Nd,transformMat4:Cd,transformQuat:Od,zero:Ud});function Ho(){var t=new ee(4);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Wo(t){var e=new ee(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xo(t,e,r,n){var s=new ee(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function Yo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ko(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Jo(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Zo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Qo(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ec(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Yd(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Kd(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Jd(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Zd(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Qd(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function tc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function eg(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function rc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return Math.hypot(r,n,s,i)}function nc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+s*s+i*i}function Vs(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function js(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function tg(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function rg(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function sc(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=s*a,t[3]=i*a,t}function ic(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function ng(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],h=e[0],m=e[1],y=e[2],x=e[3];return t[0]=m*u-y*c+x*o,t[1]=-(h*u)+y*a-x*i,t[2]=h*c-m*a+x*s,t[3]=-(h*o)+m*i-y*s,t}function ac(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t[3]=o+n*(r[3]-o),t}function sg(t,e){e=e||1;var r,n,s,i,a,o;do r=nt()*2-1,n=nt()*2-1,a=r*r+n*n;while(a>=1);do s=nt()*2-1,i=nt()*2-1,o=s*s+i*i;while(o>=1);var c=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*i*c,t}function ig(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*a,t[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*a,t[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*a,t[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*a,t}function ag(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2],u=r[3],h=u*n+o*i-c*s,m=u*s+c*n-a*i,y=u*i+a*s-o*n,x=-a*n-o*s-c*i;return t[0]=h*u+x*-a+m*-c-y*-o,t[1]=m*u+x*-o+y*-a-h*-c,t[2]=y*u+x*-c+h*-o-m*-a,t[3]=e[3],t}function og(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function cg(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function oc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function cc(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],u=e[3];return Math.abs(r-a)<=W*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=W*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=W*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=W*Math.max(1,Math.abs(i),Math.abs(u))}var lg=Zo,fg=Qo,ug=ec,hg=rc,pg=nc,dg=Vs,gg=js,mg=function(){var t=Ho();return function(e,r,n,s,i,a){var o,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),vg=Object.freeze({__proto__:null,add:Jo,ceil:Yd,clone:Wo,copy:Yo,create:Ho,cross:ng,dist:hg,distance:rc,div:ug,divide:ec,dot:ic,equals:cc,exactEquals:oc,floor:Kd,forEach:mg,fromValues:Xo,inverse:rg,len:dg,length:Vs,lerp:ac,max:Zd,min:Jd,mul:fg,multiply:Qo,negate:tg,normalize:sc,random:sg,round:Qd,scale:tc,scaleAndAdd:eg,set:Ko,sqrDist:pg,sqrLen:gg,squaredDistance:nc,squaredLength:js,str:cg,sub:lg,subtract:Zo,transformMat4:ig,transformQuat:ag,zero:og});function mn(){var t=new ee(4);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function yg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function lc(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function xg(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>W?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function Tg(t,e){var r=zs(t,e);return Math.acos(2*r*r-1)}function fc(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],u=r[2],h=r[3];return t[0]=n*h+a*o+s*u-i*c,t[1]=s*h+a*c+i*o-n*u,t[2]=i*h+a*u+n*c-s*o,t[3]=a*h-n*o-s*c-i*u,t}function uc(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=s*c+i*o,t[2]=i*c-s*o,t[3]=a*c-n*o,t}function hc(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*o,t[1]=s*c+a*o,t[2]=i*c+n*o,t[3]=a*c-s*o,t}function pc(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+s*o,t[1]=s*c-n*o,t[2]=i*c+a*o,t[3]=a*c-i*o,t}function Mg(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function dc(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=Math.exp(i),c=a>0?o*Math.sin(a)/a:0;return t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=o*Math.cos(a),t}function gc(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=a>0?Math.atan2(a,i)/a:0;return t[0]=r*o,t[1]=n*o,t[2]=s*o,t[3]=.5*Math.log(r*r+n*n+s*s+i*i),t}function Eg(t,e,r){return gc(t,e),vc(t,t,r),dc(t,t),t}function on(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=r[0],u=r[1],h=r[2],m=r[3],y,x,E,_,p;return x=s*c+i*u+a*h+o*m,x<0&&(x=-x,c=-c,u=-u,h=-h,m=-m),1-x>W?(y=Math.acos(x),E=Math.sin(y),_=Math.sin((1-n)*y)/E,p=Math.sin(n*y)/E):(_=1-n,p=n),t[0]=_*s+p*c,t[1]=_*i+p*u,t[2]=_*a+p*h,t[3]=_*o+p*m,t}function wg(t){var e=nt(),r=nt(),n=nt(),s=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function Rg(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i,o=a?1/a:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-s*o,t[3]=i*o,t}function _g(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function mc(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*n,n=.5/n,t[3]=(e[i*3+a]-e[a*3+i])*n,t[i]=(e[i*3+s]+e[s*3+i])*n,t[a]=(e[a*3+s]+e[s*3+a])*n}return t}function Ig(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var i=Math.sin(e),a=Math.cos(e),o=Math.sin(r),c=Math.cos(r),u=Math.sin(n),h=Math.cos(n);return t[0]=i*c*h-a*o*u,t[1]=a*o*h+i*c*u,t[2]=a*c*u-i*o*h,t[3]=a*c*h+i*o*u,t}function Ag(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var bg=Wo,Sg=Xo,ks=Yo,Cg=Ko,Ng=Jo,Og=fc,vc=tc,zs=ic,$g=ac,Gs=Vs,Fg=Gs,qs=js,Dg=qs,Hs=sc,Pg=oc,Ug=cc,Lg=function(){var t=Ls(),e=ds(1,0,0),r=ds(0,1,0);return function(n,s,i){var a=Bs(s,i);return a<-.999999?(an(t,e,s),qo(t)<1e-6&&an(t,r,s),Go(t,t),lc(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(an(t,s,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,Hs(n,n))}}(),Bg=function(){var t=mn(),e=mn();return function(r,n,s,i,a,o){return on(t,n,a,o),on(e,s,i,o),on(r,t,e,2*o*(1-o)),r}}(),Vg=function(){var t=_o();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Hs(e,mc(e,t))}}(),jg=Object.freeze({__proto__:null,add:Ng,calculateW:Mg,clone:bg,conjugate:_g,copy:ks,create:mn,dot:zs,equals:Ug,exactEquals:Pg,exp:dc,fromEuler:Ig,fromMat3:mc,fromValues:Sg,getAngle:Tg,getAxisAngle:xg,identity:yg,invert:Rg,len:Fg,length:Gs,lerp:$g,ln:gc,mul:Og,multiply:fc,normalize:Hs,pow:Eg,random:wg,rotateX:uc,rotateY:hc,rotateZ:pc,rotationTo:Lg,scale:vc,set:Cg,setAxes:Vg,setAxisAngle:lc,slerp:on,sqlerp:Bg,sqrLen:Dg,squaredLength:qs,str:Ag});function kg(){var t=new ee(8);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function zg(t){var e=new ee(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Gg(t,e,r,n,s,i,a,o){var c=new ee(8);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=i,c[6]=a,c[7]=o,c}function qg(t,e,r,n,s,i,a){var o=new ee(8);o[0]=t,o[1]=e,o[2]=r,o[3]=n;var c=s*.5,u=i*.5,h=a*.5;return o[4]=c*n+u*r-h*e,o[5]=u*n+h*t-c*r,o[6]=h*n+c*e-u*t,o[7]=-c*t-u*e-h*r,o}function yc(t,e,r){var n=r[0]*.5,s=r[1]*.5,i=r[2]*.5,a=e[0],o=e[1],c=e[2],u=e[3];return t[0]=a,t[1]=o,t[2]=c,t[3]=u,t[4]=n*u+s*c-i*o,t[5]=s*u+i*a-n*c,t[6]=i*u+n*o-s*a,t[7]=-n*a-s*o-i*c,t}function Hg(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function Wg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Xg(t,e){var r=mn();$o(r,e);var n=new ee(3);return No(n,e),yc(t,r,n),t}function xc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Yg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Kg(t,e,r,n,s,i,a,o,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t}var Jg=ks;function Zg(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Qg=ks;function e0(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function t0(t,e){var r=e[4],n=e[5],s=e[6],i=e[7],a=-e[0],o=-e[1],c=-e[2],u=e[3];return t[0]=(r*u+i*a+n*c-s*o)*2,t[1]=(n*u+i*o+s*a-r*c)*2,t[2]=(s*u+i*c+r*o-n*a)*2,t}function r0(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0]*.5,c=r[1]*.5,u=r[2]*.5,h=e[4],m=e[5],y=e[6],x=e[7];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=a*o+s*u-i*c+h,t[5]=a*c+i*o-n*u+m,t[6]=a*u+n*c-s*o+y,t[7]=-n*o-s*c-i*u+x,t}function n0(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=o*a+h*n+c*i-u*s,y=c*a+h*s+u*n-o*i,x=u*a+h*i+o*s-c*n,E=h*a-o*n-c*s-u*i;return uc(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=m*a+E*n+y*i-x*s,t[5]=y*a+E*s+x*n-m*i,t[6]=x*a+E*i+m*s-y*n,t[7]=E*a-m*n-y*s-x*i,t}function s0(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=o*a+h*n+c*i-u*s,y=c*a+h*s+u*n-o*i,x=u*a+h*i+o*s-c*n,E=h*a-o*n-c*s-u*i;return hc(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=m*a+E*n+y*i-x*s,t[5]=y*a+E*s+x*n-m*i,t[6]=x*a+E*i+m*s-y*n,t[7]=E*a-m*n-y*s-x*i,t}function i0(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],m=o*a+h*n+c*i-u*s,y=c*a+h*s+u*n-o*i,x=u*a+h*i+o*s-c*n,E=h*a-o*n-c*s-u*i;return pc(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=m*a+E*n+y*i-x*s,t[5]=y*a+E*s+x*n-m*i,t[6]=x*a+E*i+m*s-y*n,t[7]=E*a-m*n-y*s-x*i,t}function a0(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],u=e[2],h=e[3];return t[0]=o*a+h*n+c*i-u*s,t[1]=c*a+h*s+u*n-o*i,t[2]=u*a+h*i+o*s-c*n,t[3]=h*a-o*n-c*s-u*i,o=e[4],c=e[5],u=e[6],h=e[7],t[4]=o*a+h*n+c*i-u*s,t[5]=c*a+h*s+u*n-o*i,t[6]=u*a+h*i+o*s-c*n,t[7]=h*a-o*n-c*s-u*i,t}function o0(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],u=r[2],h=r[3];return t[0]=n*h+a*o+s*u-i*c,t[1]=s*h+a*c+i*o-n*u,t[2]=i*h+a*u+n*c-s*o,t[3]=a*h-n*o-s*c-i*u,o=r[4],c=r[5],u=r[6],h=r[7],t[4]=n*h+a*o+s*u-i*c,t[5]=s*h+a*c+i*o-n*u,t[6]=i*h+a*u+n*c-s*o,t[7]=a*h-n*o-s*c-i*u,t}function c0(t,e,r,n){if(Math.abs(n)<W)return xc(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var i=Math.sin(n),a=i*r[0]/s,o=i*r[1]/s,c=i*r[2]/s,u=Math.cos(n),h=e[0],m=e[1],y=e[2],x=e[3];t[0]=h*u+x*a+m*c-y*o,t[1]=m*u+x*o+y*a-h*c,t[2]=y*u+x*c+h*o-m*a,t[3]=x*u-h*a-m*o-y*c;var E=e[4],_=e[5],p=e[6],R=e[7];return t[4]=E*u+R*a+_*c-p*o,t[5]=_*u+R*o+p*a-E*c,t[6]=p*u+R*c+E*o-_*a,t[7]=R*u-E*a-_*o-p*c,t}function l0(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Tc(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[4],c=r[5],u=r[6],h=r[7],m=e[4],y=e[5],x=e[6],E=e[7],_=r[0],p=r[1],R=r[2],g=r[3];return t[0]=n*g+a*_+s*R-i*p,t[1]=s*g+a*p+i*_-n*R,t[2]=i*g+a*R+n*p-s*_,t[3]=a*g-n*_-s*p-i*R,t[4]=n*h+a*o+s*u-i*c+m*g+E*_+y*R-x*p,t[5]=s*h+a*c+i*o-n*u+y*g+E*p+x*_-m*R,t[6]=i*h+a*u+n*c-s*o+x*g+E*R+m*p-y*_,t[7]=a*h-n*o-s*c-i*u+E*g-m*_-y*p-x*R,t}var f0=Tc;function u0(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var Mc=zs;function h0(t,e,r,n){var s=1-n;return Mc(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function p0(t,e){var r=Rn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function d0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Ec=Gs,g0=Ec,Rn=qs,m0=Rn;function v0(t,e){var r=Rn(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,i=e[2]/r,a=e[3]/r,o=e[4],c=e[5],u=e[6],h=e[7],m=n*o+s*c+i*u+a*h;t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=(o-n*m)/r,t[5]=(c-s*m)/r,t[6]=(u-i*m)/r,t[7]=(h-a*m)/r}return t}function y0(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function x0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function T0(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],h=e[0],m=e[1],y=e[2],x=e[3],E=e[4],_=e[5],p=e[6],R=e[7];return Math.abs(r-h)<=W*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-m)<=W*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-y)<=W*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(i-x)<=W*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-E)<=W*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-_)<=W*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-p)<=W*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(u-R)<=W*Math.max(1,Math.abs(u),Math.abs(R))}var M0=Object.freeze({__proto__:null,add:l0,clone:zg,conjugate:d0,copy:xc,create:kg,dot:Mc,equals:T0,exactEquals:x0,fromMat4:Xg,fromRotation:Wg,fromRotationTranslation:yc,fromRotationTranslationValues:qg,fromTranslation:Hg,fromValues:Gg,getDual:Zg,getReal:Jg,getTranslation:t0,identity:Yg,invert:p0,len:g0,length:Ec,lerp:h0,mul:f0,multiply:Tc,normalize:v0,rotateAroundAxis:c0,rotateByQuatAppend:a0,rotateByQuatPrepend:o0,rotateX:n0,rotateY:s0,rotateZ:i0,scale:u0,set:Kg,setDual:e0,setReal:Qg,sqrLen:m0,squaredLength:Rn,str:y0,translate:r0});function wc(){var t=new ee(2);return ee!=Float32Array&&(t[0]=0,t[1]=0),t}function E0(t){var e=new ee(2);return e[0]=t[0],e[1]=t[1],e}function w0(t,e){var r=new ee(2);return r[0]=t,r[1]=e,r}function R0(t,e){return t[0]=e[0],t[1]=e[1],t}function _0(t,e,r){return t[0]=e,t[1]=r,t}function I0(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Rc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _c(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Ic(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function A0(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function b0(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function S0(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function C0(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function N0(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function O0(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function $0(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Ac(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function bc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Sc(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function Cc(t){var e=t[0],r=t[1];return e*e+r*r}function F0(t,e){return t[0]=-e[0],t[1]=-e[1],t}function D0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function P0(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function U0(t,e){return t[0]*e[0]+t[1]*e[1]}function L0(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function B0(t,e,r,n){var s=e[0],i=e[1];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t}function V0(t,e){e=e||1;var r=nt()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function j0(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function k0(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function z0(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function G0(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function q0(t,e,r,n){var s=e[0]-r[0],i=e[1]-r[1],a=Math.sin(n),o=Math.cos(n);return t[0]=s*o-i*a+r[0],t[1]=s*a+i*o+r[1],t}function H0(t,e){var r=t[0],n=t[1],s=e[0],i=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+i*i),o=a&&(r*s+n*i)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function W0(t){return t[0]=0,t[1]=0,t}function X0(t){return"vec2("+t[0]+", "+t[1]+")"}function Y0(t,e){return t[0]===e[0]&&t[1]===e[1]}function K0(t,e){var r=t[0],n=t[1],s=e[0],i=e[1];return Math.abs(r-s)<=W*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=W*Math.max(1,Math.abs(n),Math.abs(i))}var J0=Sc,Z0=Rc,Q0=_c,em=Ic,tm=Ac,rm=bc,nm=Cc,sm=function(){var t=wc();return function(e,r,n,s,i,a){var o,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],i(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}}(),im=Object.freeze({__proto__:null,add:I0,angle:H0,ceil:A0,clone:E0,copy:R0,create:wc,cross:L0,dist:tm,distance:Ac,div:em,divide:Ic,dot:U0,equals:K0,exactEquals:Y0,floor:b0,forEach:sm,fromValues:w0,inverse:D0,len:J0,length:Sc,lerp:B0,max:C0,min:S0,mul:Q0,multiply:_c,negate:F0,normalize:P0,random:V0,rotate:q0,round:N0,scale:O0,scaleAndAdd:$0,set:_0,sqrDist:rm,sqrLen:nm,squaredDistance:bc,squaredLength:Cc,str:X0,sub:Z0,subtract:Rc,transformMat2:j0,transformMat2d:k0,transformMat3:z0,transformMat4:G0,zero:W0}),Nc=Object.freeze({__proto__:null,glMatrix:Zh,mat2:wp,mat2d:Wp,mat3:w1,mat4:hd,quat:jg,quat2:M0,vec2:im,vec3:Xd,vec4:vg}),am=(()=>{var t=import.meta.url;return async function(e={}){var r,n=e,s,i,a=new Promise((l,f)=>{s=l,i=f}),o=typeof window=="object",c=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(u){const{createRequire:l}=await import("./__vite-browser-external-4ed993c7.js");var h=l(import.meta.url)}var m=!1;n.setup=function(){if(m)return;m=!0;function l(A,O,P=k=>k){if(O)for(let k of O)A.push_back(P(k));return A}function f(A,O=P=>P){const P=[],k=A.size();for(let J=0;J<k;J++)P.push(O(A.get(J)));return P}function d(A,O=P=>P){const P=[],k=A.size();for(let J=0;J<k;J++){const Ee=A.get(J),_e=Ee.size(),Ye=[];for(let Fe=0;Fe<_e;Fe++)Ye.push(O(Ee.get(Fe)));P.push(Ye)}return P}function v(A){return A[0].length<3&&(A=[A]),l(new n.Vector2_vec2,A,O=>l(new n.Vector_vec2,O,P=>P instanceof Array?{x:P[0],y:P[1]}:P))}function w(A){for(let O=0;O<A.size();O++)A.get(O).delete();A.delete()}function b(A){return A[0]instanceof Array?{x:A[0][0],y:A[0][1]}:typeof A[0]=="number"?{x:A[0]||0,y:A[1]||0}:A[0]}function N(A){return A[0]instanceof Array?{x:A[0][0],y:A[0][1],z:A[0][2]}:typeof A[0]=="number"?{x:A[0]||0,y:A[1]||0,z:A[2]||0}:A[0]}function C(A){return A=="EvenOdd"?0:A=="NonZero"?1:A=="Negative"?3:2}function D(A){return A=="Round"?1:A=="Miter"?2:0}const B=n.CrossSection;function G(A,O="Positive"){if(A instanceof B)return A;{const P=v(A),k=new B(P,C(O));return w(P),k}}n.CrossSection.prototype.translate=function(...A){return this._Translate(b(A))},n.CrossSection.prototype.scale=function(A){return typeof A=="number"?this._Scale({x:A,y:A}):this._Scale(b([A]))},n.CrossSection.prototype.mirror=function(A){return this._Mirror(b([A]))},n.CrossSection.prototype.warp=function(A){const O=yr(function(k){const J=tt(k,"double"),Ee=tt(k+8,"double"),_e=[J,Ee];A(_e),Kt(k,_e[0],"double"),Kt(k+8,_e[1],"double")},"vi"),P=this._Warp(O);return xr(O),P},n.CrossSection.prototype.decompose=function(){const A=this._Decompose(),O=f(A);return A.delete(),O},n.CrossSection.prototype.bounds=function(){const A=this._Bounds();return{min:["x","y"].map(O=>A.min[O]),max:["x","y"].map(O=>A.max[O])}},n.CrossSection.prototype.offset=function(A,O="Square",P=2,k=0){return this._Offset(A,D(O),P,k)},n.CrossSection.prototype.extrude=function(A,O=0,P=0,k=[1,1],J=!1){k=b([k]);const Ee=n._Extrude(this._ToPolygons(),A,O,P,k);return J?Ee.translate([0,0,-A/2]):Ee},n.CrossSection.prototype.revolve=function(A=0,O=360){return n._Revolve(this._ToPolygons(),A,O)},n.CrossSection.prototype.add=function(A){return this._add(G(A))},n.CrossSection.prototype.subtract=function(A){return this._subtract(G(A))},n.CrossSection.prototype.intersect=function(A){return this._intersect(G(A))},n.CrossSection.prototype.toPolygons=function(){const A=this._ToPolygons(),O=d(A);return A.delete(),O},n.Manifold.prototype.smoothOut=function(A=60,O=0){return this._SmoothOut(A,O)},n.Manifold.prototype.warp=function(A){const O=yr(function(J){const Ee=tt(J,"double"),_e=tt(J+8,"double"),Ye=tt(J+16,"double"),Fe=[Ee,_e,Ye];A(Fe),Kt(J,Fe[0],"double"),Kt(J+8,Fe[1],"double"),Kt(J+16,Fe[2],"double")},"vi"),P=this._Warp(O);xr(O);const k=P.status();if(k.value!==0)throw new n.ManifoldError(k.value);return P},n.Manifold.prototype.calculateNormals=function(A,O=60){return this._CalculateNormals(A,O)},n.Manifold.prototype.setProperties=function(A,O){const P=this.numProp(),k=yr(function(Ee,_e,Ye){const Fe=[];for(let Ie=0;Ie<A;++Ie)Fe[Ie]=tt(Ee+8*Ie,"double");const er=[];for(let Ie=0;Ie<3;++Ie)er[Ie]=tt(_e+8*Ie,"double");const tr=[];for(let Ie=0;Ie<P;++Ie)tr[Ie]=tt(Ye+8*Ie,"double");O(Fe,er,tr);for(let Ie=0;Ie<A;++Ie)Kt(Ee+8*Ie,Fe[Ie],"double")},"viii"),J=this._SetProperties(A,k);return xr(k),J},n.Manifold.prototype.translate=function(...A){return this._Translate(N(A))},n.Manifold.prototype.rotate=function(A,O,P){return Array.isArray(A)?this._Rotate(...A):this._Rotate(A,O||0,P||0)},n.Manifold.prototype.scale=function(A){return typeof A=="number"?this._Scale({x:A,y:A,z:A}):this._Scale(N([A]))},n.Manifold.prototype.mirror=function(A){return this._Mirror(N([A]))},n.Manifold.prototype.trimByPlane=function(A,O=0){return this._TrimByPlane(N([A]),O)},n.Manifold.prototype.slice=function(A=0){return n.CrossSection(this._Slice(A))},n.Manifold.prototype.project=function(){return n.CrossSection(this._Project()).simplify(this.precision())},n.Manifold.prototype.split=function(A){const O=this._Split(A),P=f(O);return O.delete(),P},n.Manifold.prototype.splitByPlane=function(A,O=0){const P=this._SplitByPlane(N([A]),O),k=f(P);return P.delete(),k},n.Manifold.prototype.decompose=function(){const A=this._Decompose(),O=f(A);return A.delete(),O},n.Manifold.prototype.boundingBox=function(){const A=this._boundingBox();return{min:["x","y","z"].map(O=>A.min[O]),max:["x","y","z"].map(O=>A.max[O])}};class K{constructor({numProp:O=3,triVerts:P=new Uint32Array,vertProperties:k=new Float32Array,mergeFromVert:J,mergeToVert:Ee,runIndex:_e,runOriginalID:Ye,faceID:Fe,halfedgeTangent:er,runTransform:tr}={}){this.numProp=O,this.triVerts=P,this.vertProperties=k,this.mergeFromVert=J,this.mergeToVert=Ee,this.runIndex=_e,this.runOriginalID=Ye,this.faceID=Fe,this.halfedgeTangent=er,this.runTransform=tr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:O,mesh:P}=n._Merge(this);return Object.assign(this,{...P}),O}verts(O){return this.triVerts.subarray(3*O,3*(O+1))}position(O){return this.vertProperties.subarray(numProp*O,numProp*O+3)}extras(O){return this.vertProperties.subarray(numProp*O+3,numProp*(O+1))}tangent(O){return this.halfedgeTangent.subarray(4*O,4*(O+1))}transform(O){const P=new Array(16);for(const k of[0,1,2,3])for(const J of[0,1,2])P[4*k+J]=this.runTransform[12*O+3*k+J];return P[15]=1,P}}n.Mesh=K,n.Manifold.prototype.getMesh=function(A=[0,0,0]){return A instanceof Array&&(A={0:A[0],1:A[1],2:A[2]}),new K(this._GetMeshJS(A))},n.ManifoldError=function(O,...P){let k="Unknown error";switch(O){case n.status.NonFiniteVertex.value:k="Non-finite vertex";break;case n.status.NotManifold.value:k="Not manifold";break;case n.status.VertexOutOfBounds.value:k="Vertex index out of bounds";break;case n.status.PropertiesWrongLength.value:k="Properties have wrong length";break;case n.status.MissingPositionProperties.value:k="Less than three properties";break;case n.status.MergeVectorsDifferentLengths.value:k="Merge vectors have different lengths";break;case n.status.MergeIndexOutOfBounds.value:k="Merge index out of bounds";break;case n.status.TransformWrongLength.value:k="Transform vector has wrong length";break;case n.status.RunIndexWrongLength.value:k="Run index vector has wrong length";break;case n.status.FaceIDWrongLength.value:k="Face ID vector has wrong length";case n.status.InvalidConstruction.value:k="Manifold constructed with invalid parameters"}const J=Error.apply(this,[k,...P]);J.name=this.name="ManifoldError",this.message=J.message,this.stack=J.stack,this.code=O},n.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:n.ManifoldError,writable:!0,configurable:!0}}),n.CrossSection=function(A,O="Positive"){const P=v(A),k=new B(P,C(O));return w(P),k},n.CrossSection.ofPolygons=function(A,O="Positive"){return new n.CrossSection(A,O)},n.CrossSection.square=function(...A){let O;A.length==0?O={x:1,y:1}:typeof A[0]=="number"?O={x:A[0],y:A[0]}:O=b(A);const P=A[1]||!1;return n._Square(O,P)},n.CrossSection.circle=function(A,O=0){return n._Circle(A,O)};function re(A){return function(...O){O.length==1&&(O=O[0]);const P=new n.Vector_crossSection;for(const J of O)P.push_back(G(J));const k=n["_crossSection"+A](P);return P.delete(),k}}n.CrossSection.compose=re("Compose"),n.CrossSection.union=re("UnionN"),n.CrossSection.difference=re("DifferenceN"),n.CrossSection.intersection=re("IntersectionN");function ye(A,O){l(A,O,P=>P instanceof Array?{x:P[0],y:P[1]}:P)}n.CrossSection.hull=function(...A){A.length==1&&(A=A[0]);let O=new n.Vector_vec2;for(const k of A)if(k instanceof B)n._crossSectionCollectVertices(O,k);else if(k instanceof Array&&k.length==2&&typeof k[0]=="number")O.push_back({x:k[0],y:k[1]});else if(k.x)O.push_back(k);else{const Ee=k[0].length==2&&typeof k[0][0]=="number"||k[0].x?[k]:k;for(const _e of Ee)ye(O,_e)}const P=n._crossSectionHullPoints(O);return O.delete(),P},n.CrossSection.prototype=Object.create(B.prototype),Object.defineProperty(n.CrossSection,Symbol.hasInstance,{get:()=>A=>A instanceof B});const pe=n.Manifold;n.Manifold=function(A){const O=new pe(A),P=O.status();if(P.value!==0)throw new n.ManifoldError(P.value);return O},n.Manifold.ofMesh=function(A){return new n.Manifold(A)},n.Manifold.tetrahedron=function(){return n._Tetrahedron()},n.Manifold.cube=function(...A){let O;A.length==0?O={x:1,y:1,z:1}:typeof A[0]=="number"?O={x:A[0],y:A[0],z:A[0]}:O=N(A);const P=A[1]||!1;return n._Cube(O,P)},n.Manifold.cylinder=function(A,O,P=-1,k=0,J=!1){return n._Cylinder(A,O,P,k,J)},n.Manifold.sphere=function(A,O=0){return n._Sphere(A,O)},n.Manifold.smooth=function(A,O=[]){const P=new n.Vector_smoothness;l(P,O);const k=n._Smooth(A,P);return P.delete(),k},n.Manifold.extrude=function(A,O,P=0,k=0,J=[1,1],Ee=!1){return(A instanceof B?A:n.CrossSection(A,"Positive")).extrude(O,P,k,J,Ee)},n.Manifold.revolve=function(A,O=0,P=360){return(A instanceof B?A:n.CrossSection(A,"Positive")).revolve(O,P)},n.Manifold.reserveIDs=function(A){return n._ReserveIDs(A)},n.Manifold.compose=function(A){const O=new n.Vector_manifold;l(O,A);const P=n._manifoldCompose(O);return O.delete(),P};function Ue(A){return function(...O){O.length==1&&(O=O[0]);const P=new n.Vector_manifold;for(const J of O)P.push_back(J);const k=n["_manifold"+A+"N"](P);return P.delete(),k}}n.Manifold.union=Ue("Union"),n.Manifold.difference=Ue("Difference"),n.Manifold.intersection=Ue("Intersection"),n.Manifold.levelSet=function(A,O,P,k=0,J=-1){const Ee={min:{x:O.min[0],y:O.min[1],z:O.min[2]},max:{x:O.max[0],y:O.max[1],z:O.max[2]}},_e=yr(function(Fe){const er=tt(Fe,"double"),tr=tt(Fe+8,"double"),Ie=tt(Fe+16,"double");return A([er,tr,Ie])},"di"),Ye=n._LevelSet(_e,Ee,P,k,J);return xr(_e),Ye};function Xe(A,O){l(A,O,P=>P instanceof Array?{x:P[0],y:P[1],z:P[2]}:P)}n.Manifold.hull=function(...A){A.length==1&&(A=A[0]);let O=new n.Vector_vec3;for(const k of A)k instanceof pe?n._manifoldCollectVertices(O,k):k instanceof Array&&k.length==3&&typeof k[0]=="number"?O.push_back({x:k[0],y:k[1],z:k[2]}):k.x?O.push_back(k):Xe(O,k);const P=n._manifoldHullPoints(O);return O.delete(),P},n.Manifold.prototype=Object.create(pe.prototype),Object.defineProperty(n.Manifold,Symbol.hasInstance,{get:()=>A=>A instanceof pe}),n.triangulate=function(A,O=-1){const P=v(A),k=f(n._Triangulate(P,O),J=>[J[0],J[1],J[2]]);return w(P),k}};var y=Object.assign({},n),x="";function E(l){return n.locateFile?n.locateFile(l,x):x+l}var _,p,R;if(u){var g=h("fs"),T=h("path");x=h("url").fileURLToPath(new URL("./",self.location)),_=(l,f)=>(l=at(l)?new URL(l):T.normalize(l),g.readFileSync(l,f?void 0:"utf8")),R=l=>{var f=_(l,!0);return f.buffer||(f=new Uint8Array(f)),f},p=(l,f,d,v=!0)=>{l=at(l)?new URL(l):T.normalize(l),g.readFile(l,v?void 0:"utf8",(w,b)=>{w?d(w):f(v?b.buffer:b)})},!n.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2)}else(o||c)&&(c?x=self.location.href:typeof document<"u"&&document.currentScript&&(x=document.currentScript.src),t&&(x=t),x.startsWith("blob:")?x="":x=x.substr(0,x.replace(/[?#].*/,"").lastIndexOf("/")+1),_=l=>{var f=new XMLHttpRequest;return f.open("GET",l,!1),f.send(null),f.responseText},c&&(R=l=>{var f=new XMLHttpRequest;return f.open("GET",l,!1),f.responseType="arraybuffer",f.send(null),new Uint8Array(f.response)}),p=(l,f,d)=>{if(at(l)){var v=new XMLHttpRequest;v.open("GET",l,!0),v.responseType="arraybuffer",v.onload=()=>{if(v.status==200||v.status==0&&v.response){f(v.response);return}d()},v.onerror=d,v.send(null);return}fetch(l,{credentials:"same-origin"}).then(w=>w.ok?w.arrayBuffer():Promise.reject(new Error(w.status+" : "+w.url))).then(f,d)});n.print||console.log.bind(console);var M=n.printErr||console.error.bind(console);Object.assign(n,y),y=null,n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.quit&&n.quit;var I;n.wasmBinary&&(I=n.wasmBinary);var S,L=!1,F,$,z,j,H,V,U,X;function se(){var l=S.buffer;n.HEAP8=F=new Int8Array(l),n.HEAP16=z=new Int16Array(l),n.HEAPU8=$=new Uint8Array(l),n.HEAPU16=j=new Uint16Array(l),n.HEAP32=H=new Int32Array(l),n.HEAPU32=V=new Uint32Array(l),n.HEAPF32=U=new Float32Array(l),n.HEAPF64=X=new Float64Array(l)}var Z=[],le=[],oe=[];function fe(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Ce(n.preRun.shift());An(Z)}function ue(){An(le)}function de(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Me(n.postRun.shift());An(oe)}function Ce(l){Z.unshift(l)}function me(l){le.unshift(l)}function Me(l){oe.unshift(l)}var Ne=0,Ve=null;function xt(l){Ne++,n.monitorRunDependencies?.(Ne)}function ve(l){if(Ne--,n.monitorRunDependencies?.(Ne),Ne==0&&Ve){var f=Ve;Ve=null,f()}}function We(l){n.onAbort?.(l),l="Aborted("+l+")",M(l),L=!0,l+=". Build with -sASSERTIONS for more info.";var f=new WebAssembly.RuntimeError(l);throw i(f),f}var qe="data:application/octet-stream;base64,",Mt=l=>l.startsWith(qe),at=l=>l.startsWith("file://");function Et(){if(n.locateFile){var l="manifold.wasm";return Mt(l)?l:E(l)}return new URL("/assets/manifold-9191fd82.wasm",self.location).href}var Yt;function jr(l){if(l==Yt&&I)return new Uint8Array(I);if(R)return R(l);throw"both async and sync fetching of the wasm failed"}function In(l){return I?Promise.resolve().then(()=>jr(l)):new Promise((f,d)=>{p(l,v=>f(new Uint8Array(v)),v=>{try{f(jr(l))}catch(w){d(w)}})})}function Ks(l,f,d){return In(l).then(v=>WebAssembly.instantiate(v,f)).then(d,v=>{M(`failed to asynchronously prepare wasm: ${v}`),We(v)})}function kc(l,f,d,v){return!l&&typeof WebAssembly.instantiateStreaming=="function"&&!Mt(f)&&!at(f)&&!u&&typeof fetch=="function"?fetch(f,{credentials:"same-origin"}).then(w=>{var b=WebAssembly.instantiateStreaming(w,d);return b.then(v,function(N){return M(`wasm streaming compile failed: ${N}`),M("falling back to ArrayBuffer instantiation"),Ks(f,d,v)})}):Ks(f,d,v)}function zc(){return{a:Cf}}function Gc(){var l=zc();function f(v,w){return Pe=v.exports,S=Pe.xa,se(),It=Pe.Aa,me(Pe.ya),ve(),Pe}xt();function d(v){f(v.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(l,f)}catch(v){M(`Module.instantiateWasm callback failed with error: ${v}`),i(v)}return Yt||(Yt=Et()),kc(I,Yt,l,d).catch(i),{}}var An=l=>{for(;l.length>0;)l.shift()(n)};function tt(l,f="i8"){switch(f.endsWith("*")&&(f="*"),f){case"i1":return F[l];case"i8":return F[l];case"i16":return z[l>>1];case"i32":return H[l>>2];case"i64":We("to do getValue(i64) use WASM_BIGINT");case"float":return U[l>>2];case"double":return X[l>>3];case"*":return V[l>>2];default:We(`invalid type for getValue: ${f}`)}}n.noExitRuntime;function Kt(l,f,d="i8"){switch(d.endsWith("*")&&(d="*"),d){case"i1":F[l]=f;break;case"i8":F[l]=f;break;case"i16":z[l>>1]=f;break;case"i32":H[l>>2]=f;break;case"i64":We("to do setValue(i64) use WASM_BIGINT");case"float":U[l>>2]=f;break;case"double":X[l>>3]=f;break;case"*":V[l>>2]=f;break;default:We(`invalid type for setValue: ${d}`)}}var ie=l=>Ti(l),ae=()=>Mi(),Js=[],qc=l=>{var f=new bn(l);return f.get_caught()||f.set_caught(!0),f.set_rethrown(!1),Js.push(f),wi(f.excPtr),f.get_exception_ptr()},wt=0,Hc=()=>{ne(0,0);var l=Js.pop();Ei(l.excPtr),wt=0};class bn{constructor(f){this.excPtr=f,this.ptr=f-24}set_type(f){V[this.ptr+4>>2]=f}get_type(){return V[this.ptr+4>>2]}set_destructor(f){V[this.ptr+8>>2]=f}get_destructor(){return V[this.ptr+8>>2]}set_caught(f){f=f?1:0,F[this.ptr+12]=f}get_caught(){return F[this.ptr+12]!=0}set_rethrown(f){f=f?1:0,F[this.ptr+13]=f}get_rethrown(){return F[this.ptr+13]!=0}init(f,d){this.set_adjusted_ptr(0),this.set_type(f),this.set_destructor(d)}set_adjusted_ptr(f){V[this.ptr+16>>2]=f}get_adjusted_ptr(){return V[this.ptr+16>>2]}get_exception_ptr(){var f=_i(this.get_type());if(f)return V[this.excPtr>>2];var d=this.get_adjusted_ptr();return d!==0?d:this.excPtr}}var Wc=l=>{throw wt||(wt=l),wt},kr=l=>xi(l),Zs=l=>{var f=wt;if(!f)return kr(0),0;var d=new bn(f);d.set_adjusted_ptr(f);var v=d.get_type();if(!v)return kr(0),f;for(var w of l){if(w===0||w===v)break;var b=d.ptr+16;if(Ri(w,v,b))return kr(w),f}return kr(v),f},Xc=()=>Zs([]),Yc=l=>Zs([l]),Kc=(l,f,d)=>{var v=new bn(l);throw v.init(f,d),wt=l,wt},Jc=()=>{We("")},zr={},Sn=l=>{for(;l.length;){var f=l.pop(),d=l.pop();d(f)}};function hr(l){return this.fromWireType(V[l>>2])}var Jt={},Rt={},Gr={},Qs,qr=l=>{throw new Qs(l)},_t=(l,f,d)=>{l.forEach(function(C){Gr[C]=f});function v(C){var D=d(C);D.length!==l.length&&qr("Mismatched type converter count");for(var B=0;B<l.length;++B)ot(l[B],D[B])}var w=new Array(f.length),b=[],N=0;f.forEach((C,D)=>{Rt.hasOwnProperty(C)?w[D]=Rt[C]:(b.push(C),Jt.hasOwnProperty(C)||(Jt[C]=[]),Jt[C].push(()=>{w[D]=Rt[C],++N,N===b.length&&v(w)}))}),b.length===0&&v(w)},Zc=l=>{var f=zr[l];delete zr[l];var d=f.rawConstructor,v=f.rawDestructor,w=f.fields,b=w.map(N=>N.getterReturnType).concat(w.map(N=>N.setterArgumentType));_t([l],b,N=>{var C={};return w.forEach((D,B)=>{var G=D.fieldName,K=N[B],re=D.getter,ye=D.getterContext,pe=N[B+w.length],Ue=D.setter,Xe=D.setterContext;C[G]={read:A=>K.fromWireType(re(ye,A)),write:(A,O)=>{var P=[];Ue(Xe,A,pe.toWireType(P,O)),Sn(P)}}}),[{name:f.name,fromWireType:D=>{var B={};for(var G in C)B[G]=C[G].read(D);return v(D),B},toWireType:(D,B)=>{for(var G in C)if(!(G in B))throw new TypeError(`Missing field: "${G}"`);var K=d();for(G in C)C[G].write(K,B[G]);return D!==null&&D.push(v,K),K},argPackAdvance:ct,readValueFromPointer:hr,destructorFunction:v}]})},Qc=(l,f,d,v,w)=>{},el=()=>{for(var l=new Array(256),f=0;f<256;++f)l[f]=String.fromCharCode(f);ei=l},ei,De=l=>{for(var f="",d=l;$[d];)f+=ei[$[d++]];return f},Zt,ce=l=>{throw new Zt(l)};function tl(l,f,d={}){var v=f.name;if(l||ce(`type "${v}" must have a positive integer typeid pointer`),Rt.hasOwnProperty(l)){if(d.ignoreDuplicateRegistrations)return;ce(`Cannot register type '${v}' twice`)}if(Rt[l]=f,delete Gr[l],Jt.hasOwnProperty(l)){var w=Jt[l];delete Jt[l],w.forEach(b=>b())}}function ot(l,f,d={}){if(!("argPackAdvance"in f))throw new TypeError("registerType registeredInstance requires argPackAdvance");return tl(l,f,d)}var ct=8,rl=(l,f,d,v)=>{f=De(f),ot(l,{name:f,fromWireType:function(w){return!!w},toWireType:function(w,b){return b?d:v},argPackAdvance:ct,readValueFromPointer:function(w){return this.fromWireType($[w])},destructorFunction:null})},nl=l=>({count:l.count,deleteScheduled:l.deleteScheduled,preservePointerOnDelete:l.preservePointerOnDelete,ptr:l.ptr,ptrType:l.ptrType,smartPtr:l.smartPtr,smartPtrType:l.smartPtrType}),Cn=l=>{function f(d){return d.$$.ptrType.registeredClass.name}ce(f(l)+" instance already deleted")},Nn=!1,ti=l=>{},sl=l=>{l.smartPtr?l.smartPtrType.rawDestructor(l.smartPtr):l.ptrType.registeredClass.rawDestructor(l.ptr)},ri=l=>{l.count.value-=1;var f=l.count.value===0;f&&sl(l)},ni=(l,f,d)=>{if(f===d)return l;if(d.baseClass===void 0)return null;var v=ni(l,f,d.baseClass);return v===null?null:d.downcast(v)},si={},il=()=>Object.keys(gr).length,al=()=>{var l=[];for(var f in gr)gr.hasOwnProperty(f)&&l.push(gr[f]);return l},pr=[],On=()=>{for(;pr.length;){var l=pr.pop();l.$$.deleteScheduled=!1,l.delete()}},dr,ol=l=>{dr=l,pr.length&&dr&&dr(On)},cl=()=>{n.getInheritedInstanceCount=il,n.getLiveInheritedInstances=al,n.flushPendingDeletes=On,n.setDelayFunction=ol},gr={},ll=(l,f)=>{for(f===void 0&&ce("ptr should not be undefined");l.baseClass;)f=l.upcast(f),l=l.baseClass;return f},fl=(l,f)=>(f=ll(l,f),gr[f]),Hr=(l,f)=>{(!f.ptrType||!f.ptr)&&qr("makeClassHandle requires ptr and ptrType");var d=!!f.smartPtrType,v=!!f.smartPtr;return d!==v&&qr("Both smartPtrType and smartPtr must be specified"),f.count={value:1},mr(Object.create(l,{$$:{value:f,writable:!0}}))};function ul(l){var f=this.getPointee(l);if(!f)return this.destructor(l),null;var d=fl(this.registeredClass,f);if(d!==void 0){if(d.$$.count.value===0)return d.$$.ptr=f,d.$$.smartPtr=l,d.clone();var v=d.clone();return this.destructor(l),v}function w(){return this.isSmartPointer?Hr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:f,smartPtrType:this,smartPtr:l}):Hr(this.registeredClass.instancePrototype,{ptrType:this,ptr:l})}var b=this.registeredClass.getActualType(f),N=si[b];if(!N)return w.call(this);var C;this.isConst?C=N.constPointerType:C=N.pointerType;var D=ni(f,this.registeredClass,C.registeredClass);return D===null?w.call(this):this.isSmartPointer?Hr(C.registeredClass.instancePrototype,{ptrType:C,ptr:D,smartPtrType:this,smartPtr:l}):Hr(C.registeredClass.instancePrototype,{ptrType:C,ptr:D})}var mr=l=>typeof FinalizationRegistry>"u"?(mr=f=>f,l):(Nn=new FinalizationRegistry(f=>{ri(f.$$)}),mr=f=>{var d=f.$$,v=!!d.smartPtr;if(v){var w={$$:d};Nn.register(f,w,f)}return f},ti=f=>Nn.unregister(f),mr(l)),hl=()=>{Object.assign(Wr.prototype,{isAliasOf(l){if(!(this instanceof Wr)||!(l instanceof Wr))return!1;var f=this.$$.ptrType.registeredClass,d=this.$$.ptr;l.$$=l.$$;for(var v=l.$$.ptrType.registeredClass,w=l.$$.ptr;f.baseClass;)d=f.upcast(d),f=f.baseClass;for(;v.baseClass;)w=v.upcast(w),v=v.baseClass;return f===v&&d===w},clone(){if(this.$$.ptr||Cn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var l=mr(Object.create(Object.getPrototypeOf(this),{$$:{value:nl(this.$$)}}));return l.$$.count.value+=1,l.$$.deleteScheduled=!1,l},delete(){this.$$.ptr||Cn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ce("Object already scheduled for deletion"),ti(this),ri(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Cn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ce("Object already scheduled for deletion"),pr.push(this),pr.length===1&&dr&&dr(On),this.$$.deleteScheduled=!0,this}})};function Wr(){}var Qt=(l,f)=>Object.defineProperty(f,"name",{value:l}),ii=(l,f,d)=>{if(l[f].overloadTable===void 0){var v=l[f];l[f]=function(...w){return l[f].overloadTable.hasOwnProperty(w.length)||ce(`Function '${d}' called with an invalid number of arguments (${w.length}) - expects one of (${l[f].overloadTable})!`),l[f].overloadTable[w.length].apply(this,w)},l[f].overloadTable=[],l[f].overloadTable[v.argCount]=v}},$n=(l,f,d)=>{n.hasOwnProperty(l)?((d===void 0||n[l].overloadTable!==void 0&&n[l].overloadTable[d]!==void 0)&&ce(`Cannot register public name '${l}' twice`),ii(n,l,l),n.hasOwnProperty(d)&&ce(`Cannot register multiple overloads of a function with the same number of arguments (${d})!`),n[l].overloadTable[d]=f):(n[l]=f,d!==void 0&&(n[l].numArguments=d))},pl=48,dl=57,gl=l=>{if(l===void 0)return"_unknown";l=l.replace(/[^a-zA-Z0-9_]/g,"$");var f=l.charCodeAt(0);return f>=pl&&f<=dl?`_${l}`:l};function ml(l,f,d,v,w,b,N,C){this.name=l,this.constructor=f,this.instancePrototype=d,this.rawDestructor=v,this.baseClass=w,this.getActualType=b,this.upcast=N,this.downcast=C,this.pureVirtualFunctions=[]}var Fn=(l,f,d)=>{for(;f!==d;)f.upcast||ce(`Expected null or instance of ${d.name}, got an instance of ${f.name}`),l=f.upcast(l),f=f.baseClass;return l};function vl(l,f){if(f===null)return this.isReference&&ce(`null is not a valid ${this.name}`),0;f.$$||ce(`Cannot pass "${Bn(f)}" as a ${this.name}`),f.$$.ptr||ce(`Cannot pass deleted object as a pointer of type ${this.name}`);var d=f.$$.ptrType.registeredClass,v=Fn(f.$$.ptr,d,this.registeredClass);return v}function yl(l,f){var d;if(f===null)return this.isReference&&ce(`null is not a valid ${this.name}`),this.isSmartPointer?(d=this.rawConstructor(),l!==null&&l.push(this.rawDestructor,d),d):0;(!f||!f.$$)&&ce(`Cannot pass "${Bn(f)}" as a ${this.name}`),f.$$.ptr||ce(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&f.$$.ptrType.isConst&&ce(`Cannot convert argument of type ${f.$$.smartPtrType?f.$$.smartPtrType.name:f.$$.ptrType.name} to parameter type ${this.name}`);var v=f.$$.ptrType.registeredClass;if(d=Fn(f.$$.ptr,v,this.registeredClass),this.isSmartPointer)switch(f.$$.smartPtr===void 0&&ce("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:f.$$.smartPtrType===this?d=f.$$.smartPtr:ce(`Cannot convert argument of type ${f.$$.smartPtrType?f.$$.smartPtrType.name:f.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:d=f.$$.smartPtr;break;case 2:if(f.$$.smartPtrType===this)d=f.$$.smartPtr;else{var w=f.clone();d=this.rawShare(d,$e.toHandle(()=>w.delete())),l!==null&&l.push(this.rawDestructor,d)}break;default:ce("Unsupporting sharing policy")}return d}function xl(l,f){if(f===null)return this.isReference&&ce(`null is not a valid ${this.name}`),0;f.$$||ce(`Cannot pass "${Bn(f)}" as a ${this.name}`),f.$$.ptr||ce(`Cannot pass deleted object as a pointer of type ${this.name}`),f.$$.ptrType.isConst&&ce(`Cannot convert argument of type ${f.$$.ptrType.name} to parameter type ${this.name}`);var d=f.$$.ptrType.registeredClass,v=Fn(f.$$.ptr,d,this.registeredClass);return v}var Tl=()=>{Object.assign(Xr.prototype,{getPointee(l){return this.rawGetPointee&&(l=this.rawGetPointee(l)),l},destructor(l){this.rawDestructor?.(l)},argPackAdvance:ct,readValueFromPointer:hr,fromWireType:ul})};function Xr(l,f,d,v,w,b,N,C,D,B,G){this.name=l,this.registeredClass=f,this.isReference=d,this.isConst=v,this.isSmartPointer=w,this.pointeeType=b,this.sharingPolicy=N,this.rawGetPointee=C,this.rawConstructor=D,this.rawShare=B,this.rawDestructor=G,!w&&f.baseClass===void 0?v?(this.toWireType=vl,this.destructorFunction=null):(this.toWireType=xl,this.destructorFunction=null):this.toWireType=yl}var ai=(l,f,d)=>{n.hasOwnProperty(l)||qr("Replacing nonexistent public symbol"),n[l].overloadTable!==void 0&&d!==void 0?n[l].overloadTable[d]=f:(n[l]=f,n[l].argCount=d)},Ml=(l,f,d)=>{l=l.replace(/p/g,"i");var v=n["dynCall_"+l];return v(f,...d)},vr=[],It,te=l=>{var f=vr[l];return f||(l>=vr.length&&(vr.length=l+1),vr[l]=f=It.get(l)),f},El=(l,f,d=[])=>{if(l.includes("j"))return Ml(l,f,d);var v=te(f)(...d);return v},wl=(l,f)=>(...d)=>El(l,f,d),rt=(l,f)=>{l=De(l);function d(){return l.includes("j")?wl(l,f):te(f)}var v=d();return typeof v!="function"&&ce(`unknown function pointer with signature ${l}: ${f}`),v},Rl=(l,f)=>{var d=Qt(f,function(v){this.name=f,this.message=v;var w=new Error(v).stack;w!==void 0&&(this.stack=this.toString()+`
`+w.replace(/^Error(:[^\n]*)?\n/,""))});return d.prototype=Object.create(l.prototype),d.prototype.constructor=d,d.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},d},oi,ci=l=>{var f=yi(l),d=De(f);return dt(f),d},Yr=(l,f)=>{var d=[],v={};function w(b){if(!v[b]&&!Rt[b]){if(Gr[b]){Gr[b].forEach(w);return}d.push(b),v[b]=!0}}throw f.forEach(w),new oi(`${l}: `+d.map(ci).join([", "]))},_l=(l,f,d,v,w,b,N,C,D,B,G,K,re)=>{G=De(G),b=rt(w,b),C&&=rt(N,C),B&&=rt(D,B),re=rt(K,re);var ye=gl(G);$n(ye,function(){Yr(`Cannot construct ${G} due to unbound types`,[v])}),_t([l,f,d],v?[v]:[],pe=>{pe=pe[0];var Ue,Xe;v?(Ue=pe.registeredClass,Xe=Ue.instancePrototype):Xe=Wr.prototype;var A=Qt(G,function(..._e){if(Object.getPrototypeOf(this)!==O)throw new Zt("Use 'new' to construct "+G);if(P.constructor_body===void 0)throw new Zt(G+" has no accessible constructor");var Ye=P.constructor_body[_e.length];if(Ye===void 0)throw new Zt(`Tried to invoke ctor of ${G} with invalid number of parameters (${_e.length}) - expected (${Object.keys(P.constructor_body).toString()}) parameters instead!`);return Ye.apply(this,_e)}),O=Object.create(Xe,{constructor:{value:A}});A.prototype=O;var P=new ml(G,A,O,re,Ue,b,C,B);P.baseClass&&(P.baseClass.__derivedClasses??=[],P.baseClass.__derivedClasses.push(P));var k=new Xr(G,P,!0,!1,!1),J=new Xr(G+"*",P,!1,!1,!1),Ee=new Xr(G+" const*",P,!1,!0,!1);return si[l]={pointerType:J,constPointerType:Ee},ai(ye,A),[k,J,Ee]})},Dn=(l,f)=>{for(var d=[],v=0;v<l;v++)d.push(V[f+v*4>>2]);return d};function li(l){for(var f=1;f<l.length;++f)if(l[f]!==null&&l[f].destructorFunction===void 0)return!0;return!1}function fi(l,f){if(!(l instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof l} which is not a function`);var d=Qt(l.name||"unknownFunctionName",function(){});d.prototype=l.prototype;var v=new d,w=l.apply(v,f);return w instanceof Object?w:v}function Il(l,f,d,v){for(var w=li(l),b=l.length,N="",C="",D=0;D<b-2;++D)N+=(D!==0?", ":"")+"arg"+D,C+=(D!==0?", ":"")+"arg"+D+"Wired";var B=`
        return function (${N}) {
        if (arguments.length !== ${b-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${b-2}');
        }`;w&&(B+=`var destructors = [];
`);var G=w?"destructors":"null",K=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];f&&(B+="var thisWired = classParam['toWireType']("+G+`, this);
`);for(var D=0;D<b-2;++D)B+="var arg"+D+"Wired = argType"+D+"['toWireType']("+G+", arg"+D+`);
`,K.push("argType"+D);if(f&&(C="thisWired"+(C.length>0?", ":"")+C),B+=(d||v?"var rv = ":"")+"invoker(fn"+(C.length>0?", ":"")+C+`);
`,w)B+=`runDestructors(destructors);
`;else for(var D=f?1:2;D<l.length;++D){var re=D===1?"thisWired":"arg"+(D-2)+"Wired";l[D].destructorFunction!==null&&(B+=`${re}_dtor(${re});
`,K.push(`${re}_dtor`))}return d&&(B+=`var ret = retType['fromWireType'](rv);
return ret;
`),B+=`}
`,[K,B]}function Pn(l,f,d,v,w,b){var N=f.length;N<2&&ce("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var C=f[1]!==null&&d!==null,D=li(f),B=f[0].name!=="void",G=[l,ce,v,w,Sn,f[0],f[1]],K=0;K<N-2;++K)G.push(f[K+2]);if(!D)for(var K=C?1:2;K<f.length;++K)f[K].destructorFunction!==null&&G.push(f[K].destructorFunction);let[re,ye]=Il(f,C,B,b);re.push(ye);var pe=fi(Function,re)(...G);return Qt(l,pe)}var Al=(l,f,d,v,w,b)=>{var N=Dn(f,d);w=rt(v,w),_t([],[l],C=>{C=C[0];var D=`constructor ${C.name}`;if(C.registeredClass.constructor_body===void 0&&(C.registeredClass.constructor_body=[]),C.registeredClass.constructor_body[f-1]!==void 0)throw new Zt(`Cannot register multiple constructors with identical number of parameters (${f-1}) for class '${C.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return C.registeredClass.constructor_body[f-1]=()=>{Yr(`Cannot construct ${C.name} due to unbound types`,N)},_t([],N,B=>(B.splice(1,0,null),C.registeredClass.constructor_body[f-1]=Pn(D,B,null,w,b),[])),[]})},ui=l=>{l=l.trim();const f=l.indexOf("(");return f!==-1?l.substr(0,f):l},bl=(l,f,d,v,w,b,N,C,D)=>{var B=Dn(d,v);f=De(f),f=ui(f),b=rt(w,b),_t([],[l],G=>{G=G[0];var K=`${G.name}.${f}`;f.startsWith("@@")&&(f=Symbol[f.substring(2)]),C&&G.registeredClass.pureVirtualFunctions.push(f);function re(){Yr(`Cannot call ${K} due to unbound types`,B)}var ye=G.registeredClass.instancePrototype,pe=ye[f];return pe===void 0||pe.overloadTable===void 0&&pe.className!==G.name&&pe.argCount===d-2?(re.argCount=d-2,re.className=G.name,ye[f]=re):(ii(ye,f,K),ye[f].overloadTable[d-2]=re),_t([],B,Ue=>{var Xe=Pn(K,Ue,G,b,N,D);return ye[f].overloadTable===void 0?(Xe.argCount=d-2,ye[f]=Xe):ye[f].overloadTable[d-2]=Xe,[]}),[]})},Un=[],pt=[],Ln=l=>{l>9&&--pt[l+1]===0&&(pt[l]=void 0,Un.push(l))},Sl=()=>pt.length/2-5-Un.length,Cl=()=>{pt.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=Sl},$e={toValue:l=>(l||ce("Cannot use deleted val. handle = "+l),pt[l]),toHandle:l=>{switch(l){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const f=Un.pop()||pt.length;return pt[f]=l,pt[f+1]=1,f}}}},Nl={name:"emscripten::val",fromWireType:l=>{var f=$e.toValue(l);return Ln(l),f},toWireType:(l,f)=>$e.toHandle(f),argPackAdvance:ct,readValueFromPointer:hr,destructorFunction:null},hi=l=>ot(l,Nl),Ol=(l,f,d)=>{switch(f){case 1:return d?function(v){return this.fromWireType(F[v])}:function(v){return this.fromWireType($[v])};case 2:return d?function(v){return this.fromWireType(z[v>>1])}:function(v){return this.fromWireType(j[v>>1])};case 4:return d?function(v){return this.fromWireType(H[v>>2])}:function(v){return this.fromWireType(V[v>>2])};default:throw new TypeError(`invalid integer width (${f}): ${l}`)}},$l=(l,f,d,v)=>{f=De(f);function w(){}w.values={},ot(l,{name:f,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:(b,N)=>N.value,argPackAdvance:ct,readValueFromPointer:Ol(f,d,v),destructorFunction:null}),$n(f,w)},Kr=(l,f)=>{var d=Rt[l];return d===void 0&&ce(`${f} has unknown type ${ci(l)}`),d},Fl=(l,f,d)=>{var v=Kr(l,"enum");f=De(f);var w=v.constructor,b=Object.create(v.constructor.prototype,{value:{value:d},constructor:{value:Qt(`${v.name}_${f}`,function(){})}});w.values[d]=b,w[f]=b},Bn=l=>{if(l===null)return"null";var f=typeof l;return f==="object"||f==="array"||f==="function"?l.toString():""+l},Dl=(l,f)=>{switch(f){case 4:return function(d){return this.fromWireType(U[d>>2])};case 8:return function(d){return this.fromWireType(X[d>>3])};default:throw new TypeError(`invalid float width (${f}): ${l}`)}},Pl=(l,f,d)=>{f=De(f),ot(l,{name:f,fromWireType:v=>v,toWireType:(v,w)=>w,argPackAdvance:ct,readValueFromPointer:Dl(f,d),destructorFunction:null})},Ul=(l,f,d,v,w,b,N)=>{var C=Dn(f,d);l=De(l),l=ui(l),w=rt(v,w),$n(l,function(){Yr(`Cannot call ${l} due to unbound types`,C)},f-1),_t([],C,D=>{var B=[D[0],null].concat(D.slice(1));return ai(l,Pn(l,B,null,w,b,N),f-1),[]})},Ll=(l,f,d)=>{switch(f){case 1:return d?v=>F[v]:v=>$[v];case 2:return d?v=>z[v>>1]:v=>j[v>>1];case 4:return d?v=>H[v>>2]:v=>V[v>>2];default:throw new TypeError(`invalid integer width (${f}): ${l}`)}},Bl=(l,f,d,v,w)=>{f=De(f);var b=G=>G;if(v===0){var N=32-8*d;b=G=>G<<N>>>N}var C=f.includes("unsigned"),D=(G,K)=>{},B;C?B=function(G,K){return D(K,this.name),K>>>0}:B=function(G,K){return D(K,this.name),K},ot(l,{name:f,fromWireType:b,toWireType:B,argPackAdvance:ct,readValueFromPointer:Ll(f,d,v!==0),destructorFunction:null})},Vl=(l,f,d)=>{var v=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],w=v[f];function b(N){var C=V[N>>2],D=V[N+4>>2];return new w(F.buffer,D,C)}d=De(d),ot(l,{name:d,fromWireType:b,argPackAdvance:ct,readValueFromPointer:b},{ignoreDuplicateRegistrations:!0})},jl=(l,f)=>{hi(l)},kl=(l,f,d,v)=>{if(!(v>0))return 0;for(var w=d,b=d+v-1,N=0;N<l.length;++N){var C=l.charCodeAt(N);if(C>=55296&&C<=57343){var D=l.charCodeAt(++N);C=65536+((C&1023)<<10)|D&1023}if(C<=127){if(d>=b)break;f[d++]=C}else if(C<=2047){if(d+1>=b)break;f[d++]=192|C>>6,f[d++]=128|C&63}else if(C<=65535){if(d+2>=b)break;f[d++]=224|C>>12,f[d++]=128|C>>6&63,f[d++]=128|C&63}else{if(d+3>=b)break;f[d++]=240|C>>18,f[d++]=128|C>>12&63,f[d++]=128|C>>6&63,f[d++]=128|C&63}}return f[d]=0,d-w},zl=(l,f,d)=>kl(l,$,f,d),Gl=l=>{for(var f=0,d=0;d<l.length;++d){var v=l.charCodeAt(d);v<=127?f++:v<=2047?f+=2:v>=55296&&v<=57343?(f+=4,++d):f+=3}return f},pi=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ql=(l,f,d)=>{for(var v=f+d,w=f;l[w]&&!(w>=v);)++w;if(w-f>16&&l.buffer&&pi)return pi.decode(l.subarray(f,w));for(var b="";f<w;){var N=l[f++];if(!(N&128)){b+=String.fromCharCode(N);continue}var C=l[f++]&63;if((N&224)==192){b+=String.fromCharCode((N&31)<<6|C);continue}var D=l[f++]&63;if((N&240)==224?N=(N&15)<<12|C<<6|D:N=(N&7)<<18|C<<12|D<<6|l[f++]&63,N<65536)b+=String.fromCharCode(N);else{var B=N-65536;b+=String.fromCharCode(55296|B>>10,56320|B&1023)}}return b},Hl=(l,f)=>l?ql($,l,f):"",Wl=(l,f)=>{f=De(f);var d=f==="std::string";ot(l,{name:f,fromWireType(v){var w=V[v>>2],b=v+4,N;if(d)for(var C=b,D=0;D<=w;++D){var B=b+D;if(D==w||$[B]==0){var G=B-C,K=Hl(C,G);N===void 0?N=K:(N+=String.fromCharCode(0),N+=K),C=B+1}}else{for(var re=new Array(w),D=0;D<w;++D)re[D]=String.fromCharCode($[b+D]);N=re.join("")}return dt(v),N},toWireType(v,w){w instanceof ArrayBuffer&&(w=new Uint8Array(w));var b,N=typeof w=="string";N||w instanceof Uint8Array||w instanceof Uint8ClampedArray||w instanceof Int8Array||ce("Cannot pass non-string to std::string"),d&&N?b=Gl(w):b=w.length;var C=zn(4+b+1),D=C+4;if(V[C>>2]=b,d&&N)zl(w,D,b+1);else if(N)for(var B=0;B<b;++B){var G=w.charCodeAt(B);G>255&&(dt(D),ce("String has UTF-16 code units that do not fit in 8 bits")),$[D+B]=G}else for(var B=0;B<b;++B)$[D+B]=w[B];return v!==null&&v.push(dt,C),C},argPackAdvance:ct,readValueFromPointer:hr,destructorFunction(v){dt(v)}})},di=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Xl=(l,f)=>{for(var d=l,v=d>>1,w=v+f/2;!(v>=w)&&j[v];)++v;if(d=v<<1,d-l>32&&di)return di.decode($.subarray(l,d));for(var b="",N=0;!(N>=f/2);++N){var C=z[l+N*2>>1];if(C==0)break;b+=String.fromCharCode(C)}return b},Yl=(l,f,d)=>{if(d??=2147483647,d<2)return 0;d-=2;for(var v=f,w=d<l.length*2?d/2:l.length,b=0;b<w;++b){var N=l.charCodeAt(b);z[f>>1]=N,f+=2}return z[f>>1]=0,f-v},Kl=l=>l.length*2,Jl=(l,f)=>{for(var d=0,v="";!(d>=f/4);){var w=H[l+d*4>>2];if(w==0)break;if(++d,w>=65536){var b=w-65536;v+=String.fromCharCode(55296|b>>10,56320|b&1023)}else v+=String.fromCharCode(w)}return v},Zl=(l,f,d)=>{if(d??=2147483647,d<4)return 0;for(var v=f,w=v+d-4,b=0;b<l.length;++b){var N=l.charCodeAt(b);if(N>=55296&&N<=57343){var C=l.charCodeAt(++b);N=65536+((N&1023)<<10)|C&1023}if(H[f>>2]=N,f+=4,f+4>w)break}return H[f>>2]=0,f-v},Ql=l=>{for(var f=0,d=0;d<l.length;++d){var v=l.charCodeAt(d);v>=55296&&v<=57343&&++d,f+=4}return f},ef=(l,f,d)=>{d=De(d);var v,w,b,N;f===2?(v=Xl,w=Yl,N=Kl,b=C=>j[C>>1]):f===4&&(v=Jl,w=Zl,N=Ql,b=C=>V[C>>2]),ot(l,{name:d,fromWireType:C=>{for(var D=V[C>>2],B,G=C+4,K=0;K<=D;++K){var re=C+4+K*f;if(K==D||b(re)==0){var ye=re-G,pe=v(G,ye);B===void 0?B=pe:(B+=String.fromCharCode(0),B+=pe),G=re+f}}return dt(C),B},toWireType:(C,D)=>{typeof D!="string"&&ce(`Cannot pass non-string to C++ string type ${d}`);var B=N(D),G=zn(4+B+f);return V[G>>2]=B/f,w(D,G+4,B+f),C!==null&&C.push(dt,G),G},argPackAdvance:ct,readValueFromPointer:hr,destructorFunction(C){dt(C)}})},tf=(l,f,d,v,w,b)=>{zr[l]={name:De(f),rawConstructor:rt(d,v),rawDestructor:rt(w,b),fields:[]}},rf=(l,f,d,v,w,b,N,C,D,B)=>{zr[l].fields.push({fieldName:De(f),getterReturnType:d,getter:rt(v,w),getterContext:b,setterArgumentType:N,setter:rt(C,D),setterContext:B})},nf=(l,f)=>{f=De(f),ot(l,{isVoid:!0,name:f,argPackAdvance:0,fromWireType:()=>{},toWireType:(d,v)=>{}})},sf=(l,f,d)=>$.copyWithin(l,f,f+d),gi=(l,f,d)=>{var v=[],w=l.toWireType(v,d);return v.length&&(V[f>>2]=$e.toHandle(v)),w},af=(l,f,d)=>(l=$e.toValue(l),f=Kr(f,"emval::as"),gi(f,d,l)),of={},mi=l=>{var f=of[l];return f===void 0?De(l):f},Vn=[],cf=(l,f,d,v,w)=>(l=Vn[l],f=$e.toValue(f),d=mi(d),l(f,f[d],v,w)),lf=(l,f)=>(l=$e.toValue(l),f=$e.toValue(f),l==f),ff=l=>{var f=Vn.length;return Vn.push(l),f},uf=(l,f)=>{for(var d=new Array(l),v=0;v<l;++v)d[v]=Kr(V[f+v*4>>2],"parameter "+v);return d},hf=(l,f,d)=>{var v=uf(l,f),w=v.shift();l--;var b=`return function (obj, func, destructorsRef, args) {
`,N=0,C=[];d===0&&C.push("obj");for(var D=["retType"],B=[w],G=0;G<l;++G)C.push("arg"+G),D.push("argType"+G),B.push(v[G]),b+=`  var arg${G} = argType${G}.readValueFromPointer(args${N?"+"+N:""});
`,N+=v[G].argPackAdvance;var K=d===1?"new func":"func.call";b+=`  var rv = ${K}(${C.join(", ")});
`,w.isVoid||(D.push("emval_returnValue"),B.push(gi),b+=`  return emval_returnValue(retType, destructorsRef, rv);
`),b+=`};
`,D.push(b);var re=fi(Function,D)(...B),ye=`methodCaller<(${v.map(pe=>pe.name).join(", ")}) => ${w.name}>`;return ff(Qt(ye,re))},pf=(l,f)=>(l=$e.toValue(l),f=$e.toValue(f),$e.toHandle(l[f])),df=l=>{l>9&&(pt[l+1]+=1)},gf=l=>$e.toHandle(mi(l)),mf=()=>$e.toHandle({}),vf=l=>{var f=$e.toValue(l);Sn(f),Ln(l)},yf=(l,f,d)=>{l=$e.toValue(l),f=$e.toValue(f),d=$e.toValue(d),l[f]=d},xf=(l,f)=>{l=Kr(l,"_emval_take_value");var d=l.readValueFromPointer(f);return $e.toHandle(d)},Tf=()=>2147483648,Mf=l=>{var f=S.buffer,d=(l-f.byteLength+65535)/65536;try{return S.grow(d),se(),1}catch{}},Ef=l=>{var f=$.length;l>>>=0;var d=Tf();if(l>d)return!1;for(var v=(D,B)=>D+(B-D%B)%B,w=1;w<=4;w*=2){var b=f*(1+.2/w);b=Math.min(b,l+100663296);var N=Math.min(d,v(Math.max(l,b),65536)),C=Mf(N);if(C)return!0}return!1},wf=l=>l,vi=(l,f)=>{l<128?f.push(l):f.push(l%128|128,l>>7)},Rf=l=>{for(var f={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},d={parameters:[],results:l[0]=="v"?[]:[f[l[0]]]},v=1;v<l.length;++v)d.parameters.push(f[l[v]]);return d},_f=(l,f)=>{var d=l.slice(0,1),v=l.slice(1),w={i:127,p:127,j:126,f:125,d:124,e:111};f.push(96),vi(v.length,f);for(var b=0;b<v.length;++b)f.push(w[v[b]]);d=="v"?f.push(0):f.push(1,w[d])},If=(l,f)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Rf(f),l);var d=[1];_f(f,d);var v=[0,97,115,109,1,0,0,0,1];vi(d.length,v),v.push(...d),v.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var w=new WebAssembly.Module(new Uint8Array(v)),b=new WebAssembly.Instance(w,{e:{f:l}}),N=b.exports.f;return N},Af=(l,f)=>{if(At)for(var d=l;d<l+f;d++){var v=te(d);v&&At.set(v,d)}},At,bf=l=>(At||(At=new WeakMap,Af(0,It.length)),At.get(l)||0),jn=[],Sf=()=>{if(jn.length)return jn.pop();try{It.grow(1)}catch(l){throw l instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":l}return It.length-1},kn=(l,f)=>{It.set(l,f),vr[l]=It.get(l)},yr=(l,f)=>{var d=bf(l);if(d)return d;var v=Sf();try{kn(v,l)}catch(b){if(!(b instanceof TypeError))throw b;var w=If(l,f);kn(v,w)}return At.set(l,v),v},xr=l=>{At.delete(te(l)),kn(l,null),jn.push(l)};Qs=n.InternalError=class extends Error{constructor(f){super(f),this.name="InternalError"}},el(),Zt=n.BindingError=class extends Error{constructor(f){super(f),this.name="BindingError"}},hl(),cl(),Tl(),oi=n.UnboundTypeError=Rl(Error,"UnboundTypeError"),Cl();var Cf={K:qc,aa:Hc,a:Xc,k:Yc,h:Kc,d:Wc,Z:Jc,oa:Zc,Y:Qc,la:rl,x:_l,w:Al,i:bl,ka:hi,N:$l,t:Fl,U:Pl,o:Ul,z:Bl,s:Vl,A:jl,T:Wl,M:ef,B:tf,pa:rf,na:nf,$:sf,ta:af,ga:cf,va:Ln,sa:lf,ma:hf,ua:pf,ra:df,F:gf,V:mf,W:vf,wa:yf,E:xf,_:Ef,y:qf,H:fu,da:lu,J:Uf,u:Ff,I:iu,e:Pf,b:Of,m:$f,n:zf,D:Bf,X:hu,j:Gf,f:Df,ca:uu,ia:Kf,g:Lf,r:Zf,fa:ou,ea:cu,G:Yf,S:Wf,ha:Jf,ja:Xf,c:Nf,L:au,qa:jf,l:Vf,v:Hf,R:tu,p:Qf,P:nu,O:su,C:eu,q:kf,Q:ru,ba:wf},Pe=Gc(),yi=l=>(yi=Pe.za)(l),dt=l=>(dt=Pe.Ba)(l),zn=l=>(zn=Pe.Ca)(l),ne=(l,f)=>(ne=Pe.Da)(l,f),xi=l=>(xi=Pe.Ea)(l),Ti=l=>(Ti=Pe.Fa)(l),Mi=()=>(Mi=Pe.Ga)(),Ei=l=>(Ei=Pe.Ha)(l),wi=l=>(wi=Pe.Ia)(l),Ri=(l,f,d)=>(Ri=Pe.Ja)(l,f,d),_i=l=>(_i=Pe.Ka)(l),Ii=n.dynCall_iiij=(l,f,d,v,w)=>(Ii=n.dynCall_iiij=Pe.La)(l,f,d,v,w);function Nf(l,f,d,v){var w=ae();try{te(l)(f,d,v)}catch(b){if(ie(w),b!==b+0)throw b;ne(1,0)}}function Of(l,f,d){var v=ae();try{return te(l)(f,d)}catch(w){if(ie(v),w!==w+0)throw w;ne(1,0)}}function $f(l,f,d,v){var w=ae();try{return te(l)(f,d,v)}catch(b){if(ie(w),b!==b+0)throw b;ne(1,0)}}function Ff(l,f,d,v,w,b){var N=ae();try{return te(l)(f,d,v,w,b)}catch(C){if(ie(N),C!==C+0)throw C;ne(1,0)}}function Df(l,f){var d=ae();try{te(l)(f)}catch(v){if(ie(d),v!==v+0)throw v;ne(1,0)}}function Pf(l,f){var d=ae();try{return te(l)(f)}catch(v){if(ie(d),v!==v+0)throw v;ne(1,0)}}function Uf(l,f,d,v){var w=ae();try{return te(l)(f,d,v)}catch(b){if(ie(w),b!==b+0)throw b;ne(1,0)}}function Lf(l,f,d){var v=ae();try{te(l)(f,d)}catch(w){if(ie(v),w!==w+0)throw w;ne(1,0)}}function Bf(l,f,d,v,w,b){var N=ae();try{return te(l)(f,d,v,w,b)}catch(C){if(ie(N),C!==C+0)throw C;ne(1,0)}}function Vf(l,f,d,v,w){var b=ae();try{te(l)(f,d,v,w)}catch(N){if(ie(b),N!==N+0)throw N;ne(1,0)}}function jf(l,f,d,v,w,b,N,C){var D=ae();try{te(l)(f,d,v,w,b,N,C)}catch(B){if(ie(D),B!==B+0)throw B;ne(1,0)}}function kf(l,f,d,v,w,b,N,C,D,B,G){var K=ae();try{te(l)(f,d,v,w,b,N,C,D,B,G)}catch(re){if(ie(K),re!==re+0)throw re;ne(1,0)}}function zf(l,f,d,v,w){var b=ae();try{return te(l)(f,d,v,w)}catch(N){if(ie(b),N!==N+0)throw N;ne(1,0)}}function Gf(l){var f=ae();try{te(l)()}catch(d){if(ie(f),d!==d+0)throw d;ne(1,0)}}function qf(l,f){var d=ae();try{return te(l)(f)}catch(v){if(ie(d),v!==v+0)throw v;ne(1,0)}}function Hf(l,f,d,v,w,b){var N=ae();try{te(l)(f,d,v,w,b)}catch(C){if(ie(N),C!==C+0)throw C;ne(1,0)}}function Wf(l,f,d,v,w){var b=ae();try{te(l)(f,d,v,w)}catch(N){if(ie(b),N!==N+0)throw N;ne(1,0)}}function Xf(l,f,d,v,w,b,N,C,D){var B=ae();try{te(l)(f,d,v,w,b,N,C,D)}catch(G){if(ie(B),G!==G+0)throw G;ne(1,0)}}function Yf(l,f,d,v,w,b){var N=ae();try{te(l)(f,d,v,w,b)}catch(C){if(ie(N),C!==C+0)throw C;ne(1,0)}}function Kf(l,f,d,v){var w=ae();try{te(l)(f,d,v)}catch(b){if(ie(w),b!==b+0)throw b;ne(1,0)}}function Jf(l,f,d,v,w,b,N){var C=ae();try{te(l)(f,d,v,w,b,N)}catch(D){if(ie(C),D!==D+0)throw D;ne(1,0)}}function Zf(l,f,d,v){var w=ae();try{te(l)(f,d,v)}catch(b){if(ie(w),b!==b+0)throw b;ne(1,0)}}function Qf(l,f,d,v,w,b,N){var C=ae();try{te(l)(f,d,v,w,b,N)}catch(D){if(ie(C),D!==D+0)throw D;ne(1,0)}}function eu(l,f,d,v,w,b,N,C,D,B,G,K,re,ye){var pe=ae();try{te(l)(f,d,v,w,b,N,C,D,B,G,K,re,ye)}catch(Ue){if(ie(pe),Ue!==Ue+0)throw Ue;ne(1,0)}}function tu(l,f,d,v,w,b,N){var C=ae();try{te(l)(f,d,v,w,b,N)}catch(D){if(ie(C),D!==D+0)throw D;ne(1,0)}}function ru(l,f,d,v,w,b,N,C,D,B,G,K,re,ye,pe,Ue,Xe,A,O){var P=ae();try{te(l)(f,d,v,w,b,N,C,D,B,G,K,re,ye,pe,Ue,Xe,A,O)}catch(k){if(ie(P),k!==k+0)throw k;ne(1,0)}}function nu(l,f,d,v,w,b,N,C){var D=ae();try{te(l)(f,d,v,w,b,N,C)}catch(B){if(ie(D),B!==B+0)throw B;ne(1,0)}}function su(l,f,d,v,w,b,N,C,D,B){var G=ae();try{te(l)(f,d,v,w,b,N,C,D,B)}catch(K){if(ie(G),K!==K+0)throw K;ne(1,0)}}function iu(l){var f=ae();try{return te(l)()}catch(d){if(ie(f),d!==d+0)throw d;ne(1,0)}}function au(l,f,d,v,w){var b=ae();try{te(l)(f,d,v,w)}catch(N){if(ie(b),N!==N+0)throw N;ne(1,0)}}function ou(l,f,d,v,w){var b=ae();try{te(l)(f,d,v,w)}catch(N){if(ie(b),N!==N+0)throw N;ne(1,0)}}function cu(l,f,d,v,w,b){var N=ae();try{te(l)(f,d,v,w,b)}catch(C){if(ie(N),C!==C+0)throw C;ne(1,0)}}function lu(l,f,d,v){var w=ae();try{return te(l)(f,d,v)}catch(b){if(ie(w),b!==b+0)throw b;ne(1,0)}}function fu(l,f,d){var v=ae();try{return te(l)(f,d)}catch(w){if(ie(v),w!==w+0)throw w;ne(1,0)}}function uu(l,f,d){var v=ae();try{te(l)(f,d)}catch(w){if(ie(v),w!==w+0)throw w;ne(1,0)}}function hu(l,f,d,v,w){var b=ae();try{return Ii(l,f,d,v,w)}catch(N){if(ie(b),N!==N+0)throw N;ne(1,0)}}n.addFunction=yr,n.removeFunction=xr;var Jr;Ve=function l(){Jr||Ai(),Jr||(Ve=l)};function Ai(){if(Ne>0||(fe(),Ne>0))return;function l(){Jr||(Jr=!0,n.calledRun=!0,!L&&(ue(),s(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),de()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),l()},1)):l()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Ai(),r=a,r}})();const ut="EXT_mesh_manifold",ra="MERGE";class Ws extends Se{static EXTENSION_NAME=ut;init(){Ws.EXTENSION_NAME=ut,this.propertyType="ManifoldPrimitive",this.parentTypes=[q.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class Oc extends Te{extensionName=ut;prewriteTypes=[q.ACCESSOR];static EXTENSION_NAME=ut;createManifoldPrimitive(){return new Ws(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[ut])return;const a=e.meshes[i],o=this.createManifoldPrimitive();a.setExtension(ut,o);const c=s.extensions[ut];if(c.manifoldPrimitive){let u=0;const h=Array();h.push(u);for(const m of a.listPrimitives()){const y=m.getIndices();if(!y){console.log("Skipping non-indexed primitive ",m.getName());continue}u+=y.getCount(),h.push(u)}o.setRunIndex(h),o.setIndices(e.accessors[c.manifoldPrimitive.indices])}c.mergeIndices!=null&&c.mergeValues!=null&&o.setMerge(e.accessors[c.mergeIndices],e.accessors[c.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(ut);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,st.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const i=n.getMergeIndices(),a=n.getMergeValues();!i||!a||(e.addAccessorToUsageGroup(i,ra),e.addAccessorToUsageGroup(a,ra))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(ut);if(!s)return;const i=e.meshIndexMap.get(n),a=r.meshes[i],o=s.getRunIndex(),c=o.length-1;if(c!==a.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const u=e.accessorIndexMap.get(s.getMergeIndices()),h=e.accessorIndexMap.get(s.getMergeValues()),m=r.accessors[u],y=r.accessors[h],x=a.primitives[0],E={indices:e.accessorIndexMap.get(s.getIndices()),mode:x.mode,attributes:{POSITION:x.attributes.POSITION}},_=r.accessors[E.indices];if(_){m&&y&&(_.sparse={count:m.count,indices:{bufferView:m.bufferView,byteOffset:m.byteOffset,componentType:m.componentType},values:{bufferView:y.bufferView,byteOffset:y.byteOffset}});for(let p=0;p<c;++p){const R=r.accessors[a.primitives[p].indices];R.bufferView=_.bufferView,R.byteOffset=_.byteOffset+4*o[p],R.count=o[p+1]-o[p]}a.extensions=a.extensions||{},a.extensions[ut]={manifoldPrimitive:E,mergeIndices:u,mergeValues:h}}}),this}}const wr={POSITION:{type:Y.Type.VEC3,components:3},NORMAL:{type:Y.Type.VEC3,components:3},TANGENT:{type:Y.Type.VEC4,components:4},TEXCOORD_0:{type:Y.Type.VEC2,components:2},TEXCOORD_1:{type:Y.Type.VEC2,components:2},COLOR_0:{type:Y.Type.VEC3,components:3},JOINTS_0:{type:Y.Type.VEC4,components:4},WEIGHTS_0:{type:Y.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function om(t){return t.registerExtensions([Oc])}function na(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(Oc),i=t.createMesh(),a=Array(),o=Array(),c=new Map,u=e.runIndex.length-1;let h=-1;for(let T=0;T<u;++T){const M=e.runOriginalID[T];if(M==h)continue;h=M,a.push(e.runIndex[T]);const I=t.createAccessor("primitive indices of ID "+M).setBuffer(n).setType(Y.Type.SCALAR).setArray(new Uint32Array(1)),S=t.createPrimitive().setIndices(I),L=r.get(M);if(L){const{material:F,attributes:$}=L;if($.length<1||$[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');S.setMaterial(F),c.set(S,$),L.attributes.forEach((z,j)=>{if(j>=o.length)o.push(z);else{const H=wr[z].components,V=wr[o[j]].components;if(H!=V)throw new Error("Attribute sizes do not correspond: "+z+" and "+o[j]);wr[o[j]].type==null&&(o[j]=z)}})}else c.set(S,["POSITION"]);i.addPrimitive(S)}a.push(e.runIndex[u]);const m=e.numVert,y=e.numProp;let x=0;o.forEach((T,M)=>{const I=wr[T];if(I==null)throw new Error(T+" is not a recognized attribute.");if(I.type==null){++x;return}const S=I.components;if(x+S>y)throw new Error("Too many attribute channels.");const L=new Float32Array(S*m);for(let $=0;$<m;++$)for(let z=0;z<S;++z){let j=e.vertProperties[y*$+x+z];T=="COLOR_0"&&(j=Math.max(0,Math.min(1,j))),L[S*$+z]=j}const F=t.createAccessor(T).setBuffer(n).setType(I.type).setArray(L);for(const $ of i.listPrimitives()){const z=c.get($);z.length>M&&wr[z[M]].type!=null&&$.setAttribute(T,F)}x+=S});const E=s.createManifoldPrimitive();i.setExtension("EXT_mesh_manifold",E);const _=t.createAccessor("manifold indices").setBuffer(n).setType(Y.Type.SCALAR).setArray(e.triVerts);E.setIndices(_),E.setRunIndex(a);const p=[...Array(e.numVert).keys()],R=Array(),g=Array();if(e.mergeFromVert&&e.mergeToVert){for(const[T,M]of e.mergeFromVert.entries())p[M]=e.mergeToVert[T];for(const[T,M]of e.triVerts.entries()){const I=p[M];M!==I&&(R.push(T),g.push(I))}}if(R.length>0){const T=t.createAccessor("merge from").setBuffer(n).setType(Y.Type.SCALAR).setArray(new Uint32Array(R)),M=t.createAccessor("merge to").setBuffer(n).setType(Y.Type.SCALAR).setArray(new Uint32Array(g));E.setMerge(T,M)}return i}const et=await am();et.setup();To(Array);const $c=om(new Pu);$c.registerExtensions(co);const cm=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],lm=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","calculateCurvature","calculateNormals","smoothByNormals","smoothOut","refine","refineToLength","setProperties","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],fm=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],um=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],Fc=["show","only","setMaterial"],hm=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","resetToCircularDefaults","Mesh","GLTFNode","Manifold","CrossSection","setMorphStart","setMorphEnd"],pm=Fc.concat(hm),vn=new Array;function _n(t,e,r){const n=et[t],s=r?n:n.prototype;for(const i of e){const a=s[i];s[i]=function(...o){const c=a(...o);return vn.push(c),c}}}_n("Manifold",lm,!1);_n("Manifold",cm,!0);_n("CrossSection",um,!1);_n("CrossSection",fm,!0);for(const t of Fc){const e=et[t];et[t]=function(...r){const n=e(...r);return vn.push(n),n}}let Xs=!1;const yn=new Map,Ys=new Map,dm=30,Dc={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},gm={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},mm={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},kt=new Array,xn=new Map,cn=new Map,qt=new Map,Wt=new Map;let Br=1,ar,Dr,Kn,ln,Tn;function vm(){for(const t of vn)if(t instanceof Array)for(const e of t)e.delete();else t.delete();vn.length=0,Xs=!1,yn.clear(),Ys.clear(),kt.length=0,xn.clear(),cn.clear(),qt.clear(),Wt.clear(),Br=1}class ym{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,kt.push(this)}clone(e){const r={...this};return r._parent=e,kt.push(r),r}get parent(){return this._parent}}et.GLTFNode=ym;const Vt={...Dc};et.setMaterial=(t,e)=>{const r=t.asOriginal();return xn.set(r.originalID(),e),r};et.setMorphStart=(t,e)=>{const r=Wt.get(t);r!=null?r.start=e:Wt.set(t,{start:e})};et.setMorphEnd=(t,e)=>{const r=Wt.get(t);r!=null?r.end=e:Wt.set(t,{end:e})};function Pc(t,e){let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}et.show=t=>Pc(t,yn);et.only=t=>(Xs=!0,Pc(t,Ys));function sr(...t){typeof self<"u"&&self.console&&self.console.log(...t)}function Uc(t){const{quat:e}=Nc,r=Math.PI/180,n=e.create();return e.rotateZ(n,n,r*t[2]),e.rotateY(n,n,r*t[1]),e.rotateX(n,n,r*t[0]),n}function Jn(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const i=Dr.getCount(),a=e=="rotation"?4:3,o=new Float32Array(a*i);for(let m=0;m<i;++m){const y=m/(i-1),x=s(Vt.animationMode!=="ping-pong"?y:(1-Math.cos(y*2*Math.PI))/2);o.set(a===4?Uc(x):x,a*m)}const c=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(o).setType(a===4?Y.Type.VEC4:Y.Type.VEC3),u=t.createAnimationSampler().setInput(Dr).setOutput(c).setInterpolation("LINEAR"),h=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(u);return ar.addSampler(u),ar.addChannel(h),Tn=!0,s(0)}function xm(t,e,r){if(Wt.has(r)){const n=t.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(ln);ar.addChannel(n),Tn=!0}}function Tm(t,e){const r=[];if(e==null)return r;for(let n=0;n<t.numVert;++n)for(let s=0;s<3;++s)r[n*3+s]=t.vertProperties[n*t.numProp+s];if(e.start)for(let n=0;n<t.numVert;++n){const s=t.vertProperties,i=n*t.numProp,a=r.slice(i,i+3);e.start(a);for(let o=0;o<3;++o)s[i+o]=a[o]}return r}function Mm(t,e,r,n,s){s!=null&&(r.setWeights([0]),r.listPrimitives().forEach((i,a)=>{if(s.end)for(let y=0;y<e.numVert;++y){const x=n.slice(3*y,3*(y+1));s.end(x),n.splice(3*y,3,...x)}const o=i.getAttribute("POSITION").getArray(),c=new Float32Array(o.length),u=e.runIndex[a];for(let y=0;y<c.length;++y)c[y]=n[u+y]-o[y];const h=t.createAccessor(r.getName()+" morph target").setBuffer(t.getRoot().listBuffers()[0]).setArray(c).setType(Y.Type.VEC3),m=t.createPrimitiveTarget().setAttribute("POSITION",h);i.addTarget(m)}))}function Em(t,e){const r=t.createNode(e.name),n=Jn(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=Jn(t,"rotation",e,r);s!=null&&r.setRotation(Uc(s));const i=Jn(t,"scale",e,r);return i!=null&&r.setScale(i),r}function Lc(t){return t==null?{}:(t.material==null&&(t.material=Lc(t.parent)),t.material)}function wm(t,e={}){const r={...Vt};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:i,alpha:a,unlit:o}=r,c=t.createMaterial(e.name??"");if(o){const u=t.createExtension(Fs).createUnlit();c.setExtension("KHR_materials_unlit",u)}return a<1&&c.setAlphaMode(fr.AlphaMode.BLEND).setDoubleSided(!0),c.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...i,a])}function Mn(t,e){return cn.has(e)||cn.set(e,wm(t,e)),cn.get(e)}function Bc(t,e,r,n,s={}){const i=n.numTri();if(i==0){sr("Empty manifold, skipping.");return}sr(`Triangles: ${i.toLocaleString()}`);const a=n.boundingBox(),o=[0,0,0];for(let _=0;_<3;_++)o[_]=Math.round((a.max[_]-a.min[_])*10)/10;sr(`Bounding Box: X = ${o[0].toLocaleString()} mm, Y = ${o[1].toLocaleString()} mm, Z = ${o[2].toLocaleString()} mm`);const c=Math.round(n.getProperties().volume/10);sr(`Genus: ${n.genus().toLocaleString()}, Volume: ${(c/100).toLocaleString()} cm^3`);const u=n.getMesh(),h=new Map;for(const _ of u.runOriginalID){const p=xn.get(_)||s;h.set(_,{material:Mn(t,Xs?mm:p),attributes:["POSITION",...p.attributes??[]]})}const m=Wt.get(n),y=Tm(u,m),x=na(t,u,h);x.setName(r.getName()),r.setMesh(x),Mm(t,u,x,y,m);const E=u.numProp===3?u.vertProperties:new Float32Array(u.numVert*3);if(u.numProp>3)for(let _=0;_<u.numVert;++_)for(let p=0;p<3;++p)E[_*3+p]=u.vertProperties[_*u.numProp+p];qt.set(n,Br),e.meshes.push({vertices:E,indices:u.triVerts,id:`${Br++}`});for(const[_,p]of u.runOriginalID.entries()){const R=yn.has(p),g=R?yn.get(p):Ys.get(p);if(g==null)continue;h.get(p).material=Mn(t,R?gm:xn.get(p)||s);const T=t.createNode("debug").setMesh(na(t,g,h)).setMatrix(u.transform(_));r.addChild(T)}}function Vc(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function Rm(t,e,r,n,s){Vc(e,r);const i=t.createMesh();e.setMesh(i),r.getMesh().listPrimitives().forEach(a=>{const o=a.clone();a.getMaterial()===s&&o.setMaterial(n),i.addPrimitive(o)})}function _m(t,e,r,n){const s=Em(t,r),{manifold:i}=r;if(i!=null){xm(t,s,i);const a=Lc(r),o=n.get(i);if(o==null){Bc(t,e,s,i,a);const c=new Map;c.set(a,s),n.set(i,c)}else{const c=o.get(a);if(c==null){const[u,h]=o.entries().next().value;Rm(t,s,h,Mn(t,a),Mn(t,u)),o.set(a,s)}else Vc(s,c)}}return qt.set(r,Br),e.components.push({id:`${Br++}`,name:r.name,children:i==null?[]:[{objectID:`${qt.get(i)}`}]}),s}async function jc(t,e){Object.assign(Vt,Dc),Object.assign(Vt,t);const r=new xs,n=Math.sqrt(2)/2,s=1/1e3,i=r.createNode("wrapper").setRotation([-n,0,0,n]).setScale([s,s,s]);r.createScene().addChild(i),ar=r.createAnimation(""),Tn=!1;const a=Math.round(Vt.animationLength*dm)+1,o=new Float32Array(a),c=new Float32Array(a);for(let R=0;R<a;++R){const g=R/(a-1);o[R]=g*Vt.animationLength,c[R]=Vt.animationMode!=="ping-pong"?g:(1-Math.cos(g*2*Math.PI))/2}Dr=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(o).setType(Y.Type.SCALAR),Kn=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(c).setType(Y.Type.SCALAR),ln=r.createAnimationSampler().setInput(Dr).setOutput(Kn).setInterpolation("LINEAR"),ar.addSampler(ln);const u={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(kt.length>0){const R=new Map,g=new Map;let T=0;for(const M of kt)R.set(M,_m(r,u,M,g)),M.manifold&&++T;for(const M of kt){const I=R.get(M),S={objectID:`${qt.get(M)}`,transform:I.getMatrix()},{parent:L}=M;L==null?(i.addChild(I),u.items.push(S)):(R.get(L).addChild(I),u.components.find($=>$.id==`${qt.get(L)}`).children.push(S))}sr("Total glTF nodes: ",kt.length,", Total mesh references: ",T)}else{if(e==null){sr('No output because "result" is undefined and no "GLTFNode"s were created.');return}const R=r.createNode();Bc(r,u,R,e),i.addChild(R),u.items.push({objectID:`${qt.get(e)}`})}Tn||(Dr.dispose(),Kn.dispose(),ln.dispose(),ar.dispose());const h=await $c.writeBinary(r),m=new Blob([h],{type:"application/octet-stream"}),y=new $h;y.add3dModel("3D/3dmodel.model");const x=Oh(u),E={};E["3D/3dmodel.model"]=Fr(x),E[Yi.name]=Fr(Yi.content),E[y.name]=Fr(y.content);const _=Xh(E),p=new Blob([_],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"});return{glbURL:URL.createObjectURL(m),threeMFURL:URL.createObjectURL(p)}}function Im(t){const e={},r={globalDefaults:e,exportModels:jc,glMatrix:Nc,module:et,...Object.fromEntries(pm.map(i=>[i,et[i]]))},s=new Function(...Object.keys(r),`resetToCircularDefaults();
`+t+`
 return typeof result === "undefined" ? undefined : result;`)(...Object.values(r));return{globalDefaults:e,manifold:s}}async function Am(t){const{globalDefaults:e,manifold:r}=Im(t);return await jc(e,r)}self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}self.onmessage=async t=>{try{const e=await Am(t.data);self.postMessage(e)}catch(e){console.log(e.toString()),self.postMessage({objectURL:null})}finally{vm()}};
//# sourceMappingURL=worker-wrapper-68813735.js.map
